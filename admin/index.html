<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBX Admin Panel</title>
    <link rel="stylesheet" href="css/admin.css">
    <!-- Define fallback function before loading Chart.js -->
    <script>
        // Fallback function to load Chart.js from alternative CDNs
        function loadChartJsFallback() {
            console.warn('Primary Chart.js CDN failed, trying fallback...');
            const fallbacks = [
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.min.js'
            ];
            
            let currentIndex = 0;
            
            function tryNextFallback() {
                if (currentIndex >= fallbacks.length) {
                    console.error('All Chart.js CDN fallbacks failed');
                    window.chartJsLoadFailed = true;
                    return;
                }
                
                const script = document.createElement('script');
                script.src = fallbacks[currentIndex];
                script.onerror = function() {
                    console.warn(`Fallback ${currentIndex + 1} failed, trying next...`);
                    currentIndex++;
                    tryNextFallback();
                };
                script.onload = function() {
                    console.log(`Chart.js loaded successfully from fallback ${currentIndex + 1}`);
                    window.chartJsLoadFailed = false;
                };
                document.head.appendChild(script);
            }
            
            tryNextFallback();
        }
    </script>
    <!-- Load Chart.js with fallback on error -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" 
            onerror="loadChartJsFallback()"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìû PBX Admin Dashboard</h1>
            <div class="status-bar">
                <span id="connection-status" class="status-badge">Connecting...</span>
                <span id="system-status" class="status-badge"></span>
            </div>
        </header>

        <!-- Feature Requirements Info Banner -->
        <div id="feature-info-banner" class="info-box" style="margin: 15px 0; background: #f0f9ff; border-left: 4px solid #3b82f6;">
            <p style="margin: 0; font-size: 14px;">
                ‚ÑπÔ∏è <strong>Most features work without a phone or microphone!</strong> 
                Only the <strong>üìû Phone</strong> tab requires microphone access for making calls. 
                All other features (management, configuration, analytics) are fully accessible.
            </p>
        </div>

        <nav class="tabs">
            <button class="tab-button active" data-tab="dashboard">Dashboard</button>
            <button class="tab-button phone-required" data-tab="webrtc-phone" title="Requires microphone access">üìû Phone <span aria-hidden="true">üé§</span></button>
            <button class="tab-button" data-tab="analytics">Analytics</button>
            <button class="tab-button" data-tab="qos">Call Quality (QoS)</button>
            <button class="tab-button" data-tab="emergency">üö® Emergency</button>
            <button class="tab-button" data-tab="extensions">Extensions</button>
            <button class="tab-button" data-tab="phones">Registered Phones</button>
            <button class="tab-button" data-tab="provisioning">Phone Provisioning</button>
            <button class="tab-button" data-tab="auto-attendant">Auto Attendant</button>
            <button class="tab-button" data-tab="voicemail">Voicemail</button>
            <button class="tab-button" data-tab="calls">Active Calls</button>
            <button class="tab-button" data-tab="codecs">Codecs</button>
            <button class="tab-button" data-tab="config">Configuration</button>
        </nav>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>System Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-extensions">-</div>
                    <div class="stat-label">Registered Extensions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-calls">-</div>
                    <div class="stat-label">Active Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-calls">-</div>
                    <div class="stat-label">Total Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-recordings">-</div>
                    <div class="stat-label">Active Recordings</div>
                </div>
            </div>

            <h3>Active Directory Integration</h3>
            <div class="config-section" id="ad-integration-section">
                <div class="ad-status-grid">
                    <div class="ad-status-item">
                        <strong>Status:</strong> 
                        <span id="ad-status-badge" class="status-badge">Loading...</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Connection:</strong> 
                        <span id="ad-connection-status">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Server:</strong> 
                        <span id="ad-server">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Auto Provision:</strong> 
                        <span id="ad-auto-provision">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Synced Users:</strong> 
                        <span id="ad-synced-users">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Last Error:</strong> 
                        <span id="ad-error" style="color: #d32f2f;">-</span>
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-primary" onclick="refreshADStatus()">üîÑ Refresh AD Status</button>
                    <button class="btn btn-success" onclick="syncADUsers()" id="ad-sync-btn">üîÑ Sync Users from AD</button>
                </div>
            </div>

            <h3>Quick Actions</h3>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="refreshDashboard()">üîÑ Refresh Status</button>
                <button class="btn btn-success" onclick="showTab('extensions')">‚ûï Add Extension</button>
            </div>
        </div>

        <!-- WebRTC Phone Tab -->
        <div id="webrtc-phone" class="tab-content">
            <h2>üìû WebRTC Browser Phone</h2>
            
            <!-- Microphone Requirement Alert -->
            <div class="info-box" style="margin-bottom: 20px; background: #fff3cd; border-left: 4px solid #ffc107;">
                <p style="margin: 0 0 10px 0;">
                    <strong>‚ö†Ô∏è Microphone Access Required</strong>
                </p>
                <p style="margin: 0;">
                    This feature requires microphone access to make calls. If your OS or browser blocks microphone access, 
                    you can still use all other admin panel features (Extensions, Voicemail, Analytics, Configuration, etc.) 
                    which don't require a phone or microphone.
                </p>
            </div>
            
            <div class="info-box" style="margin-bottom: 20px;">
                <p>üéØ <strong>Make calls directly from your browser without a physical phone!</strong></p>
                <p>This WebRTC-based phone allows you to make calls to any extension from your computer. Perfect for working from home!</p>
                <p>‚ö†Ô∏è <strong>Note:</strong> Please allow microphone access when prompted by your browser.</p>
                <p>üéß <strong>Tip:</strong> Use headphones to prevent echo and feedback during calls.</p>
            </div>

            <div class="config-section" style="max-width: 600px; margin: 0 auto;">
                <div class="webrtc-phone-widget">
                    <div class="phone-display">
                        <div class="phone-status-container">
                            <div id="webrtc-status" class="webrtc-status info">Ready to call</div>
                        </div>
                        
                        <div class="phone-input-group" style="margin: 20px 0;">
                            <label for="webrtc-target-ext" style="display: block; margin-bottom: 8px; font-weight: bold;">
                                Call Extension:
                            </label>
                            <input 
                                type="text" 
                                id="webrtc-target-ext" 
                                value="1001" 
                                pattern="[0-9*#]+" 
                                maxlength="16"
                                style="width: 100%; padding: 12px; font-size: 24px; text-align: center; border: 2px solid #ddd; border-radius: 8px;"
                                placeholder="1001"
                            >
                            <small style="display: block; margin-top: 5px; color: #666;">
                                Enter extension (e.g., 0 for auto attendant, 1001 for operator, *1001 for voicemail)
                            </small>
                        </div>

                        <div class="phone-controls" style="display: flex; flex-direction: column; gap: 10px;">
                            <button 
                                id="webrtc-call-btn" 
                                class="btn btn-success" 
                                style="padding: 15px; font-size: 18px; width: 100%;"
                            >
                                üìû Call Extension
                            </button>
                            
                            <button 
                                id="webrtc-hangup-btn" 
                                class="btn btn-danger" 
                                style="padding: 15px; font-size: 18px; width: 100%;" 
                                disabled
                            >
                                üì¥ Hang Up
                            </button>
                            
                            <div style="display: flex; gap: 10px;">
                                <button 
                                    id="webrtc-mute-btn" 
                                    class="btn btn-secondary" 
                                    style="flex: 1; padding: 12px;" 
                                    disabled
                                >
                                    üîá Mute
                                </button>
                                
                                <div style="flex: 2; display: flex; align-items: center; gap: 10px; padding: 0 10px; background: #f5f5f5; border-radius: 4px;">
                                    <label for="webrtc-volume" style="white-space: nowrap;">üîä Volume:</label>
                                    <input 
                                        type="range" 
                                        id="webrtc-volume" 
                                        min="0" 
                                        max="100" 
                                        value="80" 
                                        style="flex: 1;"
                                    >
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Hidden audio element for remote audio -->
                    <audio id="webrtc-remote-audio" autoplay style="display: none;"></audio>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üìã Instructions</h3>
                    <ol>
                        <li>Enter the extension number you want to call (default is 1001 - Operator)</li>
                        <li>Click "üìû Call Extension" to start the call</li>
                        <li>Allow microphone access when your browser prompts you</li>
                        <li>Wait for the call to connect</li>
                        <li>Use the controls to mute/unmute or adjust volume</li>
                        <li>Click "üì¥ Hang Up" when you're done</li>
                    </ol>
                    
                    <h3 style="margin-top: 20px;">üîß Troubleshooting</h3>
                    <ul>
                        <li><strong>No audio:</strong> Check your microphone permissions in browser settings</li>
                        <li><strong>Can't connect:</strong> Ensure WebRTC is enabled in Configuration tab</li>
                        <li><strong>Call not ringing:</strong> Verify the target extension exists and is registered</li>
                        <li><strong>Echo or feedback:</strong> Use headphones to prevent audio feedback</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2>Call Analytics & Statistics</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <label>Time Period: 
                    <select id="analytics-period" onchange="loadAnalytics()">
                        <option value="1">Last 24 Hours</option>
                        <option value="7" selected>Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                    </select>
                </label>
                <button class="btn btn-primary" onclick="loadAnalytics()">üîÑ Refresh Analytics</button>
            </div>

            <!-- Overview Stats -->
            <div class="stats-grid" id="analytics-stats">
                <div class="stat-card">
                    <div class="stat-value" id="analytics-total-calls">-</div>
                    <div class="stat-label">Total Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="analytics-answered-calls">-</div>
                    <div class="stat-label">Answered Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="analytics-answer-rate">-</div>
                    <div class="stat-label">Answer Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="analytics-avg-duration">-</div>
                    <div class="stat-label">Avg Call Duration</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
                <div class="chart-box">
                    <h3>Daily Call Trends</h3>
                    <canvas id="daily-trends-chart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>Hourly Call Distribution</h3>
                    <canvas id="hourly-distribution-chart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>Call Disposition Breakdown</h3>
                    <canvas id="disposition-chart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>Call Quality Metrics</h3>
                    <canvas id="quality-chart"></canvas>
                </div>
            </div>

            <!-- Top Callers Table -->
            <div class="config-section">
                <h3>Top Callers</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Extension</th>
                                <th>Total Calls</th>
                                <th>Total Duration (min)</th>
                                <th>Avg Duration (sec)</th>
                            </tr>
                        </thead>
                        <tbody id="top-callers-table">
                            <tr>
                                <td colspan="4" class="loading">Loading top callers...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Peak Hours -->
            <div class="config-section">
                <h3>Peak Call Hours</h3>
                <div id="peak-hours-display" class="info-box">
                    Loading peak hours...
                </div>
            </div>
        </div>

        <!-- QoS (Call Quality) Tab -->
        <div id="qos" class="tab-content">
            <h2>Call Quality Monitoring (QoS)</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadQoSMetrics()">üîÑ Refresh Metrics</button>
                <button class="btn btn-secondary" onclick="clearQoSAlerts()">üóëÔ∏è Clear Alerts</button>
            </div>

            <!-- QoS Overview Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="qos-active-calls">-</div>
                    <div class="stat-label">Active Monitored Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="qos-total-calls">-</div>
                    <div class="stat-label">Total Calls Monitored</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="qos-avg-mos">-</div>
                    <div class="stat-label">Average MOS Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="qos-calls-with-issues">-</div>
                    <div class="stat-label">Calls with Issues</div>
                </div>
            </div>

            <!-- Active Call Quality -->
            <div class="config-section">
                <h3>üî¥ Active Call Quality</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Call ID</th>
                                <th>Duration</th>
                                <th>MOS Score</th>
                                <th>Quality</th>
                                <th>Packet Loss %</th>
                                <th>Jitter (ms)</th>
                                <th>Latency (ms)</th>
                            </tr>
                        </thead>
                        <tbody id="qos-active-calls-table">
                            <tr>
                                <td colspan="7" class="loading">Loading active call metrics...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- QoS Alerts -->
            <div class="config-section">
                <h3>‚ö†Ô∏è Quality Alerts</h3>
                <div id="qos-alerts-container">
                    <div class="info-box">Loading alerts...</div>
                </div>
            </div>

            <!-- Historical Call Quality -->
            <div class="config-section">
                <h3>üìä Recent Call Quality History</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Call ID</th>
                                <th>Start Time</th>
                                <th>Duration</th>
                                <th>MOS Score</th>
                                <th>Quality</th>
                                <th>Packet Loss %</th>
                                <th>Jitter (ms)</th>
                                <th>Latency (ms)</th>
                            </tr>
                        </thead>
                        <tbody id="qos-history-table">
                            <tr>
                                <td colspan="8" class="loading">Loading call history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- QoS Alert Thresholds -->
            <div class="config-section">
                <h3>‚öôÔ∏è Alert Threshold Configuration</h3>
                <form id="qos-thresholds-form" onsubmit="saveQoSThresholds(event)">
                    <div class="form-group">
                        <label>Minimum MOS Score (alert below):</label>
                        <input type="number" id="qos-threshold-mos" step="0.1" min="1.0" max="5.0" value="3.5">
                        <small>Alert when MOS score drops below this value (1.0 - 5.0)</small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Packet Loss % (alert above):</label>
                        <input type="number" id="qos-threshold-loss" step="0.1" min="0" max="100" value="2.0">
                        <small>Alert when packet loss exceeds this percentage</small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Jitter ms (alert above):</label>
                        <input type="number" id="qos-threshold-jitter" step="1" min="0" max="500" value="50">
                        <small>Alert when jitter exceeds this value in milliseconds</small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Latency ms (alert above):</label>
                        <input type="number" id="qos-threshold-latency" step="1" min="0" max="1000" value="300">
                        <small>Alert when latency exceeds this value in milliseconds</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Thresholds</button>
                </form>
            </div>

            <!-- QoS Info Box -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è About QoS Monitoring</h3>
                <div class="info-box">
                    <p><strong>MOS Score (Mean Opinion Score):</strong> A rating from 1.0 (bad) to 5.0 (excellent) that represents perceived call quality.</p>
                    <ul>
                        <li><strong>4.3-5.0:</strong> Excellent - No perceptible quality issues</li>
                        <li><strong>4.0-4.3:</strong> Good - Minor impairments, acceptable quality</li>
                        <li><strong>3.6-4.0:</strong> Fair - Noticeable but tolerable impairments</li>
                        <li><strong>3.1-3.6:</strong> Poor - Quality significantly affected</li>
                        <li><strong>1.0-3.1:</strong> Bad - Severe quality issues</li>
                    </ul>
                    <p><strong>Packet Loss:</strong> Percentage of packets that didn't arrive. Above 2% can cause noticeable quality degradation.</p>
                    <p><strong>Jitter:</strong> Variation in packet arrival times. High jitter (>50ms) causes choppy audio.</p>
                    <p><strong>Latency:</strong> Round-trip delay. Above 300ms can cause conversational difficulties.</p>
                </div>
            </div>
        </div>

        <!-- Emergency Notification Tab -->
        <div id="emergency" class="tab-content">
            <h2>üö® Emergency Notification System</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadEmergencyContacts()">üîÑ Refresh Contacts</button>
                <button class="btn btn-warning" onclick="testEmergencyNotification()">üß™ Test System</button>
                <button class="btn btn-danger" onclick="showTriggerEmergencyModal()">üö® Trigger Emergency</button>
            </div>

            <!-- Emergency System Status -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="emergency-contacts-count">-</div>
                    <div class="stat-label">Emergency Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emergency-notifications-sent">-</div>
                    <div class="stat-label">Notifications Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emergency-last-test">-</div>
                    <div class="stat-label">Last Test</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emergency-system-status">üü¢ Active</div>
                    <div class="stat-label">System Status</div>
                </div>
            </div>

            <!-- Emergency Contacts -->
            <div class="config-section">
                <div class="section-header">
                    <h3>üìã Emergency Contact List</h3>
                    <button class="btn btn-success" onclick="showAddEmergencyContactModal()">‚ûï Add Contact</button>
                </div>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p><strong>Emergency contacts</strong> will be notified automatically when:</p>
                    <ul>
                        <li>üö® Someone dials 911 from the system</li>
                        <li>‚ö†Ô∏è A panic button is activated</li>
                        <li>üî¥ An emergency notification is manually triggered</li>
                    </ul>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Priority</th>
                                <th>Name</th>
                                <th>Extension</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Notification Methods</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="emergency-contacts-table">
                            <tr>
                                <td colspan="7" class="loading">Loading emergency contacts...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Emergency Notification History -->
            <div class="config-section">
                <h3>üìú Notification History</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Trigger Type</th>
                                <th>Details</th>
                                <th>Contacts Notified</th>
                                <th>Methods Used</th>
                            </tr>
                        </thead>
                        <tbody id="emergency-history-table">
                            <tr>
                                <td colspan="5" class="loading">Loading notification history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Emergency Information -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è Emergency Notification Information</h3>
                <div class="info-box">
                    <h4>Priority Levels</h4>
                    <ul>
                        <li><strong>Priority 1 (Highest):</strong> First responders, security personnel</li>
                        <li><strong>Priority 2:</strong> Management, supervisors</li>
                        <li><strong>Priority 3:</strong> HR, facilities</li>
                        <li><strong>Priority 4-5:</strong> Additional contacts</li>
                    </ul>
                    
                    <h4>Notification Methods</h4>
                    <ul>
                        <li><strong>Call:</strong> Automated voice call to extension or phone</li>
                        <li><strong>Page:</strong> Overhead paging announcement</li>
                        <li><strong>Email:</strong> Emergency notification email</li>
                        <li><strong>SMS:</strong> Text message alert (requires configuration)</li>
                    </ul>
                    
                    <h4>911 Detection</h4>
                    <p>When someone dials 911 from any extension, all emergency contacts are automatically notified with:</p>
                    <ul>
                        <li>Caller's extension and name</li>
                        <li>Time of call</li>
                        <li>Location information (if available)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Extensions Tab -->
        <div id="extensions" class="tab-content">
            <div class="section-header">
                <h2>Extension Management</h2>
                <div>
                    <button class="btn btn-success" onclick="showAddExtensionModal()">‚ûï Add Extension</button>
                    <button class="btn btn-secondary" onclick="rebootAllPhones()">üîÑ Reboot All Phones</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Number</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>External</th>
                            <th>VM PIN</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="extensions-table-body">
                        <tr>
                            <td colspan="7" class="loading">Loading extensions...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Registered Phones Tab -->
        <div id="phones" class="tab-content">
            <div class="section-header">
                <h2>Registered Phones (Database)</h2>
                <button class="btn btn-primary" onclick="loadRegisteredPhones()">üîÑ Refresh</button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Extension</th>
                            <th>IP Address</th>
                            <th>MAC Address</th>
                            <th>User Agent</th>
                            <th>Last Registration</th>
                        </tr>
                    </thead>
                    <tbody id="registered-phones-table-body">
                        <tr>
                            <td colspan="5" class="loading">Loading registered phones...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Phone Provisioning Tab -->
        <div id="provisioning" class="tab-content">
            <div class="section-header">
                <h2>Phone Auto-Provisioning Setup</h2>
                <button class="btn btn-primary" onclick="loadProvisioningDevices()">üîÑ Refresh</button>
            </div>

            <div class="config-section">
                <h3>Provisioning Settings</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="provisioning-enabled" onchange="toggleProvisioningEnabled()">
                        Enable Auto-Provisioning
                    </label>
                </div>
                <div id="provisioning-settings" style="display: none;">
                    <div class="form-group">
                        <label>Server IP Address:</label>
                        <input type="text" id="provisioning-server-ip" placeholder="192.168.1.14">
                        <small>IP address that phones will use to download configuration</small>
                    </div>
                    <div class="form-group">
                        <label>API Port:</label>
                        <input type="number" id="provisioning-port" value="8080">
                    </div>
                    <div class="form-group">
                        <label>Provisioning URL Format:</label>
                        <input type="text" id="provisioning-url-format" readonly>
                        <small>Phones will download from: SERVER:PORT/provision/{mac}.cfg (protocol auto-detected)</small>
                    </div>
                    <div class="form-group">
                        <label>Custom Templates Directory (optional):</label>
                        <input type="text" id="provisioning-custom-dir" placeholder="custom_templates">
                    </div>
                    <button class="btn btn-success" onclick="saveProvisioningSettings()">üíæ Save Settings</button>
                </div>
            </div>

            <div class="config-section">
                <h3>Phone Book Configuration for IP Phones</h3>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>üìñ Configure how phones access the company directory. Two methods are supported:</p>
                    <ul>
                        <li><strong>LDAPS:</strong> Direct LDAP/LDAPS server connection (Primary method)</li>
                        <li><strong>Remote URL:</strong> HTTP/HTTPS XML feed from PBX (Fallback method)</li>
                    </ul>
                    <p>üí° Both methods can be enabled simultaneously for redundancy.</p>
                </div>
                
                <!-- LDAPS Configuration -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="ldap-phonebook-enabled" onchange="toggleLdapPhonebookSettings()">
                        Enable LDAPS Phone Book
                    </label>
                    <small>Allow phones to directly query LDAP directory (Recommended for Zultys 33G/37G)</small>
                </div>
                
                <div id="ldap-phonebook-settings" style="display: none; margin-left: 20px; border-left: 3px solid #007bff; padding-left: 15px;">
                    <div class="form-group">
                        <label>LDAP Server:</label>
                        <input type="text" id="ldap-phonebook-server" placeholder="ldaps://192.168.1.22">
                        <small>Use ldaps:// for secure connection (recommended)</small>
                    </div>
                    <div class="form-group">
                        <label>LDAP Port:</label>
                        <input type="number" id="ldap-phonebook-port" placeholder="636">
                        <small>636 for LDAPS (SSL), 389 for plain LDAP</small>
                    </div>
                    <div class="form-group">
                        <label>Base DN:</label>
                        <input type="text" id="ldap-phonebook-base" placeholder="DC=company,DC=com">
                        <small>Base distinguished name for directory searches</small>
                    </div>
                    <div class="form-group">
                        <label>Bind User (DN):</label>
                        <input type="text" id="ldap-phonebook-user" placeholder="CN=phonebook,CN=Users,DC=company,DC=com">
                        <small>User account for phone authentication (use read-only account)</small>
                    </div>
                    <div class="form-group">
                        <label>Bind Password:</label>
                        <input type="password" id="ldap-phonebook-password" placeholder="Enter password">
                        <small>‚ö†Ô∏è Store securely in .env file as LDAP_PHONEBOOK_PASSWORD</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ldap-phonebook-tls" checked>
                            Use SSL/TLS (LDAPS)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Display Name:</label>
                        <input type="text" id="ldap-phonebook-display-name" placeholder="Company Directory">
                        <small>Name shown on phone display</small>
                    </div>
                </div>
                
                <!-- Remote Phone Book URL Configuration -->
                <div class="form-group" style="margin-top: 20px;">
                    <label>
                        <input type="checkbox" id="remote-phonebook-enabled" onchange="toggleRemotePhonebookSettings()">
                        Enable Remote Phone Book URL
                    </label>
                    <small>Provide HTTP/HTTPS URL for phones to fetch XML directory (Fallback)</small>
                </div>
                
                <div id="remote-phonebook-settings" style="display: none; margin-left: 20px; border-left: 3px solid #28a745; padding-left: 15px;">
                    <div class="form-group">
                        <label>Phone Book URL:</label>
                        <input type="text" id="remote-phonebook-url" readonly>
                        <small>Automatically configured based on server settings</small>
                    </div>
                    <div class="form-group">
                        <label>Refresh Interval (minutes):</label>
                        <input type="number" id="remote-phonebook-refresh" placeholder="60" min="1" max="1440">
                        <small>How often phones should refresh the directory (1-1440 minutes)</small>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="savePhonebookSettings()">üíæ Save Phone Book Settings</button>
            </div>

            <div class="config-section">
                <h3>Supported Phone Models</h3>
                <div id="supported-vendors-list" class="info-box">
                    <p>Loading supported vendors...</p>
                </div>
            </div>

            <div class="config-section">
                <div class="section-header">
                    <h3>Provisioning Templates</h3>
                    <div>
                        <button class="btn btn-primary" onclick="loadProvisioningTemplates()">üîÑ Refresh Templates</button>
                        <button class="btn btn-success" onclick="reloadTemplates()">‚ôªÔ∏è Reload from Disk</button>
                    </div>
                </div>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>üìÅ <strong>Templates Location:</strong> <code>provisioning_templates/</code></p>
                    <p>Templates contain placeholders like <code>{{EXTENSION_NUMBER}}</code>, <code>{{EXTENSION_NAME}}</code>, <code>{{SIP_SERVER}}</code> that are automatically replaced with device-specific information when a phone requests configuration.</p>
                    <p>üí° <strong>Tip:</strong> Export a built-in template, customize it, and reload to use your custom version.</p>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Vendor</th>
                                <th>Model</th>
                                <th>Type</th>
                                <th>Size</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="templates-table-body">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh Templates" to load templates</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <div class="section-header">
                    <h3>Provisioned Devices</h3>
                    <button class="btn btn-success" onclick="showAddDeviceModal()">‚ûï Add Device</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>MAC Address</th>
                                <th>Extension</th>
                                <th>Vendor</th>
                                <th>Model</th>
                                <th>Created</th>
                                <th>Last Provisioned</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="provisioning-devices-table-body">
                            <tr>
                                <td colspan="7" class="loading">Loading provisioned devices...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>Next Steps</h3>
                <div class="info-box">
                    <ol>
                        <li><strong>Configure DHCP Server:</strong> Set Option 66 to provide the provisioning URL to phones automatically</li>
                        <li><strong>Add Devices:</strong> Register each phone with its MAC address and extension number</li>
                        <li><strong>Reboot Phones:</strong> Phones will automatically download their configuration on boot</li>
                        <li><strong>Alternative:</strong> Manually configure provisioning URL in each phone's settings</li>
                    </ol>
                    <p>üìö For detailed instructions, see <a href="https://github.com/mattiIce/PBX/blob/main/PHONE_PROVISIONING.md" target="_blank">PHONE_PROVISIONING.md</a></p>
                </div>
            </div>
        </div>

        <!-- Auto Attendant Tab -->
        <div id="auto-attendant" class="tab-content">
            <div class="section-header">
                <h2>Auto Attendant Configuration</h2>
                <button class="btn btn-primary" onclick="loadAutoAttendantConfig()">üîÑ Refresh</button>
            </div>

            <div class="config-section">
                <h3>üìû General Settings</h3>
                <form id="auto-attendant-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="aa-enabled">
                            Enable Auto Attendant
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Extension Number:</label>
                        <input type="text" id="aa-extension" placeholder="0" pattern="[0-9]+" maxlength="4">
                        <small>Extension number for auto attendant (e.g., 0 for main line)</small>
                    </div>
                    <div class="form-group">
                        <label>Timeout (seconds):</label>
                        <input type="number" id="aa-timeout" min="5" max="60" value="10">
                        <small>How long to wait for DTMF input before repeating menu</small>
                    </div>
                    <div class="form-group">
                        <label>Max Retries:</label>
                        <input type="number" id="aa-max-retries" min="1" max="10" value="3">
                        <small>Maximum number of invalid attempts before transferring to operator</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Settings</button>
                </form>
            </div>

            <div class="config-section">
                <div class="section-header">
                    <h3>üéØ Menu Options</h3>
                    <button class="btn btn-success" onclick="showAddMenuOptionModal()">‚ûï Add Menu Option</button>
                </div>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>Configure what happens when callers press digits on their phone.</p>
                    <p><strong>Example:</strong> Press 1 for Sales (ext 1001), Press 2 for Support (ext 1002)</p>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Digit</th>
                                <th>Destination</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="aa-menu-options-table-body">
                            <tr>
                                <td colspan="4" class="loading">Loading menu options...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>üéµ Voice Prompts Configuration</h3>
                <div class="info-box">
                    <p><strong>üé§ Voice Generation:</strong> Voice prompts are automatically generated using gTTS (Google Text-to-Speech) when you save changes.</p>
                    <p><strong>üìÅ Location:</strong> <code>auto_attendant/</code> directory</p>
                </div>
                <form id="auto-attendant-prompts-form">
                    <div class="form-group">
                        <label>Company Name:</label>
                        <input type="text" id="aa-company-name" placeholder="Your Company" maxlength="100">
                        <small>Used in the welcome greeting</small>
                    </div>
                    <div class="form-group">
                        <label>Welcome Greeting Text:</label>
                        <textarea id="aa-prompt-welcome" rows="2" placeholder="Thank you for calling {company_name}."></textarea>
                        <small>Use {company_name} placeholder for company name</small>
                    </div>
                    <div class="form-group">
                        <label>Main Menu Text:</label>
                        <textarea id="aa-prompt-main-menu" rows="3" placeholder="For Sales, press 1. For Support, press 2. For Accounting, press 3. Or press 0 to speak with an operator."></textarea>
                        <small>Describe your menu options to callers</small>
                    </div>
                    <div class="form-group">
                        <label>Invalid Option Text:</label>
                        <textarea id="aa-prompt-invalid" rows="2" placeholder="That is not a valid option. Please try again."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Timeout Text:</label>
                        <textarea id="aa-prompt-timeout" rows="2" placeholder="We did not receive your selection. Please try again."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Transferring Text:</label>
                        <textarea id="aa-prompt-transferring" rows="2" placeholder="Please hold while we transfer your call."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save & Regenerate Voices</button>
                </form>
                <div id="voice-generation-status" style="margin-top: 15px; display: none;">
                    <div class="info-box">
                        <p id="voice-generation-message">‚è≥ Generating voices using gTTS...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voicemail Tab -->
        <div id="voicemail" class="tab-content">
            <div class="section-header">
                <h2>Voicemail Management</h2>
                <div>
                    <label for="vm-extension-select">Extension: </label>
                    <select id="vm-extension-select" onchange="loadVoicemailForExtension()">
                        <option value="">Select Extension</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadVoicemailForExtension()">üîÑ Refresh</button>
                </div>
            </div>

            <div id="voicemail-box-overview" class="config-section" style="display: none;">
                <h3>Mailbox Overview</h3>
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-card">
                        <div class="stat-value" id="vm-total-messages">-</div>
                        <div class="stat-label">Total Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vm-unread-messages">-</div>
                        <div class="stat-label">Unread Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vm-has-greeting">-</div>
                        <div class="stat-label">Custom Greeting</div>
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="exportVoicemailBox()">üì¶ Export All Voicemails</button>
                    <button class="btn btn-warning" onclick="clearVoicemailBox()">üóëÔ∏è Clear All Messages</button>
                </div>
            </div>

            <div id="voicemail-pin-section" class="config-section" style="display: none;">
                <h3>Voicemail PIN Management</h3>
                <form id="voicemail-pin-form">
                    <div class="form-group">
                        <label>Current Extension: <span id="vm-current-extension"></span></label>
                    </div>
                    <div class="form-group">
                        <label>New PIN (4 digits):</label>
                        <input type="text" id="vm-pin" pattern="[0-9]{4}" maxlength="4" placeholder="1234" required>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Update PIN</button>
                </form>
            </div>

            <div id="voicemail-messages-section" style="display: none;">
                <h3>Voicemail Messages</h3>
                <div class="action-buttons" style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="toggleVoicemailView()">
                        <span id="view-toggle-text">üìã Switch to Table View</span>
                    </button>
                </div>
                
                <!-- Card View (Visual Voicemail) -->
                <div id="voicemail-cards-view" class="voicemail-cards-container">
                    <!-- Voicemail cards will be inserted here -->
                    <div class="info-box">Select an extension to view voicemails</div>
                </div>
                
                <!-- Table View (Legacy) -->
                <div id="voicemail-table-view" class="table-container" style="display: none;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>From</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="voicemail-table-body">
                            <tr>
                                <td colspan="5" class="loading">Select an extension to view voicemails</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Audio Player Modal -->
            <div id="voicemail-player-modal" class="modal">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>üéµ Voicemail Player</h3>
                        <span class="close" onclick="closeVoicemailPlayer()">&times;</span>
                    </div>
                    <div style="padding: 20px;">
                        <div id="vm-player-details" class="info-box" style="margin-bottom: 15px;">
                            <!-- Message details will be inserted here -->
                        </div>
                        <audio id="vm-audio-player" controls style="width: 100%; margin-bottom: 15px;">
                            Your browser does not support the audio element.
                        </audio>
                        <div id="vm-transcription-display" style="display: none;">
                            <h4>üìù Transcription</h4>
                            <div class="transcription-box">
                                <p id="vm-transcription-text"></p>
                                <small id="vm-transcription-confidence" style="color: #6b7280;"></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Calls Tab -->
        <div id="calls" class="tab-content">
            <div class="section-header">
                <h2>Active Calls</h2>
                <button class="btn btn-primary" onclick="loadCalls()">üîÑ Refresh</button>
            </div>

            <div class="table-container">
                <div id="calls-list" class="calls-list">
                    <div class="loading">Loading calls...</div>
                </div>
            </div>
        </div>

        <!-- Codecs Tab -->
        <div id="codecs" class="tab-content">
            <h2>üéµ Audio & Video Codecs</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadCodecStatus()">üîÑ Refresh Status</button>
            </div>

            <!-- Codec Overview -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="codecs-supported">-</div>
                    <div class="stat-label">Supported Codecs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="codecs-enabled">-</div>
                    <div class="stat-label">Enabled Codecs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="codecs-active">-</div>
                    <div class="stat-label">Active Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="codecs-quality">-</div>
                    <div class="stat-label">HD Audio Capable</div>
                </div>
            </div>

            <!-- Audio Codecs -->
            <div class="config-section">
                <h3>üîä Audio Codecs</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Codec</th>
                                <th>Type</th>
                                <th>Bitrate</th>
                                <th>Quality</th>
                                <th>Bandwidth</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>G.711 (Œº-law/A-law)</strong></td>
                                <td>Narrowband</td>
                                <td>64 kbps</td>
                                <td>Standard</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Standard</span></td>
                                <td>Built-in, always available</td>
                            </tr>
                            <tr>
                                <td><strong>G.722</strong></td>
                                <td>Wideband</td>
                                <td>48/56/64 kbps</td>
                                <td>HD Audio</td>
                                <td>7 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Available</span></td>
                                <td>Framework ready for native library</td>
                            </tr>
                            <tr>
                                <td><strong>Opus</strong></td>
                                <td>Adaptive</td>
                                <td>6-510 kbps</td>
                                <td>Best Quality</td>
                                <td>Up to 20 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Implemented</span></td>
                                <td>Modern codec with FEC, PLC, DTX</td>
                            </tr>
                            <tr>
                                <td><strong>G.729</strong></td>
                                <td>Narrowband</td>
                                <td>8 kbps</td>
                                <td>Compressed</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Not Implemented</span></td>
                                <td>Low bandwidth codec (patent-encumbered)</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Video Codecs -->
            <div class="config-section">
                <h3>üìπ Video Codecs</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Codec</th>
                                <th>Type</th>
                                <th>Quality</th>
                                <th>Bitrate Range</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>VP8</strong></td>
                                <td>WebRTC</td>
                                <td>HD</td>
                                <td>100-2000 kbps</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Planned</span></td>
                                <td>Open-source WebRTC video codec</td>
                            </tr>
                            <tr>
                                <td><strong>H.264</strong></td>
                                <td>Standard</td>
                                <td>HD/Full HD</td>
                                <td>100-5000 kbps</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Planned</span></td>
                                <td>Widely supported video codec</td>
                            </tr>
                            <tr>
                                <td><strong>H.265 (HEVC)</strong></td>
                                <td>Advanced</td>
                                <td>4K capable</td>
                                <td>50-4000 kbps</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Future</span></td>
                                <td>Next-gen codec with better compression</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Codec Information -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è Codec Information</h3>
                <div class="info-box">
                    <h4>Audio Codec Comparison</h4>
                    <ul>
                        <li><strong>G.711:</strong> Uncompressed PCM. Standard quality (3.1 kHz), high bandwidth. Universal compatibility.</li>
                        <li><strong>G.722:</strong> Wideband (7 kHz). HD audio quality with moderate bandwidth. Better clarity than G.711.</li>
                        <li><strong>Opus:</strong> Modern adaptive codec. Best quality with variable bitrate. Includes FEC, PLC, and DTX. Recommended for WebRTC.</li>
                        <li><strong>G.729:</strong> Low bandwidth (8 kbps). Compressed quality. Good for limited bandwidth scenarios.</li>
                    </ul>
                    
                    <h4>Audio Quality Levels</h4>
                    <ul>
                        <li><strong>Narrowband (3.1 kHz):</strong> Standard telephone quality - G.711, G.729</li>
                        <li><strong>Wideband (7 kHz):</strong> HD audio quality - G.722</li>
                        <li><strong>Superwideband (12-20 kHz):</strong> Best audio quality - Opus</li>
                    </ul>
                    
                    <h4>Codec Selection Guidelines</h4>
                    <ul>
                        <li><strong>Internal calls:</strong> Use G.722 or Opus for best quality</li>
                        <li><strong>External/trunk calls:</strong> G.711 for compatibility, G.722 if supported</li>
                        <li><strong>Low bandwidth:</strong> G.729 or Opus at low bitrate</li>
                        <li><strong>WebRTC:</strong> Opus (required), VP8/H.264 for video</li>
                    </ul>
                </div>
            </div>

            <!-- Codec Configuration -->
            <div class="config-section">
                <h3>‚öôÔ∏è Codec Configuration</h3>
                <form id="codec-config-form" onsubmit="saveCodecConfig(event)">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="codec-g722-enabled" checked>
                            Enable G.722 HD Audio
                        </label>
                        <small>Wideband audio codec for higher quality calls</small>
                    </div>
                    <div class="form-group">
                        <label>G.722 Default Bitrate:</label>
                        <select id="codec-g722-bitrate">
                            <option value="48000">48 kbps</option>
                            <option value="56000">56 kbps</option>
                            <option value="64000" selected>64 kbps (Recommended)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="codec-opus-enabled" checked>
                            Enable Opus Codec
                        </label>
                        <small>Modern adaptive codec with best quality</small>
                    </div>
                    <div class="form-group">
                        <label>Codec Preference Order:</label>
                        <textarea id="codec-preference-order" rows="4" placeholder="Opus&#10;G.722&#10;G.711">Opus
G.722
G.711</textarea>
                        <small>Codecs will be negotiated in this order (one per line)</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Codec Settings</button>
                </form>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="config" class="tab-content">
            <h2>System Configuration</h2>
            <p class="info-box" style="margin-bottom: 20px;">
                Configure key PBX settings below. Changes are saved to <code>config.yml</code> and may require a system restart to take effect.
            </p>

            <!-- Feature Toggles -->
            <div class="config-section">
                <h3>üéõÔ∏è Feature Toggles</h3>
                <p class="config-note">Enable or disable system features</p>
                <form id="features-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-recording">
                            Enable Call Recording
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-transfer">
                            Enable Call Transfer
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-hold">
                            Enable Call Hold
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-conference">
                            Enable Conference Calling
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-voicemail">
                            Enable Voicemail
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-parking">
                            Enable Call Parking
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-queues">
                            Enable Call Queues
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-presence">
                            Enable Presence (Status) System
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-music-on-hold">
                            Enable Music on Hold
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-auto-attendant">
                            Enable Auto Attendant
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Feature Settings</button>
                </form>
            </div>

            <!-- Voicemail Settings -->
            <div class="config-section">
                <h3>üìß Voicemail Settings</h3>
                <form id="voicemail-config-form">
                    <div class="form-group">
                        <label>Max Message Duration (seconds):</label>
                        <input type="number" id="voicemail-max-duration" min="30" max="600" value="180">
                        <small>Maximum length of voicemail messages (30-600 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>Max Greeting Duration (seconds):</label>
                        <input type="number" id="voicemail-max-greeting" min="10" max="60" value="30">
                        <small>Maximum length of custom greetings (10-60 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>No Answer Timeout (seconds):</label>
                        <input type="number" id="voicemail-no-answer-timeout" min="10" max="60" value="30">
                        <small>How long to ring before sending to voicemail (10-60 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="voicemail-allow-custom-greetings">
                            Allow Custom Greetings
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="voicemail-email-notifications">
                            Enable Email Notifications
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Voicemail Settings</button>
                </form>
            </div>

            <!-- Email/SMTP Settings -->
            <div class="config-section">
                <h3>üì¨ Email/SMTP Settings</h3>
                <p class="config-note">Configure SMTP server for email notifications</p>
                <form id="email-config-form">
                    <div class="form-group">
                        <label>SMTP Host:</label>
                        <input type="text" id="smtp-host" placeholder="smtp.example.com">
                    </div>
                    <div class="form-group">
                        <label>SMTP Port:</label>
                        <input type="number" id="smtp-port" placeholder="587">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="smtp-use-tls">
                            Use TLS/SSL
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="smtp-username" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="smtp-password" placeholder="password">
                    </div>
                    <div class="form-group">
                        <label>From Address:</label>
                        <input type="email" id="email-from" placeholder="voicemail@company.com">
                    </div>
                    <div class="form-group">
                        <label>From Name:</label>
                        <input type="text" id="email-from-name" placeholder="PBX Voicemail">
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Email Settings</button>
                </form>
            </div>

            <!-- Recording Settings -->
            <div class="config-section">
                <h3>üéôÔ∏è Call Recording Settings</h3>
                <form id="recording-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="recording-auto-record">
                            Automatically Record All Calls
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Recording Format:</label>
                        <select id="recording-format">
                            <option value="wav">WAV (Uncompressed)</option>
                            <option value="mp3">MP3 (Compressed)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Storage Path:</label>
                        <input type="text" id="recording-storage-path" value="recordings">
                        <small>Directory for storing recordings</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Recording Settings</button>
                </form>
            </div>

            <!-- Security Settings -->
            <div class="config-section">
                <h3>üîí Security Settings</h3>
                <form id="security-config-form">
                    <div class="form-group">
                        <label>Minimum Password Length:</label>
                        <input type="number" id="security-min-password" min="8" max="32" value="12">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-uppercase">
                            Require Uppercase Letter
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-lowercase">
                            Require Lowercase Letter
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-digit">
                            Require Number
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-special">
                            Require Special Character
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Max Login Attempts:</label>
                        <input type="number" id="security-max-attempts" min="3" max="10" value="5">
                        <small>Failed attempts before temporary lockout</small>
                    </div>
                    <div class="form-group">
                        <label>Lockout Duration (seconds):</label>
                        <input type="number" id="security-lockout-duration" min="300" max="3600" value="900">
                        <small>How long accounts are locked after too many failed attempts (300-3600 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-fips-mode">
                            Enable FIPS 140-2 Compliance
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Security Settings</button>
                </form>
            </div>

            <!-- Advanced Feature Settings -->
            <div class="config-section">
                <h3>üöÄ Advanced Features</h3>
                <form id="advanced-features-form">
                    <h4>WebRTC Browser Calling</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-webrtc-enabled">
                            Enable WebRTC
                        </label>
                        <small>Allow browser-based calling without downloads</small>
                    </div>
                    
                    <h4>Webhooks</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-webhooks-enabled">
                            Enable Webhooks
                        </label>
                        <small>Event-driven integrations with external systems</small>
                    </div>
                    
                    <h4>CRM Integration</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-crm-enabled">
                            Enable CRM Integration
                        </label>
                        <small>Auto-display caller information from CRM</small>
                    </div>
                    
                    <h4>Hot Desking</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-hot-desking-enabled">
                            Enable Hot Desking
                        </label>
                        <small>Allow users to log in from any phone</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-hot-desking-require-pin">
                            Require PIN for Hot Desking
                        </label>
                    </div>
                    
                    <h4>Voicemail Transcription</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-transcription-enabled">
                            Enable Voicemail Transcription
                        </label>
                        <small>Convert voicemails to text (requires Vosk or Google Cloud)</small>
                    </div>
                    
                    <button type="submit" class="btn btn-success">üíæ Save Advanced Settings</button>
                </form>
            </div>

            <!-- Conference Settings -->
            <div class="config-section">
                <h3>üë• Conference Settings</h3>
                <form id="conference-config-form">
                    <div class="form-group">
                        <label>Max Participants:</label>
                        <input type="number" id="conference-max-participants" min="3" max="100" value="50">
                        <small>Maximum participants per conference (3-100)</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="conference-record">
                            Record Conferences by Default
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Conference Settings</button>
                </form>
            </div>

            <!-- SSL/HTTPS Configuration -->
            <div class="config-section">
                <h3>üîí SSL/HTTPS Configuration</h3>
                <p class="config-note">Configure HTTPS encryption for secure API communication</p>
                
                <div class="info-box" style="margin-bottom: 20px;">
                    <p><strong>Current Status:</strong></p>
                    <div id="ssl-status-info">
                        <p>‚è≥ Loading SSL status...</p>
                    </div>
                </div>

                <form id="ssl-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ssl-enabled">
                            Enable HTTPS/SSL
                        </label>
                        <small>Encrypt API communication using SSL/TLS certificates</small>
                    </div>

                    <div id="ssl-certificate-section" style="display: none; margin-left: 20px; border-left: 3px solid #2196F3; padding-left: 15px;">
                        <h4>Certificate Configuration</h4>
                        
                        <div class="form-group">
                            <label>Certificate File Path:</label>
                            <input type="text" id="ssl-cert-file" placeholder="certs/server.crt" readonly>
                            <small>Location of the SSL certificate file</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Private Key File Path:</label>
                            <input type="text" id="ssl-key-file" placeholder="certs/server.key" readonly>
                            <small>Location of the SSL private key file</small>
                        </div>

                        <div id="cert-details-section" style="display: none; margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
                            <h4 style="margin-top: 0;">Certificate Details</h4>
                            <div class="form-group">
                                <label>Subject:</label>
                                <input type="text" id="cert-subject" readonly>
                            </div>
                            <div class="form-group">
                                <label>Issuer:</label>
                                <input type="text" id="cert-issuer" readonly>
                            </div>
                            <div class="form-group">
                                <label>Valid From:</label>
                                <input type="text" id="cert-valid-from" readonly>
                            </div>
                            <div class="form-group">
                                <label>Valid Until:</label>
                                <input type="text" id="cert-valid-until" readonly>
                            </div>
                            <div class="form-group">
                                <label>Days Until Expiry:</label>
                                <input type="text" id="cert-days-expiry" readonly>
                            </div>
                        </div>

                        <h4 style="margin-top: 20px;">Generate Self-Signed Certificate</h4>
                        <p class="config-note">Generate a self-signed certificate for development/testing. For production, use a certificate from a trusted CA (Let's Encrypt, DigiCert, etc.).</p>
                        
                        <div class="form-group">
                            <label>Hostname/IP Address:</label>
                            <input type="text" id="ssl-hostname" placeholder="192.168.1.14">
                            <small>The hostname or IP address that will be used to access the server</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Certificate Validity (days):</label>
                            <input type="number" id="ssl-days-valid" value="365" min="1" max="3650">
                            <small>How many days the certificate will be valid (1-3650)</small>
                        </div>
                        
                        <div class="action-buttons">
                            <button type="button" class="btn btn-primary" onclick="generateSSLCertificate()">üîê Generate Certificate</button>
                            <button type="button" class="btn btn-secondary" onclick="refreshSSLStatus()">üîÑ Refresh Status</button>
                        </div>

                        <div class="info-box" style="margin-top: 20px;">
                            <p><strong>‚ö†Ô∏è Important Notes:</strong></p>
                            <ul>
                                <li>Self-signed certificates will show security warnings in browsers</li>
                                <li>After generating or configuring certificates, you must restart the PBX server</li>
                                <li>For production use, obtain certificates from a trusted CA like Let's Encrypt</li>
                                <li>Private keys are stored with restricted permissions (600) for security</li>
                            </ul>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success" style="margin-top: 15px;">üíæ Save SSL Settings</button>
                </form>
            </div>

            <!-- Server Info (Read-Only) -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è Server Information</h3>
                <p class="config-note">Read-only server information (edit in config.yml to change)</p>
                <div class="form-group">
                    <label>SIP Port:</label>
                    <input type="number" id="config-sip-port" value="5060" disabled>
                </div>
                <div class="form-group">
                    <label>API Port:</label>
                    <input type="number" id="config-api-port" value="8080" disabled>
                </div>
                <div class="form-group">
                    <label>External IP:</label>
                    <input type="text" id="config-external-ip" disabled>
                </div>
                <div class="form-group">
                    <label>Server Name:</label>
                    <input type="text" id="config-server-name" disabled>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Extension Modal -->
    <div id="add-extension-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Extension</h3>
                <span class="close" onclick="closeAddExtensionModal()">&times;</span>
            </div>
            <form id="add-extension-form">
                <div class="form-group">
                    <label>Extension Number:</label>
                    <input type="text" id="new-ext-number" required pattern="[0-9]{4}" placeholder="1001">
                    <small>4-digit number</small>
                </div>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="new-ext-name" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="new-ext-email" required placeholder="john@company.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="new-ext-password" required minlength="8" placeholder="Min 8 characters">
                </div>
                <div class="form-group">
                    <label>Voicemail PIN:</label>
                    <input type="text" id="new-ext-voicemail-pin" required pattern="[0-9]{4,6}" maxlength="6" placeholder="4-6 digits (e.g., 1234)">
                    <small>Required for voicemail security</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="new-ext-allow-external" checked>
                        Allow External Calls
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddExtensionModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Extension</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Extension Modal -->
    <div id="edit-extension-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Extension</h3>
                <span class="close" onclick="closeEditExtensionModal()">&times;</span>
            </div>
            <form id="edit-extension-form">
                <input type="hidden" id="edit-ext-number">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="edit-ext-name" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="edit-ext-email" required>
                </div>
                <div class="form-group">
                    <label>New Password (leave blank to keep current):</label>
                    <input type="password" id="edit-ext-password" minlength="8">
                </div>
                <div class="form-group">
                    <label>Voicemail PIN:</label>
                    <input type="text" id="edit-ext-voicemail-pin" pattern="[0-9]{4,6}" maxlength="6" placeholder="4-6 digits (e.g., 1234)">
                    <small>Leave blank to keep current PIN</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-ext-allow-external">
                        Allow External Calls
                    </label>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditExtensionModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Extension</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Device Modal -->
    <div id="add-device-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Phone Device</h3>
                <span class="close" onclick="closeAddDeviceModal()">&times;</span>
            </div>
            <form id="add-device-form">
                <div class="form-group">
                    <label>MAC Address:</label>
                    <input type="text" id="device-mac" required placeholder="00:15:65:12:34:56" pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$">
                    <small>Format: 00:15:65:12:34:56 (found on phone label or network settings)</small>
                </div>
                <div class="form-group">
                    <label>Extension Number:</label>
                    <select id="device-extension" required>
                        <option value="">Select Extension</option>
                    </select>
                    <small>Extension this phone will be assigned to</small>
                </div>
                <div class="form-group">
                    <label>Phone Vendor:</label>
                    <select id="device-vendor" required onchange="updateModelOptions()">
                        <option value="">Select Vendor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Phone Model:</label>
                    <select id="device-model" required>
                        <option value="">Select Vendor First</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddDeviceModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Device</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Template View/Edit Modal -->
    <div id="template-view-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="template-modal-title">View Template</h3>
                <span class="close" onclick="closeTemplateViewModal()">&times;</span>
            </div>
            <div style="padding: 20px;">
                <div id="template-placeholders" class="info-box" style="margin-bottom: 15px;">
                    <!-- Placeholder information will be inserted here -->
                </div>
                <div class="form-group">
                    <label>Template Content:</label>
                    <textarea id="template-content" rows="20" style="font-family: monospace; width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTemplateViewModal()">Close</button>
                    <button type="button" id="save-template-btn" class="btn btn-success" style="display: none;">üíæ Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Menu Option Modal -->
    <div id="add-menu-option-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Menu Option</h3>
                <span class="close" onclick="closeAddMenuOptionModal()">&times;</span>
            </div>
            <form id="add-menu-option-form">
                <div class="form-group">
                    <label>Digit (0-9, *, #):</label>
                    <input type="text" id="new-menu-digit" required pattern="[0-9*#]" maxlength="1" placeholder="1">
                    <small>Which digit callers will press</small>
                </div>
                <div class="form-group">
                    <label>Destination Extension:</label>
                    <input type="text" id="new-menu-destination" required placeholder="1001">
                    <small>Extension, queue, or feature code to transfer to</small>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="new-menu-description" required placeholder="Sales Department">
                    <small>Human-readable description of this menu option</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddMenuOptionModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Menu Option</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Menu Option Modal -->
    <div id="edit-menu-option-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Menu Option</h3>
                <span class="close" onclick="closeEditMenuOptionModal()">&times;</span>
            </div>
            <form id="edit-menu-option-form">
                <input type="hidden" id="edit-menu-digit">
                <div class="form-group">
                    <label>Digit: <span id="edit-menu-digit-display"></span></label>
                </div>
                <div class="form-group">
                    <label>Destination Extension:</label>
                    <input type="text" id="edit-menu-destination" required placeholder="1001">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="edit-menu-description" required placeholder="Sales Department">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditMenuOptionModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Menu Option</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Emergency Contact Modal -->
    <div id="add-emergency-contact-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add Emergency Contact</h3>
                <span class="close" onclick="closeAddEmergencyContactModal()">&times;</span>
            </div>
            <form id="add-emergency-contact-form" onsubmit="addEmergencyContact(event)">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="emergency-contact-name" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Extension:</label>
                    <input type="text" id="emergency-contact-extension" pattern="[0-9]+" placeholder="1001">
                    <small>Internal extension number</small>
                </div>
                <div class="form-group">
                    <label>External Phone:</label>
                    <input type="tel" id="emergency-contact-phone" placeholder="+1-555-0100">
                    <small>External phone number for calls/SMS</small>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="emergency-contact-email" placeholder="john@company.com">
                </div>
                <div class="form-group">
                    <label>Priority Level:</label>
                    <select id="emergency-contact-priority" required>
                        <option value="1">1 - Highest (First Responders)</option>
                        <option value="2">2 - High (Management)</option>
                        <option value="3" selected>3 - Medium (Staff)</option>
                        <option value="4">4 - Low</option>
                        <option value="5">5 - Lowest</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notification Methods:</label>
                    <div style="margin-top: 10px;">
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-call" value="call" checked>
                            üìû Call (Voice notification)
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-page" value="page">
                            üì¢ Page (Overhead announcement)
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-email" value="email">
                            üìß Email
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-sms" value="sms">
                            üí¨ SMS (Text message)
                        </label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddEmergencyContactModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trigger Emergency Modal -->
    <div id="trigger-emergency-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üö® Trigger Emergency Notification</h3>
                <span class="close" onclick="closeTriggerEmergencyModal()">&times;</span>
            </div>
            <form id="trigger-emergency-form" onsubmit="triggerEmergency(event)">
                <div class="info-box" style="background: #fee2e2; border-color: #ef4444; margin-bottom: 15px;">
                    <p><strong>‚ö†Ô∏è WARNING:</strong> This will send real emergency notifications to all configured contacts.</p>
                    <p>Only use this for actual emergencies or coordinated testing.</p>
                </div>
                <div class="form-group">
                    <label>Trigger Type:</label>
                    <select id="trigger-type" required>
                        <option value="manual">Manual Trigger</option>
                        <option value="test">Test (Clearly marked as test)</option>
                        <option value="panic_button">Panic Button</option>
                        <option value="other">Other Emergency</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location/Details:</label>
                    <textarea id="trigger-details" rows="3" placeholder="Building A, Floor 3, Room 301"></textarea>
                </div>
                <div class="form-group">
                    <label>Additional Information:</label>
                    <textarea id="trigger-info" rows="3" placeholder="Describe the situation..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTriggerEmergencyModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">üö® Send Emergency Notification</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script src="js/auto_attendant.js"></script>
    <script src="js/voicemail_enhanced.js"></script>
    <script src="js/webrtc_phone.js"></script>
</body>
</html>
