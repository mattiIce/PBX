<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PBX Admin Panel</title>
    <link rel="stylesheet" href="css/admin.css">
    <!-- Define fallback function before loading Chart.js -->
    <script>
        // Fallback function to load Chart.js from alternative CDNs
        function loadChartJsFallback() {
            console.warn('Primary Chart.js CDN failed, trying fallback...');
            const fallbacks = [
                'https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.0/chart.umd.min.js',
                'https://unpkg.com/chart.js@4.4.0/dist/chart.umd.min.js'
            ];
            
            let currentIndex = 0;
            
            function tryNextFallback() {
                if (currentIndex >= fallbacks.length) {
                    console.error('All Chart.js CDN fallbacks failed');
                    window.chartJsLoadFailed = true;
                    return;
                }
                
                const script = document.createElement('script');
                script.src = fallbacks[currentIndex];
                script.onerror = function() {
                    console.warn(`Fallback ${currentIndex + 1} failed, trying next...`);
                    currentIndex++;
                    tryNextFallback();
                };
                script.onload = function() {
                    console.log(`Chart.js loaded successfully from fallback ${currentIndex + 1}`);
                    window.chartJsLoadFailed = false;
                };
                document.head.appendChild(script);
            }
            
            tryNextFallback();
        }
    </script>
    <!-- Load Chart.js with fallback on error -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js" 
            onerror="loadChartJsFallback()"></script>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìû PBX Admin Dashboard</h1>
            <div class="status-bar">
                <span id="connection-status" class="status-badge">Connecting...</span>
                <span id="system-status" class="status-badge"></span>
                <button id="logout-button" class="logout-button" style="margin-left: 15px; padding: 6px 12px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;">
                    üö™ Logout
                </button>
            </div>
        </header>

        <div class="layout-wrapper">
            <!-- Left Sidebar Navigation -->
            <nav class="sidebar">
                <div class="sidebar-section">
                    <div class="sidebar-section-title">Overview</div>
                    <button class="tab-button active" data-tab="dashboard">
                        <span class="tab-icon">üìä</span>
                        <span class="tab-text">Dashboard</span>
                    </button>
                    <button class="tab-button" data-tab="analytics">
                        <span class="tab-icon">üìà</span>
                        <span class="tab-text">Analytics</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Communication</div>
                    <button class="tab-button phone-required" data-tab="webrtc-phone" title="Make calls from your browser">
                        <span class="tab-icon">üìû</span>
                        <span class="tab-text">Phone</span>
                    </button>
                    <button class="tab-button" data-tab="calls">
                        <span class="tab-icon">üì±</span>
                        <span class="tab-text">Active Calls</span>
                    </button>
                    <button class="tab-button" data-tab="click-to-dial">
                        <span class="tab-icon">üì≤</span>
                        <span class="tab-text">Click-to-Dial</span>
                    </button>
                    <button class="tab-button" data-tab="qos">
                        <span class="tab-icon">üì°</span>
                        <span class="tab-text">Call Quality</span>
                    </button>
                    <button class="tab-button" data-tab="emergency">
                        <span class="tab-icon">üö®</span>
                        <span class="tab-text">Emergency</span>
                    </button>
                    <button class="tab-button" data-tab="nomadic-e911">
                        <span class="tab-icon">üìç</span>
                        <span class="tab-text">Nomadic E911</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Management</div>
                    <button class="tab-button" data-tab="extensions">
                        <span class="tab-icon">üë•</span>
                        <span class="tab-text">Extensions</span>
                    </button>
                    <button class="tab-button" data-tab="phones">
                        <span class="tab-icon">‚òéÔ∏è</span>
                        <span class="tab-text">Registered Phones</span>
                    </button>
                    <button class="tab-button" data-tab="provisioning">
                        <span class="tab-icon">‚öôÔ∏è</span>
                        <span class="tab-text">Phone Provisioning</span>
                    </button>
                    <button class="tab-button" data-tab="hot-desking">
                        <span class="tab-icon">üîÑ</span>
                        <span class="tab-text">Hot Desking</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Connectivity</div>
                    <button class="tab-button" data-tab="sip-trunks">
                        <span class="tab-icon">üåê</span>
                        <span class="tab-text">SIP Trunks</span>
                    </button>
                    <button class="tab-button" data-tab="least-cost-routing">
                        <span class="tab-icon">üí∞</span>
                        <span class="tab-text">Least-Cost Routing</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Call Routing</div>
                    <button class="tab-button" data-tab="find-me-follow-me">
                        <span class="tab-icon">üîÑ</span>
                        <span class="tab-text">Find Me/Follow Me</span>
                    </button>
                    <button class="tab-button" data-tab="time-routing">
                        <span class="tab-icon">‚è∞</span>
                        <span class="tab-text">Time-Based Routing</span>
                    </button>
                    <button class="tab-button" data-tab="callback-queue">
                        <span class="tab-icon">üìû</span>
                        <span class="tab-text">Callback Queue</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Features</div>
                    <button class="tab-button" data-tab="auto-attendant">
                        <span class="tab-icon">ü§ñ</span>
                        <span class="tab-text">Auto Attendant</span>
                    </button>
                    <button class="tab-button" data-tab="voicemail">
                        <span class="tab-icon">üìß</span>
                        <span class="tab-text">Voicemail</span>
                    </button>
                    <button class="tab-button" data-tab="codecs">
                        <span class="tab-icon">üéµ</span>
                        <span class="tab-text">Codecs</span>
                    </button>
                    <button class="tab-button" data-tab="webhooks">
                        <span class="tab-icon">üîî</span>
                        <span class="tab-text">Webhooks</span>
                    </button>
                    <button class="tab-button" data-tab="recording-retention">
                        <span class="tab-icon">üìÅ</span>
                        <span class="tab-text">Recording Retention</span>
                    </button>
                    <button class="tab-button" data-tab="mobile-push">
                        <span class="tab-icon">üì±</span>
                        <span class="tab-text">Mobile Push</span>
                    </button>
                    <button class="tab-button" data-tab="recording-announcements">
                        <span class="tab-icon">üì¢</span>
                        <span class="tab-text">Recording Announcements</span>
                    </button>
                    <button class="tab-button" data-tab="speech-analytics">
                        <span class="tab-icon">üéôÔ∏è</span>
                        <span class="tab-text">Speech Analytics</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Security</div>
                    <button class="tab-button" data-tab="fraud-detection">
                        <span class="tab-icon">üõ°Ô∏è</span>
                        <span class="tab-text">Fraud Detection</span>
                    </button>
                    <button class="tab-button" data-tab="compliance">
                        <span class="tab-icon">‚úÖ</span>
                        <span class="tab-text">Compliance</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Integrations</div>
                    <button class="tab-button" data-tab="opensource-integrations">
                        <span class="tab-icon">üÜì</span>
                        <span class="tab-text">Open Source (Free)</span>
                    </button>
                    <button class="tab-button" data-tab="jitsi-integration">
                        <span class="tab-icon">üìπ</span>
                        <span class="tab-text">Jitsi (Video)</span>
                    </button>
                    <button class="tab-button" data-tab="matrix-integration">
                        <span class="tab-icon">üí¨</span>
                        <span class="tab-text">Matrix (Chat)</span>
                    </button>
                    <button class="tab-button" data-tab="espocrm-integration">
                        <span class="tab-icon">üë•</span>
                        <span class="tab-text">EspoCRM (CRM)</span>
                    </button>
                    <button class="tab-button" data-tab="crm-integrations">
                        <span class="tab-icon">üîó</span>
                        <span class="tab-text">Proprietary CRMs</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">Framework Features</div>
                    <button class="tab-button" data-tab="framework-overview">
                        <span class="tab-icon">üéØ</span>
                        <span class="tab-text">Overview</span>
                    </button>
                    <button class="tab-button" data-tab="conversational-ai">
                        <span class="tab-icon">ü§ñ</span>
                        <span class="tab-text">Conversational AI</span>
                    </button>
                    <button class="tab-button" data-tab="predictive-dialing">
                        <span class="tab-icon">üìû</span>
                        <span class="tab-text">Predictive Dialing</span>
                    </button>
                    <button class="tab-button" data-tab="voice-biometrics">
                        <span class="tab-icon">üîä</span>
                        <span class="tab-text">Voice Biometrics</span>
                    </button>
                    <button class="tab-button" data-tab="call-quality-prediction">
                        <span class="tab-icon">üìä</span>
                        <span class="tab-text">Quality Prediction</span>
                    </button>
                    <button class="tab-button" data-tab="video-codec">
                        <span class="tab-icon">üé¨</span>
                        <span class="tab-text">Video Codecs</span>
                    </button>
                    <button class="tab-button" data-tab="bi-integration">
                        <span class="tab-icon">üìà</span>
                        <span class="tab-text">BI Integration</span>
                    </button>
                    <button class="tab-button" data-tab="call-tagging">
                        <span class="tab-icon">üè∑Ô∏è</span>
                        <span class="tab-text">Call Tagging</span>
                    </button>
                    <button class="tab-button" data-tab="mobile-apps">
                        <span class="tab-icon">üì±</span>
                        <span class="tab-text">Mobile Apps</span>
                    </button>
                    <button class="tab-button" data-tab="mobile-number-portability">
                        <span class="tab-icon">üîÑ</span>
                        <span class="tab-text">Number Portability</span>
                    </button>
                    <button class="tab-button" data-tab="recording-analytics">
                        <span class="tab-icon">üéôÔ∏è</span>
                        <span class="tab-text">Recording Analytics</span>
                    </button>
                    <button class="tab-button" data-tab="call-blending">
                        <span class="tab-icon">üîÄ</span>
                        <span class="tab-text">Call Blending</span>
                    </button>
                    <button class="tab-button" data-tab="voicemail-drop">
                        <span class="tab-icon">üì≠</span>
                        <span class="tab-text">Voicemail Drop</span>
                    </button>
                    <button class="tab-button" data-tab="geographic-redundancy">
                        <span class="tab-icon">üåç</span>
                        <span class="tab-text">Geo Redundancy</span>
                    </button>
                    <button class="tab-button" data-tab="dns-srv-failover">
                        <span class="tab-icon">üåê</span>
                        <span class="tab-text">DNS SRV Failover</span>
                    </button>
                    <button class="tab-button" data-tab="session-border-controller">
                        <span class="tab-icon">üõ°Ô∏è</span>
                        <span class="tab-text">SBC</span>
                    </button>
                    <button class="tab-button" data-tab="data-residency">
                        <span class="tab-icon">üó∫Ô∏è</span>
                        <span class="tab-text">Data Residency</span>
                    </button>
                    <button class="tab-button" data-tab="video-conferencing">
                        <span class="tab-icon">üìπ</span>
                        <span class="tab-text">Video Conferencing</span>
                    </button>
                    <button class="tab-button" data-tab="team-messaging">
                        <span class="tab-icon">üí¨</span>
                        <span class="tab-text">Team Messaging</span>
                    </button>
                </div>

                <div class="sidebar-section">
                    <div class="sidebar-section-title">System</div>
                    <button class="tab-button" data-tab="config">
                        <span class="tab-icon">üîß</span>
                        <span class="tab-text">Configuration</span>
                    </button>
                </div>
            </nav>

            <!-- Main Content Area -->
            <div class="main-content">
                <!-- Feature Requirements Info Banner -->
        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <h2>System Overview</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="stat-extensions">-</div>
                    <div class="stat-label">Registered Extensions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-calls">-</div>
                    <div class="stat-label">Active Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-total-calls">-</div>
                    <div class="stat-label">Total Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="stat-recordings">-</div>
                    <div class="stat-label">Active Recordings</div>
                </div>
            </div>

            <h3>Active Directory Integration</h3>
            <div class="config-section" id="ad-integration-section">
                <div class="ad-status-grid">
                    <div class="ad-status-item">
                        <strong>Status:</strong> 
                        <span id="ad-status-badge" class="status-badge">Loading...</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Connection:</strong> 
                        <span id="ad-connection-status">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Server:</strong> 
                        <span id="ad-server">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Auto Provision:</strong> 
                        <span id="ad-auto-provision">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Synced Users:</strong> 
                        <span id="ad-synced-users">-</span>
                    </div>
                    <div class="ad-status-item">
                        <strong>Last Error:</strong> 
                        <span id="ad-error" style="color: #d32f2f;">-</span>
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-primary" onclick="refreshADStatus()">üîÑ Refresh AD Status</button>
                    <button class="btn btn-success" onclick="syncADUsers()" id="ad-sync-btn">üîÑ Sync Users from AD</button>
                </div>
            </div>

            <h3>Quick Actions</h3>
            <div class="action-buttons">
                <button class="btn btn-primary" onclick="refreshDashboard()">üîÑ Refresh Status</button>
                <button class="btn btn-success" onclick="showTab('extensions')">‚ûï Add Extension</button>
            </div>
        </div>

        <!-- WebRTC Phone Tab -->
        <div id="webrtc-phone" class="tab-content">
            <h2>üìû WebRTC Browser Phone</h2>
            
            <!-- Microphone Requirement Alert -->
            
            <div class="config-section" style="max-width: 600px; margin: 0 auto;">
                <div class="webrtc-phone-widget">
                    <div class="phone-display">
                        <div class="phone-status-container">
                            <div id="webrtc-status" class="webrtc-status info">Ready to call</div>
                        </div>
                        
                        <div class="phone-input-group" style="margin: 20px 0;">
                            <label for="webrtc-target-ext" style="display: block; margin-bottom: 8px; font-weight: bold;">
                                Call Extension:
                            </label>
                            <input 
                                type="text" 
                                id="webrtc-target-ext" 
                                value="1001" 
                                pattern="[0-9*#]+" 
                                maxlength="16"
                                style="width: 100%; padding: 12px; font-size: 24px; text-align: center; border: 2px solid #ddd; border-radius: 8px;"
                                placeholder="1001"
                            >
                            <small style="display: block; margin-top: 5px; color: #666;">
                                Enter extension (e.g., 0 for auto attendant, 1001 for operator, *1001 for voicemail)
                            </small>
                        </div>

                        <div class="phone-controls" style="display: flex; flex-direction: column; gap: 10px;">
                            <button 
                                id="webrtc-call-btn" 
                                class="btn btn-success" 
                                style="padding: 15px; font-size: 18px; width: 100%;"
                            >
                                üìû Call Extension
                            </button>
                            
                            <button 
                                id="webrtc-hangup-btn" 
                                class="btn btn-danger" 
                                style="padding: 15px; font-size: 18px; width: 100%;" 
                                disabled
                            >
                                üì¥ Hang Up
                            </button>
                            
                            <div style="display: flex; gap: 10px;">
                                <button 
                                    id="webrtc-mute-btn" 
                                    class="btn btn-secondary" 
                                    style="flex: 1; padding: 12px;" 
                                    disabled
                                >
                                    üîá Mute
                                </button>
                                
                                <div style="flex: 2; display: flex; align-items: center; gap: 10px; padding: 0 10px; background: #f5f5f5; border-radius: 4px;">
                                    <label for="webrtc-volume" style="white-space: nowrap;">üîä Volume:</label>
                                    <input 
                                        type="range" 
                                        id="webrtc-volume" 
                                        min="0" 
                                        max="100" 
                                        value="80" 
                                        style="flex: 1;"
                                    >
                                </div>
                            </div>
                        </div>
                        
                        <!-- DTMF Keypad -->
                        <div id="webrtc-keypad-section" style="margin-top: 25px; display: none;">
                            <h3 style="text-align: center; margin-bottom: 15px;">üì± Dial Pad</h3>
                            <div class="webrtc-keypad">
                                <button class="keypad-btn" data-digit="1">1</button>
                                <button class="keypad-btn" data-digit="2">2<span>ABC</span></button>
                                <button class="keypad-btn" data-digit="3">3<span>DEF</span></button>
                                <button class="keypad-btn" data-digit="4">4<span>GHI</span></button>
                                <button class="keypad-btn" data-digit="5">5<span>JKL</span></button>
                                <button class="keypad-btn" data-digit="6">6<span>MNO</span></button>
                                <button class="keypad-btn" data-digit="7">7<span>PQRS</span></button>
                                <button class="keypad-btn" data-digit="8">8<span>TUV</span></button>
                                <button class="keypad-btn" data-digit="9">9<span>WXYZ</span></button>
                                <button class="keypad-btn" data-digit="*">*</button>
                                <button class="keypad-btn" data-digit="0">0<span>+</span></button>
                                <button class="keypad-btn" data-digit="#">#</button>
                            </div>
                            <div style="text-align: center; margin-top: 10px; font-size: 12px; color: #666;">
                                Press buttons to send DTMF tones during call
                            </div>
                        </div>
                    </div>

                    <!-- Remote audio element for call audio -->
                    <audio id="webrtc-remote-audio" autoplay playsinline></audio>
                </div>

                <div class="info-box" style="margin-top: 30px;">
                    <h3>üìã Instructions</h3>
                    <ol>
                        <li>Enter the extension number you want to call (default is 1001 - Operator)</li>
                        <li>Click "üìû Call Extension" to start the call</li>
                        <li>Allow microphone access when your browser prompts you</li>
                        <li>Wait for the call to connect</li>
                        <li>Use the controls to mute/unmute or adjust volume</li>
                        <li>Click "üì¥ Hang Up" when you're done</li>
                    </ol>
                    
                    <h3 style="margin-top: 20px;">üîß Troubleshooting</h3>
                    <ul>
                        <li><strong>No audio:</strong> Check your microphone permissions in browser settings</li>
                        <li><strong>Can't connect:</strong> Ensure WebRTC is enabled in Configuration tab</li>
                        <li><strong>Call not ringing:</strong> Verify the target extension exists and is registered</li>
                        <li><strong>Echo or feedback:</strong> Use headphones to prevent audio feedback</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Analytics Tab -->
        <div id="analytics" class="tab-content">
            <h2>Call Analytics & Statistics</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <label>Time Period: 
                    <select id="analytics-period" onchange="loadAnalytics()">
                        <option value="1">Last 24 Hours</option>
                        <option value="7" selected>Last 7 Days</option>
                        <option value="30">Last 30 Days</option>
                    </select>
                </label>
                <button class="btn btn-primary" onclick="loadAnalytics()">üîÑ Refresh Analytics</button>
            </div>

            <!-- Overview Stats -->
            <div class="stats-grid" id="analytics-stats">
                <div class="stat-card">
                    <div class="stat-value" id="analytics-total-calls">-</div>
                    <div class="stat-label">Total Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="analytics-answered-calls">-</div>
                    <div class="stat-label">Answered Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="analytics-answer-rate">-</div>
                    <div class="stat-label">Answer Rate</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="analytics-avg-duration">-</div>
                    <div class="stat-label">Avg Call Duration</div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-container">
                <div class="chart-box">
                    <h3>Daily Call Trends</h3>
                    <canvas id="daily-trends-chart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>Hourly Call Distribution</h3>
                    <canvas id="hourly-distribution-chart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>Call Disposition Breakdown</h3>
                    <canvas id="disposition-chart"></canvas>
                </div>
                
                <div class="chart-box">
                    <h3>Call Quality Metrics</h3>
                    <canvas id="quality-chart"></canvas>
                </div>
            </div>

            <!-- Top Callers Table -->
            <div class="config-section">
                <h3>Top Callers</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Extension</th>
                                <th>Total Calls</th>
                                <th>Total Duration (min)</th>
                                <th>Avg Duration (sec)</th>
                            </tr>
                        </thead>
                        <tbody id="top-callers-table">
                            <tr>
                                <td colspan="4" class="loading">Loading top callers...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Peak Hours -->
            <div class="config-section">
                <h3>Peak Call Hours</h3>
                <div id="peak-hours-display" class="info-box">
                    Loading peak hours...
                </div>
            </div>
        </div>

        <!-- QoS (Call Quality) Tab -->
        <div id="qos" class="tab-content">
            <h2>Call Quality Monitoring (QoS)</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadQoSMetrics()">üîÑ Refresh Metrics</button>
                <button class="btn btn-secondary" onclick="clearQoSAlerts()">üóëÔ∏è Clear Alerts</button>
            </div>

            <!-- QoS Overview Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-value" id="qos-active-calls">-</div>
                    <div class="stat-label">Active Monitored Calls</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="qos-total-calls">-</div>
                    <div class="stat-label">Total Calls Monitored</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="qos-avg-mos">-</div>
                    <div class="stat-label">Average MOS Score</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="qos-calls-with-issues">-</div>
                    <div class="stat-label">Calls with Issues</div>
                </div>
            </div>

            <!-- Active Call Quality -->
            <div class="config-section">
                <h3>üî¥ Active Call Quality</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Call ID</th>
                                <th>Duration</th>
                                <th>MOS Score</th>
                                <th>Quality</th>
                                <th>Packet Loss %</th>
                                <th>Jitter (ms)</th>
                                <th>Latency (ms)</th>
                            </tr>
                        </thead>
                        <tbody id="qos-active-calls-table">
                            <tr>
                                <td colspan="7" class="loading">Loading active call metrics...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- QoS Alerts -->
            <div class="config-section">
                <h3>‚ö†Ô∏è Quality Alerts</h3>
                <div id="qos-alerts-container">
                    <div class="info-box">Loading alerts...</div>
                </div>
            </div>

            <!-- Historical Call Quality -->
            <div class="config-section">
                <h3>üìä Recent Call Quality History</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Call ID</th>
                                <th>Start Time</th>
                                <th>Duration</th>
                                <th>MOS Score</th>
                                <th>Quality</th>
                                <th>Packet Loss %</th>
                                <th>Jitter (ms)</th>
                                <th>Latency (ms)</th>
                            </tr>
                        </thead>
                        <tbody id="qos-history-table">
                            <tr>
                                <td colspan="8" class="loading">Loading call history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- QoS Alert Thresholds -->
            <div class="config-section">
                <h3>‚öôÔ∏è Alert Threshold Configuration</h3>
                <form id="qos-thresholds-form" onsubmit="saveQoSThresholds(event)">
                    <div class="form-group">
                        <label>Minimum MOS Score (alert below):</label>
                        <input type="number" id="qos-threshold-mos" step="0.1" min="1.0" max="5.0" value="3.5">
                        <small>Alert when MOS score drops below this value (1.0 - 5.0)</small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Packet Loss % (alert above):</label>
                        <input type="number" id="qos-threshold-loss" step="0.1" min="0" max="100" value="2.0">
                        <small>Alert when packet loss exceeds this percentage</small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Jitter ms (alert above):</label>
                        <input type="number" id="qos-threshold-jitter" step="1" min="0" max="500" value="50">
                        <small>Alert when jitter exceeds this value in milliseconds</small>
                    </div>
                    <div class="form-group">
                        <label>Maximum Latency ms (alert above):</label>
                        <input type="number" id="qos-threshold-latency" step="1" min="0" max="1000" value="300">
                        <small>Alert when latency exceeds this value in milliseconds</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Thresholds</button>
                </form>
            </div>

            <!-- QoS Info Box -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è About QoS Monitoring</h3>
                <div class="info-box">
                    <p><strong>MOS Score (Mean Opinion Score):</strong> A rating from 1.0 (bad) to 5.0 (excellent) that represents perceived call quality.</p>
                    <ul>
                        <li><strong>4.3-5.0:</strong> Excellent - No perceptible quality issues</li>
                        <li><strong>4.0-4.3:</strong> Good - Minor impairments, acceptable quality</li>
                        <li><strong>3.6-4.0:</strong> Fair - Noticeable but tolerable impairments</li>
                        <li><strong>3.1-3.6:</strong> Poor - Quality significantly affected</li>
                        <li><strong>1.0-3.1:</strong> Bad - Severe quality issues</li>
                        <li><strong>0.0:</strong> No Audio - No RTP packets received (one-way audio issue)</li>
                    </ul>
                    <p><strong>Packet Loss:</strong> Percentage of packets that didn't arrive. Above 2% can cause noticeable quality degradation.</p>
                    <p><strong>Jitter:</strong> Variation in packet arrival times. High jitter (>50ms) causes choppy audio.</p>
                    <p><strong>Latency:</strong> Round-trip delay. Above 300ms can cause conversational difficulties.</p>
                    
                    <h4 style="margin-top: 20px;">üìä Understanding Bidirectional Call Quality</h4>
                    <p>Each call is monitored in <strong>both directions</strong> (A‚ÜíB and B‚ÜíA) separately. This helps diagnose:</p>
                    <ul>
                        <li><strong>One-Way Audio:</strong> When one direction shows MOS 0.00, audio is only flowing in one direction</li>
                        <li><strong>Asymmetric Quality:</strong> Different quality in each direction may indicate network routing issues</li>
                        <li><strong>Firewall/NAT Issues:</strong> One direction working but not the other suggests port forwarding problems</li>
                    </ul>
                    
                    <h4 style="margin-top: 20px;">üîß Troubleshooting One-Way Audio</h4>
                    <p>If you see <strong>MOS 0.00 in one direction</strong>:</p>
                    <ol>
                        <li><strong>Check Firewall:</strong> Ensure UDP ports 10000-20000 are open bidirectionally</li>
                        <li><strong>Verify NAT:</strong> Check that symmetric RTP is enabled and working</li>
                        <li><strong>Inspect Network:</strong> Use <code>tcpdump -n udp portrange 10000-20000</code> to verify RTP packets</li>
                        <li><strong>Check Codec:</strong> Ensure both endpoints support the negotiated codec</li>
                        <li><strong>Review Logs:</strong> Look for RTP handler errors in system logs</li>
                    </ol>
                </div>
            </div>
        </div>

        <!-- Emergency Notification Tab -->
        <div id="emergency" class="tab-content">
            <h2>üö® Emergency Notification System</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadEmergencyContacts()">üîÑ Refresh Contacts</button>
                <button class="btn btn-warning" onclick="testEmergencyNotification()">üß™ Test System</button>
                <button class="btn btn-danger" onclick="showTriggerEmergencyModal()">üö® Trigger Emergency</button>
            </div>

            <!-- Emergency System Status -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="emergency-contacts-count">-</div>
                    <div class="stat-label">Emergency Contacts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emergency-notifications-sent">-</div>
                    <div class="stat-label">Notifications Sent</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emergency-last-test">-</div>
                    <div class="stat-label">Last Test</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="emergency-system-status">üü¢ Active</div>
                    <div class="stat-label">System Status</div>
                </div>
            </div>

            <!-- Emergency Contacts -->
            <div class="config-section">
                <div class="section-header">
                    <h3>üìã Emergency Contact List</h3>
                    <button class="btn btn-success" onclick="showAddEmergencyContactModal()">‚ûï Add Contact</button>
                </div>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p><strong>Emergency contacts</strong> will be notified automatically when:</p>
                    <ul>
                        <li>üö® Someone dials 911 from the system</li>
                        <li>‚ö†Ô∏è A panic button is activated</li>
                        <li>üî¥ An emergency notification is manually triggered</li>
                    </ul>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Priority</th>
                                <th>Name</th>
                                <th>Extension</th>
                                <th>Phone</th>
                                <th>Email</th>
                                <th>Notification Methods</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="emergency-contacts-table">
                            <tr>
                                <td colspan="7" class="loading">Loading emergency contacts...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Emergency Notification History -->
            <div class="config-section">
                <h3>üìú Notification History</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Trigger Type</th>
                                <th>Details</th>
                                <th>Contacts Notified</th>
                                <th>Methods Used</th>
                            </tr>
                        </thead>
                        <tbody id="emergency-history-table">
                            <tr>
                                <td colspan="5" class="loading">Loading notification history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Emergency Information -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è Emergency Notification Information</h3>
                <div class="info-box">
                    <h4>Priority Levels</h4>
                    <ul>
                        <li><strong>Priority 1 (Highest):</strong> First responders, security personnel</li>
                        <li><strong>Priority 2:</strong> Management, supervisors</li>
                        <li><strong>Priority 3:</strong> HR, facilities</li>
                        <li><strong>Priority 4-5:</strong> Additional contacts</li>
                    </ul>
                    
                    <h4>Notification Methods</h4>
                    <ul>
                        <li><strong>Call:</strong> Automated voice call to extension or phone</li>
                        <li><strong>Page:</strong> Overhead paging announcement</li>
                        <li><strong>Email:</strong> Emergency notification email</li>
                        <li><strong>SMS:</strong> Text message alert (requires configuration)</li>
                    </ul>
                    
                    <h4>911 Detection</h4>
                    <p>When someone dials 911 from any extension, all emergency contacts are automatically notified with:</p>
                    <ul>
                        <li>Caller's extension and name</li>
                        <li>Time of call</li>
                        <li>Location information (if available)</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Extensions Tab -->
        <div id="extensions" class="tab-content">
            <div class="section-header">
                <h2>Extension Management</h2>
                <div>
                    <button class="btn btn-success" onclick="showAddExtensionModal()">‚ûï Add Extension</button>
                    <button class="btn btn-secondary" onclick="rebootAllPhones()">üîÑ Reboot All Phones</button>
                </div>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Number</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Status</th>
                            <th>External</th>
                            <th>VM PIN</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="extensions-table-body">
                        <tr>
                            <td colspan="7" class="loading">Loading extensions...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Registered Phones Tab -->
        <div id="phones" class="tab-content">
            <div class="section-header">
                <h2>Registered Phones (Database)</h2>
                <button class="btn btn-primary" onclick="loadRegisteredPhones()">üîÑ Refresh</button>
            </div>

            <div class="table-container">
                <table class="data-table">
                    <thead>
                        <tr>
                            <th>Extension</th>
                            <th>IP Address</th>
                            <th>MAC Address</th>
                            <th>User Agent</th>
                            <th>Last Registration</th>
                        </tr>
                    </thead>
                    <tbody id="registered-phones-table-body">
                        <tr>
                            <td colspan="5" class="loading">Loading registered phones...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Phone Provisioning Tab -->
        <div id="provisioning" class="tab-content">
            <div class="section-header">
                <h2>Phone Auto-Provisioning Setup</h2>
                <button class="btn btn-primary" onclick="loadProvisioningDevices()">üîÑ Refresh</button>
            </div>

            <div class="config-section">
                <h3>Provisioning Settings</h3>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="provisioning-enabled" onchange="toggleProvisioningEnabled()">
                        Enable Auto-Provisioning
                    </label>
                </div>
                <div id="provisioning-settings" style="display: none;">
                    <div class="form-group">
                        <label>Server IP Address:</label>
                        <input type="text" id="provisioning-server-ip" placeholder="192.168.1.14">
                        <small>IP address that phones will use to download configuration</small>
                    </div>
                    <div class="form-group">
                        <label>API Port:</label>
                        <input type="number" id="provisioning-port" value="8080">
                    </div>
                    <div class="form-group">
                        <label>Provisioning URL Format:</label>
                        <input type="text" id="provisioning-url-format" readonly>
                        <small>Phones will download from: SERVER:PORT/provision/{mac}.cfg (protocol auto-detected)</small>
                    </div>
                    <div class="form-group">
                        <label>Custom Templates Directory (optional):</label>
                        <input type="text" id="provisioning-custom-dir" placeholder="custom_templates">
                    </div>
                    <button class="btn btn-success" onclick="saveProvisioningSettings()">üíæ Save Settings</button>
                </div>
            </div>

            <div class="config-section">
                <h3>Phone Book Configuration for IP Phones</h3>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>üìñ Configure how phones access the company directory. Two methods are supported:</p>
                    <ul>
                        <li><strong>LDAPS:</strong> Direct LDAP/LDAPS server connection (Primary method)</li>
                        <li><strong>Remote URL:</strong> HTTP/HTTPS XML feed from PBX (Fallback method)</li>
                    </ul>
                    <p>üí° Both methods can be enabled simultaneously for redundancy.</p>
                </div>
                
                <!-- LDAPS Configuration -->
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="ldap-phonebook-enabled" onchange="toggleLdapPhonebookSettings()">
                        Enable LDAPS Phone Book
                    </label>
                    <small>Allow phones to directly query LDAP directory (Recommended for Zultys 33G/37G)</small>
                </div>
                
                <div id="ldap-phonebook-settings" style="display: none; margin-left: 20px; border-left: 3px solid #007bff; padding-left: 15px;">
                    <div class="form-group">
                        <label>LDAP Server:</label>
                        <input type="text" id="ldap-phonebook-server" placeholder="ldaps://192.168.1.22">
                        <small>Use ldaps:// for secure connection (recommended)</small>
                    </div>
                    <div class="form-group">
                        <label>LDAP Port:</label>
                        <input type="number" id="ldap-phonebook-port" placeholder="636">
                        <small>636 for LDAPS (SSL), 389 for plain LDAP</small>
                    </div>
                    <div class="form-group">
                        <label>Base DN:</label>
                        <input type="text" id="ldap-phonebook-base" placeholder="DC=company,DC=com">
                        <small>Base distinguished name for directory searches</small>
                    </div>
                    <div class="form-group">
                        <label>Bind User (DN):</label>
                        <input type="text" id="ldap-phonebook-user" placeholder="CN=phonebook,CN=Users,DC=company,DC=com">
                        <small>User account for phone authentication (use read-only account)</small>
                    </div>
                    <div class="form-group">
                        <label>Bind Password:</label>
                        <input type="password" id="ldap-phonebook-password" placeholder="Enter password">
                        <small>‚ö†Ô∏è Store securely in .env file as LDAP_PHONEBOOK_PASSWORD</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ldap-phonebook-tls" checked>
                            Use SSL/TLS (LDAPS)
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Display Name:</label>
                        <input type="text" id="ldap-phonebook-display-name" placeholder="Company Directory">
                        <small>Name shown on phone display</small>
                    </div>
                </div>
                
                <!-- Remote Phone Book URL Configuration -->
                <div class="form-group" style="margin-top: 20px;">
                    <label>
                        <input type="checkbox" id="remote-phonebook-enabled" onchange="toggleRemotePhonebookSettings()">
                        Enable Remote Phone Book URL
                    </label>
                    <small>Provide HTTP/HTTPS URL for phones to fetch XML directory (Fallback)</small>
                </div>
                
                <div id="remote-phonebook-settings" style="display: none; margin-left: 20px; border-left: 3px solid #28a745; padding-left: 15px;">
                    <div class="form-group">
                        <label>Phone Book URL:</label>
                        <input type="text" id="remote-phonebook-url" readonly>
                        <small>Automatically configured based on server settings</small>
                    </div>
                    <div class="form-group">
                        <label>Refresh Interval (minutes):</label>
                        <input type="number" id="remote-phonebook-refresh" placeholder="60" min="1" max="1440">
                        <small>How often phones should refresh the directory (1-1440 minutes)</small>
                    </div>
                </div>
                
                <button class="btn btn-success" onclick="savePhonebookSettings()">üíæ Save Phone Book Settings</button>
            </div>

            <div class="config-section">
                <h3>Supported Phone Models</h3>
                <div id="supported-vendors-list" class="info-box">
                    <p>Loading supported vendors...</p>
                </div>
            </div>

            <div class="config-section">
                <div class="section-header">
                    <h3>Provisioning Templates</h3>
                    <div>
                        <button class="btn btn-primary" onclick="loadProvisioningTemplates()">üîÑ Refresh Templates</button>
                        <button class="btn btn-success" onclick="reloadTemplates()">‚ôªÔ∏è Reload from Disk</button>
                    </div>
                </div>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>üìÅ <strong>Templates Location:</strong> <code>provisioning_templates/</code></p>
                    <p>Templates contain placeholders like <code>{{EXTENSION_NUMBER}}</code>, <code>{{EXTENSION_NAME}}</code>, <code>{{SIP_SERVER}}</code> that are automatically replaced with device-specific information when a phone requests configuration.</p>
                    <p>üí° <strong>Tip:</strong> Export a built-in template, customize it, and reload to use your custom version.</p>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Vendor</th>
                                <th>Model</th>
                                <th>Type</th>
                                <th>Size</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="templates-table-body">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh Templates" to load templates</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <div class="section-header">
                    <h3>Provisioned Devices</h3>
                    <button class="btn btn-success" onclick="showAddDeviceModal()">‚ûï Add Device</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>MAC Address</th>
                                <th>Extension</th>
                                <th>Vendor</th>
                                <th>Model</th>
                                <th>Created</th>
                                <th>Last Provisioned</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="provisioning-devices-table-body">
                            <tr>
                                <td colspan="7" class="loading">Loading provisioned devices...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>Next Steps</h3>
                <div class="info-box">
                    <ol>
                        <li><strong>Configure DHCP Server:</strong> Set Option 66 to provide the provisioning URL to phones automatically</li>
                        <li><strong>Add Devices:</strong> Register each phone with its MAC address and extension number</li>
                        <li><strong>Reboot Phones:</strong> Phones will automatically download their configuration on boot</li>
                        <li><strong>Alternative:</strong> Manually configure provisioning URL in each phone's settings</li>
                    </ol>
                    <p>üìö For detailed instructions, see <a href="https://github.com/mattiIce/PBX/blob/main/PHONE_PROVISIONING.md" target="_blank">PHONE_PROVISIONING.md</a></p>
                </div>
            </div>
        </div>

        <!-- Auto Attendant Tab -->
        <div id="auto-attendant" class="tab-content">
            <div class="section-header">
                <h2>Auto Attendant Configuration</h2>
                <button class="btn btn-primary" onclick="loadAutoAttendantConfig()">üîÑ Refresh</button>
            </div>

            <div class="config-section">
                <h3>üìû General Settings</h3>
                <form id="auto-attendant-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="aa-enabled">
                            Enable Auto Attendant
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Extension Number:</label>
                        <input type="text" id="aa-extension" placeholder="0" pattern="[0-9]+" maxlength="4">
                        <small>Extension number for auto attendant (e.g., 0 for main line)</small>
                    </div>
                    <div class="form-group">
                        <label>Timeout (seconds):</label>
                        <input type="number" id="aa-timeout" min="5" max="60" value="10">
                        <small>How long to wait for DTMF input before repeating menu</small>
                    </div>
                    <div class="form-group">
                        <label>Max Retries:</label>
                        <input type="number" id="aa-max-retries" min="1" max="10" value="3">
                        <small>Maximum number of invalid attempts before transferring to operator</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Settings</button>
                </form>
            </div>

            <div class="config-section">
                <div class="section-header">
                    <h3>üéØ Menu Options</h3>
                    <button class="btn btn-success" onclick="showAddMenuOptionModal()">‚ûï Add Menu Option</button>
                </div>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>Configure what happens when callers press digits on their phone.</p>
                    <p><strong>Example:</strong> Press 1 for Sales (ext 1001), Press 2 for Support (ext 1002)</p>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Digit</th>
                                <th>Destination</th>
                                <th>Description</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="aa-menu-options-table-body">
                            <tr>
                                <td colspan="4" class="loading">Loading menu options...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>üéµ Voice Prompts Configuration</h3>
                <div class="info-box">
                    <p><strong>üé§ Voice Generation:</strong> Voice prompts are automatically generated using gTTS (Google Text-to-Speech) when you save changes.</p>
                    <p><strong>üìÅ Location:</strong> <code>auto_attendant/</code> directory</p>
                </div>
                <form id="auto-attendant-prompts-form">
                    <div class="form-group">
                        <label>Company Name:</label>
                        <input type="text" id="aa-company-name" placeholder="Your Company" maxlength="100">
                        <small>Used in the welcome greeting</small>
                    </div>
                    <div class="form-group">
                        <label>Welcome Greeting Text:</label>
                        <textarea id="aa-prompt-welcome" rows="2" placeholder="Thank you for calling {company_name}."></textarea>
                        <small>Use {company_name} placeholder for company name</small>
                    </div>
                    <div class="form-group">
                        <label>Main Menu Text:</label>
                        <textarea id="aa-prompt-main-menu" rows="3" placeholder="For Sales, press 1. For Support, press 2. For Accounting, press 3. Or press 0 to speak with an operator."></textarea>
                        <small>Describe your menu options to callers</small>
                    </div>
                    <div class="form-group">
                        <label>Invalid Option Text:</label>
                        <textarea id="aa-prompt-invalid" rows="2" placeholder="That is not a valid option. Please try again."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Timeout Text:</label>
                        <textarea id="aa-prompt-timeout" rows="2" placeholder="We did not receive your selection. Please try again."></textarea>
                    </div>
                    <div class="form-group">
                        <label>Transferring Text:</label>
                        <textarea id="aa-prompt-transferring" rows="2" placeholder="Please hold while we transfer your call."></textarea>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save & Regenerate Voices</button>
                </form>
                <div id="voice-generation-status" style="margin-top: 15px; display: none;">
                    <div class="info-box">
                        <p id="voice-generation-message">‚è≥ Generating voices using gTTS...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Voicemail Tab -->
        <div id="voicemail" class="tab-content">
            <div class="section-header">
                <h2>Voicemail Management</h2>
                <div>
                    <label for="vm-extension-select">Extension: </label>
                    <select id="vm-extension-select" onchange="loadVoicemailForExtension()">
                        <option value="">Select Extension</option>
                    </select>
                    <button class="btn btn-primary" onclick="loadVoicemailForExtension()">üîÑ Refresh</button>
                </div>
            </div>

            <div id="voicemail-box-overview" class="config-section" style="display: none;">
                <h3>Mailbox Overview</h3>
                <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                    <div class="stat-card">
                        <div class="stat-value" id="vm-total-messages">-</div>
                        <div class="stat-label">Total Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vm-unread-messages">-</div>
                        <div class="stat-label">Unread Messages</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="vm-has-greeting">-</div>
                        <div class="stat-label">Custom Greeting</div>
                    </div>
                </div>
                <div class="action-buttons" style="margin-top: 15px;">
                    <button class="btn btn-success" onclick="exportVoicemailBox()">üì¶ Export All Voicemails</button>
                    <button class="btn btn-warning" onclick="clearVoicemailBox()">üóëÔ∏è Clear All Messages</button>
                </div>
            </div>

            <div id="voicemail-pin-section" class="config-section" style="display: none;">
                <h3>Voicemail PIN Management</h3>
                <form id="voicemail-pin-form">
                    <div class="form-group">
                        <label>Current Extension: <span id="vm-current-extension"></span></label>
                    </div>
                    <div class="form-group">
                        <label>New PIN (4 digits):</label>
                        <input type="text" id="vm-pin" pattern="[0-9]{4}" maxlength="4" placeholder="1234" required>
                    </div>
                    <button type="submit" class="btn btn-primary">üíæ Update PIN</button>
                </form>
            </div>

            <div id="voicemail-messages-section" style="display: none;">
                <h3>Voicemail Messages</h3>
                <div class="action-buttons" style="margin-bottom: 15px;">
                    <button class="btn btn-secondary" onclick="toggleVoicemailView()">
                        <span id="view-toggle-text">üìã Switch to Table View</span>
                    </button>
                </div>
                
                <!-- Card View (Visual Voicemail) -->
                <div id="voicemail-cards-view" class="voicemail-cards-container">
                    <!-- Voicemail cards will be inserted here -->
                    <div class="info-box">Select an extension to view voicemails</div>
                </div>
                
                <!-- Table View (Legacy) -->
                <div id="voicemail-table-view" class="table-container" style="display: none;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>From</th>
                                <th>Duration</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="voicemail-table-body">
                            <tr>
                                <td colspan="5" class="loading">Select an extension to view voicemails</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            
            <!-- Audio Player Modal -->
            <div id="voicemail-player-modal" class="modal">
                <div class="modal-content" style="max-width: 600px;">
                    <div class="modal-header">
                        <h3>üéµ Voicemail Player</h3>
                        <span class="close" onclick="closeVoicemailPlayer()">&times;</span>
                    </div>
                    <div style="padding: 20px;">
                        <div id="vm-player-details" class="info-box" style="margin-bottom: 15px;">
                            <!-- Message details will be inserted here -->
                        </div>
                        <audio id="vm-audio-player" controls style="width: 100%; margin-bottom: 15px;">
                            Your browser does not support the audio element.
                        </audio>
                        <div id="vm-transcription-display" style="display: none;">
                            <h4>üìù Transcription</h4>
                            <div class="transcription-box">
                                <p id="vm-transcription-text"></p>
                                <small id="vm-transcription-confidence" style="color: #6b7280;"></small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Active Calls Tab -->
        <div id="calls" class="tab-content">
            <div class="section-header">
                <h2>Active Calls</h2>
                <button class="btn btn-primary" onclick="loadCalls()">üîÑ Refresh</button>
            </div>

            <div class="table-container">
                <div id="calls-list" class="calls-list">
                    <div class="loading">Loading calls...</div>
                </div>
            </div>
        </div>

        <!-- Hot Desking Tab -->
        <div id="hot-desking" class="tab-content">
            <h2>üîÑ Hot Desking</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadHotDeskSessions()">üîÑ Refresh Sessions</button>
            </div>

            <!-- Hot Desk Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="hotdesk-active">-</div>
                    <div class="stat-label">Active Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="hotdesk-total">-</div>
                    <div class="stat-label">Total Sessions</div>
                </div>
            </div>

            <!-- Active Sessions List -->
            <div class="config-section">
                <h3>üìã Active Hot Desk Sessions</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Extension</th>
                                <th>Device MAC</th>
                                <th>IP Address</th>
                                <th>Login Time</th>
                                <th>Duration</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="hotdesk-sessions-list">
                            <tr>
                                <td colspan="6" style="text-align: center;">Loading sessions...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Hot Desking</h3>
                <p><strong>Hot Desking</strong> allows users to log into any phone with their extension credentials, making their settings and contacts available.</p>
                <ul>
                    <li><strong>Flexible Workspace:</strong> Log in from any desk or phone</li>
                    <li><strong>Settings Migration:</strong> Personal settings follow the user</li>
                    <li><strong>Auto-Logout:</strong> Configurable timeout for security</li>
                    <li><strong>Session Tracking:</strong> Monitor active sessions</li>
                </ul>
            </div>
        </div>

        <!-- Codecs Tab -->
        <!-- Find Me/Follow Me Tab -->
        <div id="find-me-follow-me" class="tab-content">
            <h2>üîÑ Find Me/Follow Me</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadFMFMExtensions()">üîÑ Refresh</button>
                <button class="btn btn-success" onclick="showAddFMFMModal()">‚ûï Configure Extension</button>
            </div>

            <!-- FMFM Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="fmfm-total-extensions">-</div>
                    <div class="stat-label">Extensions with FMFM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fmfm-sequential">-</div>
                    <div class="stat-label">Sequential Mode</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fmfm-simultaneous">-</div>
                    <div class="stat-label">Simultaneous Mode</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fmfm-enabled">-</div>
                    <div class="stat-label">Active Configurations</div>
                </div>
            </div>

            <!-- FMFM Configurations List -->
            <div class="config-section">
                <h3>üìã Configured Extensions</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Extension</th>
                                <th>Mode</th>
                                <th>Destinations</th>
                                <th>Status</th>
                                <th>Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="fmfm-list">
                            <tr>
                                <td colspan="6" style="text-align: center;">Loading configurations...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Find Me/Follow Me</h3>
                <p><strong>Find Me/Follow Me (FMFM)</strong> allows calls to ring multiple numbers to ensure you never miss important calls.</p>
                <ul>
                    <li><strong>Sequential Mode:</strong> Rings destinations one at a time in order</li>
                    <li><strong>Simultaneous Mode:</strong> Rings all destinations at the same time</li>
                    <li><strong>Ring Time:</strong> How long to ring each destination before moving to the next (sequential mode)</li>
                    <li><strong>Use Cases:</strong> Mobile forwarding, team hunt groups, executive assistants</li>
                </ul>
            </div>
        </div>

        <!-- Time-Based Routing Tab -->
        <div id="time-routing" class="tab-content">
            <h2>‚è∞ Time-Based Routing</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadTimeRoutingRules()">üîÑ Refresh</button>
                <button class="btn btn-success" onclick="showAddTimeRuleModal()">‚ûï Add Rule</button>
            </div>

            <!-- Time Routing Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="time-routing-total">-</div>
                    <div class="stat-label">Total Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="time-routing-active">-</div>
                    <div class="stat-label">Active Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="time-routing-business">-</div>
                    <div class="stat-label">Business Hours Rules</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="time-routing-after">-</div>
                    <div class="stat-label">After Hours Rules</div>
                </div>
            </div>

            <!-- Time Routing Rules List -->
            <div class="config-section">
                <h3>üìã Routing Rules</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Destination</th>
                                <th>Route To</th>
                                <th>Schedule</th>
                                <th>Priority</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="time-routing-list">
                            <tr>
                                <td colspan="7" style="text-align: center;">Loading rules...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Time-Based Routing</h3>
                <p><strong>Time-Based Routing</strong> directs calls differently based on the time of day, day of week, or holidays.</p>
                <ul>
                    <li><strong>Business Hours:</strong> Route to extensions or queues during business hours</li>
                    <li><strong>After Hours:</strong> Route to voicemail or answering service outside business hours</li>
                    <li><strong>Holidays:</strong> Special routing for holidays and special dates</li>
                    <li><strong>Priority:</strong> Lower number = higher priority when multiple rules apply</li>
                </ul>
            </div>
        </div>

        <!-- SIP Trunks Tab -->
        <div id="sip-trunks" class="tab-content">
            <h2>üåê SIP Trunk Management</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadSIPTrunks()">üîÑ Refresh Trunks</button>
                <button class="btn btn-success" onclick="showAddTrunkModal()">‚ûï Add Trunk</button>
                <button class="btn btn-secondary" onclick="loadTrunkHealth()">üìä View Health</button>
            </div>

            <!-- Trunk Overview Stats -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="trunk-total">-</div>
                    <div class="stat-label">Total Trunks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="trunk-healthy">-</div>
                    <div class="stat-label">Healthy Trunks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="trunk-registered">-</div>
                    <div class="stat-label">Registered</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="trunk-channels">-</div>
                    <div class="stat-label">Available Channels</div>
                </div>
            </div>

            <!-- Active Trunks List -->
            <div class="config-section">
                <h3>üìã SIP Trunks</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Host</th>
                                <th>Status</th>
                                <th>Health</th>
                                <th>Priority</th>
                                <th>Channels</th>
                                <th>Success Rate</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="trunks-list">
                            <tr>
                                <td colspan="8" style="text-align: center;">Loading trunks...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Trunk Health Monitoring -->
            <div class="config-section" id="trunk-health-section" style="display: none;">
                <h3>üìä Trunk Health Monitoring</h3>
                <div id="trunk-health-container"></div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About SIP Trunks</h3>
                <p><strong>SIP Trunks</strong> provide external connectivity for making and receiving calls outside the PBX system.</p>
                <ul>
                    <li><strong>Priority:</strong> Lower numbers = higher priority for call routing</li>
                    <li><strong>Health Monitoring:</strong> Automatic monitoring detects trunk failures</li>
                    <li><strong>Failover:</strong> Calls automatically route to backup trunks on failure</li>
                    <li><strong>Channels:</strong> Maximum concurrent calls per trunk</li>
                </ul>
            </div>
        </div>

        <!-- Least-Cost Routing Tab -->
        <div id="least-cost-routing" class="tab-content">
            <h2>üí∞ Least-Cost Routing (LCR)</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadLCRRates()">üîÑ Refresh Rates</button>
                <button class="btn btn-success" onclick="showAddLCRRateModal()">‚ûï Add Rate</button>
                <button class="btn btn-success" onclick="showAddTimeRateModal()">‚è∞ Add Time-Based Rate</button>
                <button class="btn btn-danger" onclick="clearLCRRates()">üóëÔ∏è Clear All Rates</button>
            </div>

            <!-- LCR Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="lcr-total-rates">-</div>
                    <div class="stat-label">Rate Entries</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lcr-total-routes">-</div>
                    <div class="stat-label">Total Routes</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lcr-time-rates">-</div>
                    <div class="stat-label">Time-Based Rates</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="lcr-status">-</div>
                    <div class="stat-label">Status</div>
                </div>
            </div>

            <!-- Rate Entries -->
            <div class="config-section">
                <h3>üìã Rate Database</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Trunk</th>
                                <th>Pattern</th>
                                <th>Description</th>
                                <th>Rate/Min</th>
                                <th>Connection Fee</th>
                                <th>Min Seconds</th>
                                <th>Billing Inc</th>
                            </tr>
                        </thead>
                        <tbody id="lcr-rates-list">
                            <tr>
                                <td colspan="7" style="text-align: center;">Loading rates...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Time-Based Rates -->
            <div class="config-section">
                <h3>‚è∞ Time-Based Rate Modifiers</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Period Name</th>
                                <th>Start Time</th>
                                <th>End Time</th>
                                <th>Days of Week</th>
                                <th>Rate Multiplier</th>
                            </tr>
                        </thead>
                        <tbody id="lcr-time-rates-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">No time-based rates configured</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Routing Decisions -->
            <div class="config-section">
                <h3>üìä Recent Routing Decisions</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Number</th>
                                <th>Selected Trunk</th>
                                <th>Est. Cost</th>
                                <th>Alternatives</th>
                            </tr>
                        </thead>
                        <tbody id="lcr-decisions-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">No recent decisions</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Least-Cost Routing</h3>
                <p><strong>Least-Cost Routing (LCR)</strong> automatically selects the most cost-effective trunk for outbound calls based on destination patterns and carrier rates.</p>
                <ul>
                    <li><strong>Rate Database:</strong> Define per-minute rates for different dial patterns</li>
                    <li><strong>Time-Based Rates:</strong> Apply multipliers for peak/off-peak hours</li>
                    <li><strong>Dial Patterns:</strong> Use regex patterns to match destinations (e.g., ^\d{10}$ for US local)</li>
                    <li><strong>Quality Aware:</strong> Optionally consider trunk quality metrics in addition to cost</li>
                    <li><strong>Cost Savings:</strong> Reduce telecom expenses by routing to cheapest available carriers</li>
                </ul>
                <h4>Example Patterns:</h4>
                <ul>
                    <li><code>^\d{10}$</code> - US Local (10 digits)</li>
                    <li><code>^1[2-9]\d{9}$</code> - US Long Distance</li>
                    <li><code>^1(800|888|877|866)\d{7}$</code> - US Toll-Free</li>
                    <li><code>^011</code> - International (011 prefix)</li>
                    <li><code>^01144</code> - UK (011 + 44 country code)</li>
                </ul>
            </div>
        </div>

        <!-- Codecs Tab -->
        <div id="codecs" class="tab-content">
            <h2>üéµ Audio & Video Codecs</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadCodecStatus()">üîÑ Refresh Status</button>
            </div>

            <!-- Codec Overview -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="codecs-supported">-</div>
                    <div class="stat-label">Supported Codecs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="codecs-enabled">-</div>
                    <div class="stat-label">Enabled Codecs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="codecs-active">-</div>
                    <div class="stat-label">Active Sessions</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="codecs-quality">-</div>
                    <div class="stat-label">HD Audio Capable</div>
                </div>
            </div>

            <!-- Audio Codecs -->
            <div class="config-section">
                <h3>üîä Audio Codecs</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Codec</th>
                                <th>Type</th>
                                <th>Bitrate</th>
                                <th>Quality</th>
                                <th>Bandwidth</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>G.711 (Œº-law/A-law)</strong></td>
                                <td>Narrowband</td>
                                <td>64 kbps</td>
                                <td>Standard</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Standard</span></td>
                                <td>Built-in, always available</td>
                            </tr>
                            <tr>
                                <td><strong>G.722</strong></td>
                                <td>Wideband</td>
                                <td>48/56/64 kbps</td>
                                <td>HD Audio</td>
                                <td>7 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Available</span></td>
                                <td>Framework ready for native library</td>
                            </tr>
                            <tr>
                                <td><strong>Opus</strong></td>
                                <td>Adaptive</td>
                                <td>6-510 kbps</td>
                                <td>Best Quality</td>
                                <td>Up to 20 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Implemented</span></td>
                                <td>Modern codec with FEC, PLC, DTX</td>
                            </tr>
                            <tr>
                                <td><strong>G.729</strong></td>
                                <td>Narrowband</td>
                                <td>8 kbps</td>
                                <td>Compressed</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Available</span></td>
                                <td>Framework ready (requires codec library for encode/decode)</td>
                            </tr>
                            <tr>
                                <td><strong>G.726-32 (ADPCM)</strong></td>
                                <td>Narrowband</td>
                                <td>32 kbps</td>
                                <td>Standard</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #10b981;">‚úÖ Available</span></td>
                                <td>ADPCM codec, built-in support via audioop</td>
                            </tr>
                            <tr>
                                <td><strong>G.726-40 (ADPCM)</strong></td>
                                <td>Narrowband</td>
                                <td>40 kbps</td>
                                <td>Standard</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #3b82f6;">üìã Framework</span></td>
                                <td>ADPCM variant, framework support</td>
                            </tr>
                            <tr>
                                <td><strong>G.726-24 (ADPCM)</strong></td>
                                <td>Narrowband</td>
                                <td>24 kbps</td>
                                <td>Compressed</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #3b82f6;">üìã Framework</span></td>
                                <td>ADPCM variant, framework support</td>
                            </tr>
                            <tr>
                                <td><strong>G.726-16 (ADPCM)</strong></td>
                                <td>Narrowband</td>
                                <td>16 kbps</td>
                                <td>Compressed</td>
                                <td>3.1 kHz</td>
                                <td><span class="badge" style="background: #3b82f6;">üìã Framework</span></td>
                                <td>ADPCM variant, framework support</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Video Codecs -->
            <div class="config-section">
                <h3>üìπ Video Codecs</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Codec</th>
                                <th>Type</th>
                                <th>Quality</th>
                                <th>Bitrate Range</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>VP8</strong></td>
                                <td>WebRTC</td>
                                <td>HD</td>
                                <td>100-2000 kbps</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Planned</span></td>
                                <td>Open-source WebRTC video codec</td>
                            </tr>
                            <tr>
                                <td><strong>H.264</strong></td>
                                <td>Standard</td>
                                <td>HD/Full HD</td>
                                <td>100-5000 kbps</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Planned</span></td>
                                <td>Widely supported video codec</td>
                            </tr>
                            <tr>
                                <td><strong>H.265 (HEVC)</strong></td>
                                <td>Advanced</td>
                                <td>4K capable</td>
                                <td>50-4000 kbps</td>
                                <td><span class="badge" style="background: #6b7280;">‚ö†Ô∏è Future</span></td>
                                <td>Next-gen codec with better compression</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Codec Information -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è Codec Information</h3>
                <div class="info-box">
                    <h4>Audio Codec Comparison</h4>
                    <ul>
                        <li><strong>G.711:</strong> Uncompressed PCM. Standard quality (3.1 kHz), high bandwidth. Universal compatibility.</li>
                        <li><strong>G.722:</strong> Wideband (7 kHz). HD audio quality with moderate bandwidth. Better clarity than G.711.</li>
                        <li><strong>Opus:</strong> Modern adaptive codec. Best quality with variable bitrate. Includes FEC, PLC, and DTX. Recommended for WebRTC.</li>
                        <li><strong>G.729:</strong> Low bandwidth (8 kbps). Compressed quality. Good for limited bandwidth scenarios. Framework ready for codec library integration.</li>
                        <li><strong>G.726:</strong> ADPCM codec family. Multiple bitrates (16/24/32/40 kbps). G.726-32 has built-in support, others have framework support.</li>
                    </ul>
                    
                    <h4>Audio Quality Levels</h4>
                    <ul>
                        <li><strong>Narrowband (3.1 kHz):</strong> Standard telephone quality - G.711, G.729, G.726</li>
                        <li><strong>Wideband (7 kHz):</strong> HD audio quality - G.722</li>
                        <li><strong>Superwideband (12-20 kHz):</strong> Best audio quality - Opus</li>
                    </ul>
                    
                    <h4>Codec Selection Guidelines</h4>
                    <ul>
                        <li><strong>Internal calls:</strong> Use G.722 or Opus for best quality</li>
                        <li><strong>External/trunk calls:</strong> G.711 for compatibility, G.722 if supported</li>
                        <li><strong>Low bandwidth:</strong> G.729, G.726-24, G.726-16, or Opus at low bitrate</li>
                        <li><strong>WebRTC:</strong> Opus (required), VP8/H.264 for video</li>
                        <li><strong>Legacy systems:</strong> G.726-32 for compatibility with older ADPCM equipment</li>
                    </ul>
                </div>
            </div>

            <!-- Codec Configuration -->
            <div class="config-section">
                <h3>‚öôÔ∏è Codec Configuration</h3>
                <form id="codec-config-form" onsubmit="saveCodecConfig(event)">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="codec-g722-enabled" checked>
                            Enable G.722 HD Audio
                        </label>
                        <small>Wideband audio codec for higher quality calls</small>
                    </div>
                    <div class="form-group">
                        <label>G.722 Default Bitrate:</label>
                        <select id="codec-g722-bitrate">
                            <option value="48000">48 kbps</option>
                            <option value="56000">56 kbps</option>
                            <option value="64000" selected>64 kbps (Recommended)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="codec-opus-enabled" checked>
                            Enable Opus Codec
                        </label>
                        <small>Modern adaptive codec with best quality</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="codec-g729-enabled" checked>
                            Enable G.729 Codec
                        </label>
                        <small>Low bandwidth codec for limited bandwidth scenarios</small>
                    </div>
                    <div class="form-group">
                        <label>G.729 Variant:</label>
                        <select id="codec-g729-variant">
                            <option value="G729">G.729 (Basic)</option>
                            <option value="G729A">G.729 Annex A</option>
                            <option value="G729B">G.729 Annex B (VAD)</option>
                            <option value="G729AB" selected>G.729 Annex A+B (Recommended)</option>
                        </select>
                        <small>Annex A: Reduced complexity, Annex B: Voice Activity Detection</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="codec-g726-enabled" checked>
                            Enable G.726 ADPCM Codec
                        </label>
                        <small>ADPCM codec family for legacy compatibility</small>
                    </div>
                    <div class="form-group">
                        <label>G.726 Default Bitrate:</label>
                        <select id="codec-g726-bitrate">
                            <option value="16000">16 kbps (Very Low)</option>
                            <option value="24000">24 kbps (Low)</option>
                            <option value="32000" selected>32 kbps (Standard - Recommended)</option>
                            <option value="40000">40 kbps (High)</option>
                        </select>
                        <small>32 kbps has built-in support, others are framework ready</small>
                    </div>
                    <div class="form-group">
                        <label>Codec Preference Order:</label>
                        <textarea id="codec-preference-order" rows="6" placeholder="Opus&#10;G.722&#10;G.711 (PCMU/PCMA)&#10;G.729&#10;G.726-32">Opus
G.722
G.711 (PCMU/PCMA)
G.729
G.726-32</textarea>
                        <small>Codecs will be negotiated in this order (one per line)</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Codec Settings</button>
                </form>
            </div>

            <!-- DTMF Configuration -->
            <div class="config-section">
                <h3>üìû DTMF Configuration</h3>
                <div class="info-box" style="margin-bottom: 20px;">
                    <p><strong>DTMF (Dual-Tone Multi-Frequency)</strong> - Configure how phone keypad tones are transmitted and detected.</p>
                    <p>This system supports three DTMF methods:</p>
                    <ul>
                        <li><strong>RFC 2833</strong> - Out-of-band RTP events (most reliable, recommended)</li>
                        <li><strong>SIP INFO</strong> - Out-of-band SIP signaling (fallback method)</li>
                        <li><strong>In-Band Audio</strong> - Audio tone detection using Goertzel algorithm (universal fallback)</li>
                    </ul>
                </div>

                <form id="dtmf-config-form" onsubmit="saveDTMFConfig(event)">
                    <h4>Primary DTMF Method</h4>
                    <div class="form-group">
                        <label>DTMF Mode:</label>
                        <select id="dtmf-mode">
                            <option value="RFC2833" selected>RFC 2833 (Recommended)</option>
                            <option value="SIP_INFO">SIP INFO</option>
                            <option value="INBAND">In-Band Audio Detection</option>
                            <option value="AUTO">Auto (Try all methods)</option>
                        </select>
                        <small>Primary method for DTMF transmission. RFC 2833 is the industry standard.</small>
                    </div>

                    <h4>RFC 2833 Settings</h4>
                    <div class="form-group">
                        <label>RTP Payload Type:</label>
                        <select id="dtmf-payload-type">
                            <option value="96">96 - Generic fallback</option>
                            <option value="100">100 - Cisco/common alternative</option>
                            <option value="101" selected>101 - Standard (RFC 2833)</option>
                            <option value="102">102 - Carrier alternative</option>
                            <option value="121">121 - Polycom alternative</option>
                        </select>
                        <small>RTP payload type for telephone-event (DTMF). Start with 101 (standard), try others if DTMF doesn't work.</small>
                    </div>

                    <div class="form-group">
                        <label>DTMF Duration (milliseconds):</label>
                        <input type="number" id="dtmf-duration" min="80" max="500" value="160" step="10">
                        <small>Duration of each DTMF tone (80-500ms). Standard is 160ms.</small>
                    </div>

                    <h4>Fallback Options</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dtmf-sip-info-fallback" checked>
                            Enable SIP INFO Fallback
                        </label>
                        <small>Use SIP INFO method if RFC 2833 fails</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dtmf-inband-fallback" checked>
                            Enable In-Band Audio Detection Fallback
                        </label>
                        <small>Always detect DTMF tones from audio stream as last resort</small>
                    </div>

                    <h4>Advanced Settings</h4>
                    <div class="form-group">
                        <label>In-Band Detection Threshold:</label>
                        <input type="range" id="dtmf-detection-threshold" min="0.1" max="0.9" value="0.3" step="0.05">
                        <span id="dtmf-threshold-value">0.3</span>
                        <small>Sensitivity for in-band audio detection (0.1=very sensitive, 0.9=very strict). Default: 0.3</small>
                    </div>

                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="dtmf-relay-enabled" checked>
                            Enable DTMF Relay
                        </label>
                        <small>Relay DTMF tones between call participants (required for IVR and auto-attendant)</small>
                    </div>

                    <button type="submit" class="btn btn-success">üíæ Save DTMF Configuration</button>
                </form>

                <div class="info-box" style="margin-top: 20px;">
                    <h4>üìö Payload Type Selection Guide</h4>
                    <p><strong>How to choose the right payload type:</strong></p>
                    <ol>
                        <li><strong>Start with 101</strong> - This is the RFC 2833 standard and works with most phones</li>
                        <li><strong>If DTMF doesn't work</strong>, try these alternatives in order:
                            <ul>
                                <li><strong>100:</strong> Used by Cisco systems and some SIP providers</li>
                                <li><strong>102:</strong> Alternative used by some carriers (Verizon, AT&T)</li>
                                <li><strong>96:</strong> First dynamic payload type, generic fallback</li>
                                <li><strong>121:</strong> Used by some Polycom phones</li>
                            </ul>
                        </li>
                        <li><strong>Check your SIP provider's documentation</strong> for their required payload type</li>
                        <li><strong>Phone-specific overrides:</strong> Individual phone templates can override these settings</li>
                    </ol>
                    
                    <h4>üîß Troubleshooting</h4>
                    <ul>
                        <li><strong>DTMF not detected in IVR/voicemail:</strong> Try changing payload type to 100 or 102</li>
                        <li><strong>Wrong digits detected:</strong> Increase detection threshold or check for audio interference</li>
                        <li><strong>DTMF works locally but not through trunk:</strong> Check SIP provider's required payload type</li>
                        <li><strong>Delayed DTMF response:</strong> Reduce DTMF duration or check network latency</li>
                    </ul>
                    
                    <p>üìñ For detailed information, see: 
                        <a href="https://github.com/mattiIce/PBX/blob/main/COMPLETE_DTMF_IMPLEMENTATION_SUMMARY.md" target="_blank">COMPLETE_DTMF_IMPLEMENTATION_SUMMARY.md</a>,
                        <a href="https://github.com/mattiIce/PBX/blob/main/DTMF_PAYLOAD_TYPE_CONFIGURATION.md" target="_blank">DTMF_PAYLOAD_TYPE_CONFIGURATION.md</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Webhooks Tab -->
        <div id="webhooks" class="tab-content">
            <h2>üîî Webhooks</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadWebhooks()">üîÑ Refresh</button>
                <button class="btn btn-success" onclick="showAddWebhookModal()">‚ûï Add Webhook</button>
            </div>

            <!-- Webhooks List -->
            <div class="config-section">
                <h3>üìã Webhook Subscriptions</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>URL</th>
                                <th>Events</th>
                                <th>Secret</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="webhooks-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading webhooks...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Webhooks</h3>
                <p><strong>Webhooks</strong> allow the PBX to send real-time notifications to external systems when events occur.</p>
                <ul>
                    <li><strong>Events:</strong> Call events, registrations, voicemail, and more</li>
                    <li><strong>HTTP POST:</strong> JSON data sent via HTTP POST request</li>
                    <li><strong>Secret:</strong> Optional HMAC signature for verification</li>
                    <li><strong>Use Cases:</strong> CRM integration, logging, monitoring, automation</li>
                </ul>
                <h4>Available Event Types:</h4>
                <p><small>call_started, call_ended, call_answered, extension_registered, extension_unregistered, voicemail_new, voicemail_deleted</small></p>
            </div>
        </div>

        <!-- Recording Retention Tab -->
        <div id="recording-retention" class="tab-content">
            <h2>üìÅ Recording Retention Policies</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadRetentionPolicies()">üîÑ Refresh</button>
                <button class="btn btn-success" onclick="showAddRetentionPolicyModal()">‚ûï Add Policy</button>
            </div>

            <!-- Retention Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="retention-policies-count">-</div>
                    <div class="stat-label">Total Policies</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="retention-recordings">-</div>
                    <div class="stat-label">Managed Recordings</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="retention-deleted">-</div>
                    <div class="stat-label">Deleted (All Time)</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="retention-last-cleanup">-</div>
                    <div class="stat-label">Last Cleanup</div>
                </div>
            </div>

            <!-- Retention Policies List -->
            <div class="config-section">
                <h3>üìã Retention Policies</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Policy Name</th>
                                <th>Retention Period</th>
                                <th>Tags</th>
                                <th>Created</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="retention-policies-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading policies...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Recording Retention</h3>
                <p><strong>Recording Retention Policies</strong> automatically manage call recording lifecycle based on compliance and business needs.</p>
                <ul>
                    <li><strong>Automated Cleanup:</strong> Remove old recordings based on retention period</li>
                    <li><strong>Compliance:</strong> Meet regulatory requirements (e.g., 7 years for some industries)</li>
                    <li><strong>Tags:</strong> Apply special retention to critical or training recordings</li>
                    <li><strong>Storage Management:</strong> Free up disk space automatically</li>
                </ul>
                <p><strong>Default Retention Periods:</strong></p>
                <ul>
                    <li>Standard: 90 days</li>
                    <li>Critical: 365 days (1 year)</li>
                    <li>Compliance: 2555 days (7 years)</li>
                </ul>
            </div>
        </div>

        <!-- Fraud Detection Tab -->
        <div id="fraud-detection" class="tab-content">
            <h2>üõ°Ô∏è Fraud Detection</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadFraudAlerts()">üîÑ Refresh Alerts</button>
                <button class="btn btn-success" onclick="showAddBlockedPatternModal()">‚ûï Block Pattern</button>
            </div>

            <!-- Fraud Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="fraud-total-alerts">-</div>
                    <div class="stat-label">Total Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fraud-high-risk">-</div>
                    <div class="stat-label">High Risk Alerts</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fraud-blocked-patterns">-</div>
                    <div class="stat-label">Blocked Patterns</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="fraud-extensions-flagged">-</div>
                    <div class="stat-label">Extensions Flagged</div>
                </div>
            </div>

            <!-- Recent Fraud Alerts -->
            <div class="config-section">
                <h3>üö® Recent Fraud Alerts</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Extension</th>
                                <th>Alert Type</th>
                                <th>Fraud Score</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="fraud-alerts-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading alerts...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Blocked Patterns -->
            <div class="config-section">
                <h3>üö´ Blocked Number Patterns</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Pattern</th>
                                <th>Reason</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="blocked-patterns-list">
                            <tr>
                                <td colspan="3" style="text-align: center;">No blocked patterns</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Fraud Detection</h3>
                <p><strong>Fraud Detection</strong> monitors call patterns to identify and prevent unauthorized usage and toll fraud.</p>
                <ul>
                    <li><strong>Pattern Analysis:</strong> Detects unusual call frequency, destinations, and timing</li>
                    <li><strong>International Calls:</strong> Monitors excessive international dialing</li>
                    <li><strong>Cost Monitoring:</strong> Alerts on high-cost calling patterns</li>
                    <li><strong>Unusual Hours:</strong> Flags calls during off-hours (11 PM - 6 AM)</li>
                    <li><strong>Blocked Patterns:</strong> Prevent calls to specific number patterns</li>
                </ul>
                <p><strong>Default Thresholds:</strong> 100 calls/hour, 20 international calls/day, 2-hour max duration</p>
            </div>
        </div>

        <!-- Callback Queue Tab -->
        <div id="callback-queue" class="tab-content">
            <h2>üìû Callback Queue Management</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadCallbackQueue()">üîÑ Refresh</button>
                <button class="btn btn-success" onclick="showRequestCallbackModal()">‚ûï Request Callback</button>
            </div>

            <!-- Callback Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="callback-total">-</div>
                    <div class="stat-label">Total Callbacks</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="callback-scheduled">-</div>
                    <div class="stat-label">Scheduled</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="callback-in-progress">-</div>
                    <div class="stat-label">In Progress</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="callback-completed">-</div>
                    <div class="stat-label">Completed</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="callback-failed">-</div>
                    <div class="stat-label">Failed</div>
                </div>
            </div>

            <!-- Callback Requests List -->
            <div class="config-section">
                <h3>üìã Active Callbacks</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Callback ID</th>
                                <th>Queue</th>
                                <th>Caller</th>
                                <th>Requested</th>
                                <th>Callback Time</th>
                                <th>Status</th>
                                <th>Attempts</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="callback-list">
                            <tr>
                                <td colspan="8" style="text-align: center;">Loading callbacks...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Callback Queue</h3>
                <p><strong>Callback Queue</strong> allows callers to request a callback instead of waiting on hold, improving customer satisfaction.</p>
                <ul>
                    <li><strong>Scheduled Callbacks:</strong> Callers can choose immediate callback (ASAP) or schedule for a specific time</li>
                    <li><strong>Queue Integration:</strong> Works with call queues to manage callback requests</li>
                    <li><strong>Auto-Retry:</strong> Failed callbacks are automatically retried with configurable intervals</li>
                    <li><strong>Status Tracking:</strong> Monitor callback status from request to completion</li>
                </ul>
                <p><strong>Callback Status:</strong></p>
                <ul>
                    <li>Pending: Callback request received, waiting to be scheduled</li>
                    <li>Scheduled: Callback scheduled for a specific time</li>
                    <li>In Progress: Agent is currently calling back the customer</li>
                    <li>Completed: Callback successfully completed</li>
                    <li>Failed: Callback failed after maximum retry attempts</li>
                    <li>Cancelled: Callback request cancelled by customer or admin</li>
                </ul>
            </div>
        </div>

        <!-- Mobile Push Notifications Tab -->
        <div id="mobile-push" class="tab-content">
            <h2>üì± Mobile Push Notifications</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadMobilePushDevices()">üîÑ Refresh</button>
                <button class="btn btn-success" onclick="showRegisterDeviceModal()">‚ûï Register Device</button>
                <button class="btn btn-secondary" onclick="showTestNotificationModal()">üß™ Test Notification</button>
            </div>

            <!-- Push Notification Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="push-total-devices">-</div>
                    <div class="stat-label">Total Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="push-total-users">-</div>
                    <div class="stat-label">Users with Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="push-ios-devices">-</div>
                    <div class="stat-label">iOS Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="push-android-devices">-</div>
                    <div class="stat-label">Android Devices</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="push-recent-notifications">-</div>
                    <div class="stat-label">Recent Notifications</div>
                </div>
            </div>

            <!-- Registered Devices List -->
            <div class="config-section">
                <h3>üìã Registered Devices</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Platform</th>
                                <th>Registered</th>
                                <th>Last Seen</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="mobile-devices-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading devices...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Recent Notifications -->
            <div class="config-section">
                <h3>üì® Recent Notifications</h3>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>User ID</th>
                                <th>Title</th>
                                <th>Body</th>
                                <th>Sent At</th>
                                <th>Success/Failed</th>
                            </tr>
                        </thead>
                        <tbody id="push-history-list">
                            <tr>
                                <td colspan="5" style="text-align: center;">Loading history...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Mobile Push Notifications</h3>
                <p><strong>Mobile Push Notifications</strong> provide real-time alerts to mobile devices for calls and voicemail messages.</p>
                <ul>
                    <li><strong>Firebase Cloud Messaging (FCM):</strong> Free push notification service for iOS and Android</li>
                    <li><strong>Multi-Device Support:</strong> Users can register multiple devices (phone, tablet, etc.)</li>
                    <li><strong>Notification Types:</strong> Incoming calls, missed calls, new voicemail messages</li>
                    <li><strong>Platform Support:</strong> iOS (via APNs through FCM) and Android (native FCM)</li>
                </ul>
                <p><strong>Setup Requirements:</strong></p>
                <ul>
                    <li>Firebase project with FCM enabled</li>
                    <li>Service account credentials JSON file</li>
                    <li>Mobile app with FCM SDK integrated</li>
                    <li>Device token registration from mobile app</li>
                </ul>
            </div>
        </div>

        <!-- Recording Announcements Tab -->
        <div id="recording-announcements" class="tab-content">
            <h2>üì¢ Recording Announcements</h2>
            
            <div class="action-buttons" style="margin-bottom: 20px;">
                <button class="btn btn-primary" onclick="loadRecordingAnnouncementsStats()">üîÑ Refresh</button>
            </div>

            <!-- Announcement Statistics -->
            <div class="stats-grid" style="margin-bottom: 20px;">
                <div class="stat-card">
                    <div class="stat-value" id="announcements-enabled">-</div>
                    <div class="stat-label">Status</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="announcements-played">-</div>
                    <div class="stat-label">Announcements Played</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="consent-accepted">-</div>
                    <div class="stat-label">Consent Accepted</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="consent-declined">-</div>
                    <div class="stat-label">Consent Declined</div>
                </div>
            </div>

            <!-- Current Configuration -->
            <div class="config-section">
                <h3>‚öôÔ∏è Current Configuration</h3>
                <div class="config-grid">
                    <div class="config-item">
                        <strong>Announcement Type:</strong>
                        <span id="announcement-type">-</span>
                    </div>
                    <div class="config-item">
                        <strong>Require Consent:</strong>
                        <span id="require-consent">-</span>
                    </div>
                    <div class="config-item">
                        <strong>Audio File:</strong>
                        <span id="audio-file-path">-</span>
                    </div>
                    <div class="config-item">
                        <strong>Announcement Text:</strong>
                        <span id="announcement-text">-</span>
                    </div>
                </div>
            </div>

            <!-- Info Box -->
            <div class="info-box">
                <h3>‚ÑπÔ∏è About Recording Announcements</h3>
                <p><strong>Recording Announcements</strong> automatically inform call participants that the call may be recorded, ensuring legal compliance.</p>
                <ul>
                    <li><strong>Legal Compliance:</strong> Meets requirements for recording disclosure in various jurisdictions</li>
                    <li><strong>Announcement Types:</strong>
                        <ul>
                            <li><code>caller</code> - Play to incoming callers only</li>
                            <li><code>callee</code> - Play to outbound call recipients only</li>
                            <li><code>both</code> - Play to all parties</li>
                        </ul>
                    </li>
                    <li><strong>Consent Management:</strong> Optional consent requirement with DTMF response capture</li>
                    <li><strong>Audio Options:</strong> Use pre-recorded WAV file or text-to-speech</li>
                </ul>
                <p><strong>Configuration:</strong></p>
                <p>Edit <code>config.yml</code> under <code>features.recording_announcements</code> to customize:</p>
                <ul>
                    <li><code>enabled</code> - Enable/disable announcements</li>
                    <li><code>type</code> - Announcement type (caller/callee/both)</li>
                    <li><code>audio_path</code> - Path to audio file</li>
                    <li><code>text</code> - TTS text (if no audio file)</li>
                    <li><code>require_consent</code> - Enable consent requirement</li>
                    <li><code>consent_timeout_seconds</code> - Timeout for consent response</li>
                </ul>
            </div>
        </div>

        <!-- Configuration Tab -->
        <div id="config" class="tab-content">
            <h2>System Configuration</h2>
            <p class="info-box" style="margin-bottom: 20px;">
                Configure key PBX settings below. Changes are saved to <code>config.yml</code> and may require a system restart to take effect.
            </p>

            <!-- Feature Toggles -->
            <div class="config-section">
                <h3>üéõÔ∏è Feature Toggles</h3>
                <p class="config-note">Enable or disable system features</p>
                <form id="features-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-recording">
                            Enable Call Recording
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-transfer">
                            Enable Call Transfer
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-hold">
                            Enable Call Hold
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-conference">
                            Enable Conference Calling
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-voicemail">
                            Enable Voicemail
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-parking">
                            Enable Call Parking
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-call-queues">
                            Enable Call Queues
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-presence">
                            Enable Presence (Status) System
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-music-on-hold">
                            Enable Music on Hold
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="feature-auto-attendant">
                            Enable Auto Attendant
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Feature Settings</button>
                </form>
            </div>

            <!-- Voicemail Settings -->
            <div class="config-section">
                <h3>üìß Voicemail Settings</h3>
                <form id="voicemail-config-form">
                    <div class="form-group">
                        <label>Max Message Duration (seconds):</label>
                        <input type="number" id="voicemail-max-duration" min="30" max="600" value="180">
                        <small>Maximum length of voicemail messages (30-600 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>Max Greeting Duration (seconds):</label>
                        <input type="number" id="voicemail-max-greeting" min="10" max="60" value="30">
                        <small>Maximum length of custom greetings (10-60 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>No Answer Timeout (seconds):</label>
                        <input type="number" id="voicemail-no-answer-timeout" min="10" max="60" value="30">
                        <small>How long to ring before sending to voicemail (10-60 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="voicemail-allow-custom-greetings">
                            Allow Custom Greetings
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="voicemail-email-notifications">
                            Enable Email Notifications
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Voicemail Settings</button>
                </form>
            </div>

            <!-- Email/SMTP Settings -->
            <div class="config-section">
                <h3>üì¨ Email/SMTP Settings</h3>
                <p class="config-note">Configure SMTP server for email notifications</p>
                <form id="email-config-form">
                    <div class="form-group">
                        <label>SMTP Host:</label>
                        <input type="text" id="smtp-host" placeholder="smtp.example.com">
                    </div>
                    <div class="form-group">
                        <label>SMTP Port:</label>
                        <input type="number" id="smtp-port" placeholder="587">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="smtp-use-tls">
                            Use TLS/SSL
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Username:</label>
                        <input type="text" id="smtp-username" placeholder="username">
                    </div>
                    <div class="form-group">
                        <label>Password:</label>
                        <input type="password" id="smtp-password" placeholder="password">
                    </div>
                    <div class="form-group">
                        <label>From Address:</label>
                        <input type="email" id="email-from" placeholder="voicemail@company.com">
                    </div>
                    <div class="form-group">
                        <label>From Name:</label>
                        <input type="text" id="email-from-name" placeholder="PBX Voicemail">
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Email Settings</button>
                </form>
            </div>

            <!-- Recording Settings -->
            <div class="config-section">
                <h3>üéôÔ∏è Call Recording Settings</h3>
                <form id="recording-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="recording-auto-record">
                            Automatically Record All Calls
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Recording Format:</label>
                        <select id="recording-format">
                            <option value="wav">WAV (Uncompressed)</option>
                            <option value="mp3">MP3 (Compressed)</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Storage Path:</label>
                        <input type="text" id="recording-storage-path" value="recordings">
                        <small>Directory for storing recordings</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Recording Settings</button>
                </form>
            </div>

            <!-- Security Settings -->
            <div class="config-section">
                <h3>üîí Security Settings</h3>
                <form id="security-config-form">
                    <div class="form-group">
                        <label>Minimum Password Length:</label>
                        <input type="number" id="security-min-password" min="8" max="32" value="12">
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-uppercase">
                            Require Uppercase Letter
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-lowercase">
                            Require Lowercase Letter
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-digit">
                            Require Number
                        </label>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-require-special">
                            Require Special Character
                        </label>
                    </div>
                    <div class="form-group">
                        <label>Max Login Attempts:</label>
                        <input type="number" id="security-max-attempts" min="3" max="10" value="5">
                        <small>Failed attempts before temporary lockout</small>
                    </div>
                    <div class="form-group">
                        <label>Lockout Duration (seconds):</label>
                        <input type="number" id="security-lockout-duration" min="300" max="3600" value="900">
                        <small>How long accounts are locked after too many failed attempts (300-3600 seconds)</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="security-fips-mode">
                            Enable FIPS 140-2 Compliance
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Security Settings</button>
                </form>
            </div>

            <!-- Advanced Feature Settings -->
            <div class="config-section">
                <h3>üöÄ Advanced Features</h3>
                <form id="advanced-features-form">
                    <h4>WebRTC Browser Calling</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-webrtc-enabled">
                            Enable WebRTC
                        </label>
                        <small>Allow browser-based calling without downloads</small>
                    </div>
                    
                    <h4>Webhooks</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-webhooks-enabled">
                            Enable Webhooks
                        </label>
                        <small>Event-driven integrations with external systems</small>
                    </div>
                    
                    <h4>CRM Integration</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-crm-enabled">
                            Enable CRM Integration
                        </label>
                        <small>Auto-display caller information from CRM</small>
                    </div>
                    
                    <h4>Hot Desking</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-hot-desking-enabled">
                            Enable Hot Desking
                        </label>
                        <small>Allow users to log in from any phone</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-hot-desking-require-pin">
                            Require PIN for Hot Desking
                        </label>
                    </div>
                    
                    <h4>Voicemail Transcription</h4>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="advanced-transcription-enabled">
                            Enable Voicemail Transcription
                        </label>
                        <small>Convert voicemails to text (requires Vosk or Google Cloud)</small>
                    </div>
                    
                    <button type="submit" class="btn btn-success">üíæ Save Advanced Settings</button>
                </form>
            </div>

            <!-- Conference Settings -->
            <div class="config-section">
                <h3>üë• Conference Settings</h3>
                <form id="conference-config-form">
                    <div class="form-group">
                        <label>Max Participants:</label>
                        <input type="number" id="conference-max-participants" min="3" max="100" value="50">
                        <small>Maximum participants per conference (3-100)</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="conference-record">
                            Record Conferences by Default
                        </label>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Conference Settings</button>
                </form>
            </div>

            <!-- SSL/HTTPS Configuration -->
            <div class="config-section">
                <h3>üîí SSL/HTTPS Configuration</h3>
                <p class="config-note">Configure HTTPS encryption for secure API communication</p>
                
                <div class="info-box" style="margin-bottom: 20px;">
                    <p><strong>Current Status:</strong></p>
                    <div id="ssl-status-info">
                        <p>‚è≥ Loading SSL status...</p>
                    </div>
                </div>

                <form id="ssl-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="ssl-enabled">
                            Enable HTTPS/SSL
                        </label>
                        <small>Encrypt API communication using SSL/TLS certificates</small>
                    </div>

                    <div id="ssl-certificate-section" style="display: none; margin-left: 20px; border-left: 3px solid #2196F3; padding-left: 15px;">
                        <h4>Certificate Configuration</h4>
                        
                        <div class="form-group">
                            <label>Certificate File Path:</label>
                            <input type="text" id="ssl-cert-file" placeholder="certs/server.crt" readonly>
                            <small>Location of the SSL certificate file</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Private Key File Path:</label>
                            <input type="text" id="ssl-key-file" placeholder="certs/server.key" readonly>
                            <small>Location of the SSL private key file</small>
                        </div>

                        <div id="cert-details-section" style="display: none; margin-top: 15px; padding: 15px; background: #f5f5f5; border-radius: 4px;">
                            <h4 style="margin-top: 0;">Certificate Details</h4>
                            <div class="form-group">
                                <label>Subject:</label>
                                <input type="text" id="cert-subject" readonly>
                            </div>
                            <div class="form-group">
                                <label>Issuer:</label>
                                <input type="text" id="cert-issuer" readonly>
                            </div>
                            <div class="form-group">
                                <label>Valid From:</label>
                                <input type="text" id="cert-valid-from" readonly>
                            </div>
                            <div class="form-group">
                                <label>Valid Until:</label>
                                <input type="text" id="cert-valid-until" readonly>
                            </div>
                            <div class="form-group">
                                <label>Days Until Expiry:</label>
                                <input type="text" id="cert-days-expiry" readonly>
                            </div>
                        </div>

                        <h4 style="margin-top: 20px;">Generate Self-Signed Certificate</h4>
                        <p class="config-note">Generate a self-signed certificate for development/testing. For production, use a certificate from a trusted CA (Let's Encrypt, DigiCert, etc.).</p>
                        
                        <div class="form-group">
                            <label>Hostname/IP Address:</label>
                            <input type="text" id="ssl-hostname" placeholder="192.168.1.14">
                            <small>The hostname or IP address that will be used to access the server</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Certificate Validity (days):</label>
                            <input type="number" id="ssl-days-valid" value="365" min="1" max="3650">
                            <small>How many days the certificate will be valid (1-3650)</small>
                        </div>
                        
                        <div class="action-buttons">
                            <button type="button" class="btn btn-primary" onclick="generateSSLCertificate()">üîê Generate Certificate</button>
                            <button type="button" class="btn btn-secondary" onclick="refreshSSLStatus()">üîÑ Refresh Status</button>
                        </div>

                        <div class="info-box" style="margin-top: 20px;">
                            <p><strong>‚ö†Ô∏è Important Notes:</strong></p>
                            <ul>
                                <li>Self-signed certificates will show security warnings in browsers</li>
                                <li>After generating or configuring certificates, you must restart the PBX server</li>
                                <li>For production use, obtain certificates from a trusted CA like Let's Encrypt</li>
                                <li>Private keys are stored with restricted permissions (600) for security</li>
                            </ul>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-success" style="margin-top: 15px;">üíæ Save SSL Settings</button>
                </form>
            </div>

            <!-- Server Info (Read-Only) -->
            <div class="config-section">
                <h3>‚ÑπÔ∏è Server Information</h3>
                <p class="config-note">Read-only server information (edit in config.yml to change)</p>
                <div class="form-group">
                    <label>SIP Port:</label>
                    <input type="number" id="config-sip-port" value="5060" disabled>
                </div>
                <div class="form-group">
                    <label>API Port:</label>
                    <input type="number" id="config-api-port" value="8080" disabled>
                </div>
                <div class="form-group">
                    <label>External IP:</label>
                    <input type="text" id="config-external-ip" disabled>
                </div>
                <div class="form-group">
                    <label>Server Name:</label>
                    <input type="text" id="config-server-name" disabled>
                </div>
            </div>
        </div>

        <!-- Framework Features Tabs -->
        <div id="framework-overview" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="click-to-dial" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="video-conferencing" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="team-messaging" class="tab-content">
            <h2>üí¨ Team Messaging</h2>
            
            <div class="section-card">
                <h3>Team Messaging</h3>
                <p>Configure team messaging features.</p>
            </div>
        </div>

        <div id="nomadic-e911" class="tab-content">
            <h2>üìç Nomadic E911</h2>
            
            <div class="config-section">
                <h3>üè¢ E911 Site Configuration</h3>
                <p>Configure sites with IP ranges for automatic location detection.</p>
                <div class="action-buttons" style="margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadE911Sites()">üîÑ Refresh Sites</button>
                    <button class="btn btn-success" onclick="showAddE911SiteModal()">‚ûï Add Site</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Site Name</th>
                                <th>Address</th>
                                <th>IP Ranges</th>
                                <th>PSAP</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="e911-sites-table">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh Sites" to load configurations</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>üìç Extension Locations</h3>
                <p>View and manage current locations for extensions (auto-detected or manually set).</p>
                <div class="action-buttons" style="margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadExtensionLocations()">üîÑ Refresh Locations</button>
                    <button class="btn btn-success" onclick="showUpdateLocationModal()">üìå Update Extension Location</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Extension</th>
                                <th>Current Location</th>
                                <th>Detection Method</th>
                                <th>Last Updated</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="extension-locations-table">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh Locations" to load data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>üìú Location History</h3>
                <p>Track location changes and updates over time.</p>
                <div class="action-buttons" style="margin-bottom: 15px;">
                    <button class="btn btn-primary" onclick="loadLocationHistory()">üîÑ Refresh History</button>
                    <label style="margin-left: 15px;">
                        Extension: 
                        <select id="location-history-extension" onchange="loadLocationHistory()">
                            <option value="">All Extensions</option>
                        </select>
                    </label>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Extension</th>
                                <th>Location</th>
                                <th>Method</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="location-history-table">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh History" to load data</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>‚ÑπÔ∏è About Nomadic E911</h3>
                <div class="info-box">
                    <h4>Automatic Location Detection</h4>
                    <p>The system automatically detects extension locations using:</p>
                    <ul>
                        <li><strong>IP Range Mapping:</strong> Configure IP ranges for each site/building</li>
                        <li><strong>Private IP Support:</strong> Handles both public and private IP addresses</li>
                        <li><strong>Multi-Site Support:</strong> Track users across multiple office locations</li>
                        <li><strong>Real-Time Updates:</strong> Location updated when extension registers from new IP</li>
                    </ul>
                    
                    <h4 style="margin-top: 20px;">Emergency Call Handling</h4>
                    <p>When a user dials 911:</p>
                    <ul>
                        <li><strong>Dispatchable Location:</strong> Full address sent to PSAP (Ray Baum's Act compliant)</li>
                        <li><strong>Building/Floor Details:</strong> Specific location within large facilities</li>
                        <li><strong>PSAP Routing:</strong> Route to correct Public Safety Answering Point</li>
                        <li><strong>Notification:</strong> Alert security/management with caller location</li>
                    </ul>
                    
                    <h4 style="margin-top: 20px;">Manual Override</h4>
                    <p>Users can manually update their location for:</p>
                    <ul>
                        <li>Remote work scenarios</li>
                        <li>Hot-desking environments</li>
                        <li>Mobile/traveling employees</li>
                        <li>Temporary location changes</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Open Source Integrations Tabs -->
        <div id="opensource-integrations" class="tab-content">
            <h2>üÜì Open Source Integrations</h2>
            
            <div class="info-banner" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
                <h3 style="color: white; margin-top: 0;">üí° Zero-Cost Integration Stack</h3>
                <p style="margin-bottom: 10px;">All integrations below are 100% free and open source. No licensing fees, no per-user costs.</p>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 10px; margin-top: 15px;">
                    <div>‚úÖ Jitsi Meet - Video conferencing</div>
                    <div>‚úÖ Matrix - Team messaging</div>
                    <div>‚úÖ EspoCRM - Customer relationship</div>
                    <div>‚úÖ Vosk - Speech recognition</div>
                </div>
                <p style="margin-top: 15px; margin-bottom: 0;"><strong>Annual Cost: $0</strong> (vs $3,726+/user for proprietary)</p>
            </div>

            <div class="section-card">
                <h3>Available Integrations</h3>
                <div class="info-box" style="margin-bottom: 20px; background-color: #e3f2fd;">
                    <strong>üöÄ Quick Setup:</strong> Check the boxes below to enable integrations with default settings. All integrations use free public servers by default.
                </div>
                <div class="integration-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px;">
                    
                    <div class="integration-card" id="jitsi-card" style="border: 2px solid #4CAF50; border-radius: 8px; padding: 15px; position: relative;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" id="quick-jitsi-enabled" onchange="quickToggleIntegration('jitsi')" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                            <h4 style="color: #4CAF50; margin: 0;">üìπ Jitsi Meet</h4>
                            <span id="jitsi-status-badge" style="margin-left: auto; padding: 4px 8px; border-radius: 4px; font-size: 12px; display: none;">‚óè</span>
                        </div>
                        <p><strong>Video Conferencing</strong></p>
                        <p style="font-size: 14px;">Free alternative to Zoom with screen sharing, recording, and unlimited participants.</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn" onclick="quickSetupIntegration('jitsi')" style="flex: 1; background-color: #4CAF50;">Quick Setup</button>
                            <button class="btn" onclick="showTab('jitsi-integration')" style="flex: 1; background-color: #666;">Configure</button>
                        </div>
                    </div>

                    <div class="integration-card" id="matrix-card" style="border: 2px solid #9C27B0; border-radius: 8px; padding: 15px; position: relative;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" id="quick-matrix-enabled" onchange="quickToggleIntegration('matrix')" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                            <h4 style="color: #9C27B0; margin: 0;">üí¨ Matrix</h4>
                            <span id="matrix-status-badge" style="margin-left: auto; padding: 4px 8px; border-radius: 4px; font-size: 12px; display: none;">‚óè</span>
                        </div>
                        <p><strong>Team Messaging</strong></p>
                        <p style="font-size: 14px;">Federated chat alternative to Slack with end-to-end encryption and file sharing.</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn" onclick="quickSetupIntegration('matrix')" style="flex: 1; background-color: #9C27B0;">Quick Setup</button>
                            <button class="btn" onclick="showTab('matrix-integration')" style="flex: 1; background-color: #666;">Configure</button>
                        </div>
                    </div>

                    <div class="integration-card" id="espocrm-card" style="border: 2px solid #2196F3; border-radius: 8px; padding: 15px; position: relative;">
                        <div style="display: flex; align-items: center; margin-bottom: 10px;">
                            <input type="checkbox" id="quick-espocrm-enabled" onchange="quickToggleIntegration('espocrm')" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                            <h4 style="color: #2196F3; margin: 0;">üë• EspoCRM</h4>
                            <span id="espocrm-status-badge" style="margin-left: auto; padding: 4px 8px; border-radius: 4px; font-size: 12px; display: none;">‚óè</span>
                        </div>
                        <p><strong>Customer Relationship</strong></p>
                        <p style="font-size: 14px;">Open-source CRM with contacts, deals, screen pop, and call logging.</p>
                        <div style="display: flex; gap: 10px; margin-top: 10px;">
                            <button class="btn" onclick="quickSetupIntegration('espocrm')" style="flex: 1; background-color: #2196F3;">Quick Setup</button>
                            <button class="btn" onclick="showTab('espocrm-integration')" style="flex: 1; background-color: #666;">Configure</button>
                        </div>
                    </div>

                    <div class="integration-card" style="border: 2px solid #FF9800; border-radius: 8px; padding: 15px;">
                        <h4 style="color: #FF9800;">üéôÔ∏è Vosk</h4>
                        <p><strong>Speech Recognition</strong></p>
                        <p style="font-size: 14px;">Already integrated! Offline speech-to-text for voicemail transcription.</p>
                        <button class="btn" style="width: 100%; margin-top: 10px; opacity: 0.7;" disabled>‚úÖ Active</button>
                    </div>

                </div>

                <div class="info-box" style="margin-top: 20px;">
                    <strong>üìö Documentation:</strong> See <a href="/OPEN_SOURCE_INTEGRATIONS.md" target="_blank">OPEN_SOURCE_INTEGRATIONS.md</a> for complete setup guides and migration instructions.
                </div>
            </div>

            <div class="section-card" style="margin-top: 20px;">
                <h3>‚ö° Quick Actions</h3>
                <div class="info-box" style="margin-bottom: 15px; background-color: #fff3e0;">
                    <p><strong>üí° Pro Tip:</strong> Once enabled, you can use these quick actions to interact with your integrations instantly!</p>
                </div>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <!-- Jitsi Quick Action -->
                    <div style="border: 1px solid #4CAF50; border-radius: 8px; padding: 15px; background: #f1f8e9;">
                        <h4 style="color: #4CAF50; margin-top: 0;">üìπ Jitsi Actions</h4>
                        <button class="btn btn-success" onclick="showTab('jitsi-integration')" style="width: 100%; margin-bottom: 8px;">
                            üöÄ Create Meeting
                        </button>
                        <p style="font-size: 12px; color: #666; margin: 0;">Jump to Jitsi tab to create instant or scheduled video meetings</p>
                    </div>
                    
                    <!-- Matrix Quick Action -->
                    <div style="border: 1px solid #9C27B0; border-radius: 8px; padding: 15px; background: #f3e5f5;">
                        <h4 style="color: #9C27B0; margin-top: 0;">üí¨ Matrix Actions</h4>
                        <button class="btn" onclick="showTab('matrix-integration')" style="width: 100%; margin-bottom: 8px; background-color: #9C27B0;">
                            üì§ Send Message
                        </button>
                        <p style="font-size: 12px; color: #666; margin: 0;">Jump to Matrix tab to send messages or create rooms</p>
                    </div>
                    
                    <!-- EspoCRM Quick Action -->
                    <div style="border: 1px solid #2196F3; border-radius: 8px; padding: 15px; background: #e3f2fd;">
                        <h4 style="color: #2196F3; margin-top: 0;">üë• EspoCRM Actions</h4>
                        <button class="btn" onclick="showTab('espocrm-integration')" style="width: 100%; margin-bottom: 8px; background-color: #2196F3;">
                            üîç Search Contacts
                        </button>
                        <p style="font-size: 12px; color: #666; margin: 0;">Jump to EspoCRM tab to search or create contacts</p>
                    </div>
                </div>
            </div>
        </div>

        <div id="jitsi-integration" class="tab-content">
            <h2>üìπ Jitsi Meet Integration</h2>
            <p class="subtitle">Free & Open Source Video Conferencing (Alternative to Zoom)</p>
            
            <div class="config-section">
                <h3>Configuration</h3>
                <form id="jitsi-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="jitsi-enabled">
                            Enable Jitsi Integration
                        </label>
                        <small>Enable video conferencing with Jitsi Meet</small>
                    </div>
                    
                    <div id="jitsi-settings" style="display: none;">
                        <div class="form-group">
                            <label>Server URL:</label>
                            <input type="text" id="jitsi-server-url" placeholder="https://meet.jit.si" value="https://meet.jit.si">
                            <small>Use public server (meet.jit.si) or your self-hosted instance</small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="jitsi-auto-create-rooms" checked>
                                Auto-Create Meeting Rooms
                            </label>
                            <small>Automatically create rooms for call escalation</small>
                        </div>
                        
                        <div class="form-group" style="border: 1px solid #ddd; padding: 15px; border-radius: 5px; background: #f9f9f9;">
                            <h4 style="margin-top: 0;">Advanced: JWT Authentication (Optional)</h4>
                            <p style="font-size: 14px; color: #666;">For self-hosted Jitsi with secure rooms</p>
                            
                            <label>App ID:</label>
                            <input type="text" id="jitsi-app-id" placeholder="your-app-id">
                            <small>JWT application ID from Jitsi configuration</small>
                            
                            <label style="margin-top: 10px;">App Secret:</label>
                            <input type="password" id="jitsi-app-secret" placeholder="your-app-secret">
                            <small>JWT secret key for token generation</small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Configuration</button>
                        <button type="button" class="btn" onclick="testJitsiConnection()">Test Connection</button>
                    </div>
                </form>
                
                <div id="jitsi-status" style="margin-top: 20px;"></div>
            </div>

            <div class="config-section" style="margin-top: 20px;">
                <h3>üìπ Create Video Meeting</h3>
                <div class="info-box" style="margin-bottom: 15px; background-color: #e8f5e9;">
                    <p><strong>üí° Quick Action:</strong> Create instant video meetings or schedule them for later. Share the meeting URL with participants.</p>
                </div>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                        <h4>Instant Meeting</h4>
                        <p style="font-size: 14px; color: #666;">Create a meeting room immediately</p>
                        <div class="form-group">
                            <label>Room Name (optional):</label>
                            <input type="text" id="jitsi-instant-room" placeholder="team-standup">
                            <small>Leave blank for auto-generated name</small>
                        </div>
                        <button class="btn btn-success" onclick="createInstantJitsiMeeting()" style="width: 100%;">
                            üöÄ Create Instant Meeting
                        </button>
                    </div>
                    
                    <div style="border: 1px solid #ddd; padding: 15px; border-radius: 5px;">
                        <h4>Schedule Meeting</h4>
                        <p style="font-size: 14px; color: #666;">Plan a meeting for the future</p>
                        <div class="form-group">
                            <label>Meeting Subject:</label>
                            <input type="text" id="jitsi-schedule-subject" placeholder="Weekly Team Meeting" required>
                        </div>
                        <div class="form-group">
                            <label>Duration (minutes):</label>
                            <input type="number" id="jitsi-schedule-duration" value="60" min="15" max="480">
                        </div>
                        <button class="btn btn-primary" onclick="scheduleJitsiMeeting()" style="width: 100%;">
                            üìÖ Schedule Meeting
                        </button>
                    </div>
                </div>
                
                <div id="jitsi-meeting-result" style="margin-top: 20px; display: none;">
                    <h4>‚úÖ Meeting Created</h4>
                    <div class="info-box" style="background-color: #e8f5e9;">
                        <p><strong>Meeting URL:</strong></p>
                        <div style="display: flex; gap: 10px; align-items: center; margin: 10px 0;">
                            <input type="text" id="jitsi-meeting-url" readonly style="flex: 1; padding: 10px; border: 1px solid #4CAF50; border-radius: 4px; background: white;">
                            <button class="btn btn-secondary" onclick="copyJitsiMeetingUrl()">üìã Copy</button>
                            <button class="btn btn-success" onclick="openJitsiMeeting()">üöÄ Join Now</button>
                        </div>
                        <p style="font-size: 14px; color: #666; margin-top: 10px;">Share this URL with participants to join the meeting.</p>
                    </div>
                </div>
            </div>

            <div class="section-card" style="margin-top: 20px;">
                <h3>Quick Start</h3>
                <div class="code-block" style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto;">
                    <pre style="margin: 0;"># Option 1: Use public server (instant, free)
# Just enable above - no installation needed!

# Option 2: Self-host Jitsi (recommended for production)
wget -qO - https://download.jitsi.org/jitsi-key.gpg.key | sudo apt-key add -
sudo sh -c "echo 'deb https://download.jitsi.org stable/' > /etc/apt/sources.list.d/jitsi-stable.list"
sudo apt-get update
sudo apt-get install jitsi-meet</pre>
                </div>
                <p style="margin-top: 10px;"><strong>Documentation:</strong> <a href="https://jitsi.github.io/handbook/" target="_blank">Jitsi Handbook</a></p>
            </div>
        </div>

        <div id="matrix-integration" class="tab-content">
            <h2>üí¨ Matrix Integration</h2>
            <p class="subtitle">Free & Open Source Team Messaging (Alternative to Slack/Teams)</p>
            
            <div class="config-section">
                <h3>Configuration</h3>
                <form id="matrix-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="matrix-enabled">
                            Enable Matrix Integration
                        </label>
                        <small>Enable team messaging and notifications</small>
                    </div>
                    
                    <div id="matrix-settings" style="display: none;">
                        <div class="form-group">
                            <label>Homeserver URL:</label>
                            <input type="text" id="matrix-homeserver-url" placeholder="https://matrix.org">
                            <small>Public homeserver (matrix.org) or your self-hosted Synapse server</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Bot Username:</label>
                            <input type="text" id="matrix-bot-username" placeholder="@pbxbot:matrix.org">
                            <small>Matrix user ID for PBX bot (@username:server.com)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Bot Password:</label>
                            <input type="password" id="matrix-bot-password" placeholder="bot-password">
                            <small>Password for bot account</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Notification Room ID:</label>
                            <input type="text" id="matrix-notification-room" placeholder="!roomid:matrix.org">
                            <small>Room ID for general notifications (starts with !)</small>
                        </div>
                        
                        <div class="form-group">
                            <label>Voicemail Room ID (optional):</label>
                            <input type="text" id="matrix-voicemail-room" placeholder="!roomid:matrix.org">
                            <small>Separate room for voicemail notifications</small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="matrix-missed-call-notifications" checked>
                                Send Missed Call Notifications
                            </label>
                            <small>Post missed call alerts to notification room</small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Configuration</button>
                        <button type="button" class="btn" onclick="testMatrixConnection()">Test Connection</button>
                    </div>
                </form>
                
                <div id="matrix-status" style="margin-top: 20px;"></div>
            </div>

            <div class="config-section" style="margin-top: 20px;">
                <h3>üí¨ Send Messages</h3>
                <div class="info-box" style="margin-bottom: 15px; background-color: #f3e5f5;">
                    <p><strong>üí° Quick Action:</strong> Send messages to your Matrix rooms for testing or notifications.</p>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px;">
                    <div class="form-group">
                        <label>Select Room:</label>
                        <select id="matrix-room-select">
                            <option value="">Use Default Notification Room</option>
                            <option value="notification">Notification Room</option>
                            <option value="voicemail">Voicemail Room</option>
                            <option value="custom">Custom Room ID...</option>
                        </select>
                    </div>
                    
                    <div class="form-group" id="matrix-custom-room" style="display: none;">
                        <label>Custom Room ID:</label>
                        <input type="text" id="matrix-custom-room-id" placeholder="!roomid:matrix.org">
                        <small>Enter the full Matrix room ID (starts with !)</small>
                    </div>
                    
                    <div class="form-group">
                        <label>Message:</label>
                        <textarea id="matrix-message-text" rows="4" placeholder="Hello from PBX! üëã"></textarea>
                    </div>
                    
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="sendMatrixMessage()" style="flex: 1;">
                            üì§ Send Message
                        </button>
                        <button class="btn btn-secondary" onclick="sendMatrixTestNotification()">
                            üß™ Send Test Notification
                        </button>
                    </div>
                </div>
                
                <div id="matrix-message-result" style="margin-top: 15px; display: none;">
                    <div class="info-box" style="background-color: #e8f5e9;">
                        <p id="matrix-message-result-text"></p>
                    </div>
                </div>
            </div>

            <div class="config-section" style="margin-top: 20px;">
                <h3>üè† Room Management</h3>
                <div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px;">
                    <h4>Create New Room</h4>
                    <div class="form-group">
                        <label>Room Name:</label>
                        <input type="text" id="matrix-new-room-name" placeholder="PBX Notifications">
                    </div>
                    <div class="form-group">
                        <label>Room Topic (optional):</label>
                        <input type="text" id="matrix-new-room-topic" placeholder="Automated notifications from PBX">
                    </div>
                    <button class="btn btn-success" onclick="createMatrixRoom()">
                        ‚ûï Create Room
                    </button>
                </div>
                
                <div id="matrix-room-result" style="margin-top: 15px; display: none;">
                    <div class="info-box" style="background-color: #e8f5e9;">
                        <p><strong>‚úÖ Room Created!</strong></p>
                        <p>Room ID: <code id="matrix-new-room-id"></code></p>
                        <p style="font-size: 14px; color: #666; margin-top: 10px;">Copy this Room ID and use it in the configuration above.</p>
                    </div>
                </div>
            </div>

            <div class="section-card" style="margin-top: 20px;">
                <h3>Quick Start</h3>
                <div class="code-block" style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto;">
                    <pre style="margin: 0;"># Option 1: Use public Matrix homeserver
# 1. Create account at https://app.element.io
# 2. Create bot account for PBX
# 3. Create rooms and get room IDs
# 4. Configure above

# Option 2: Self-host Synapse (Matrix homeserver)
pip3 install matrix-synapse
python3 -m synapse.app.homeserver \
  --server-name my.domain.name \
  --config-path homeserver.yaml \
  --generate-config</pre>
                </div>
                <p style="margin-top: 10px;">
                    <strong>Client:</strong> <a href="https://element.io/" target="_blank">Element</a> (Web, Desktop, Mobile)<br>
                    <strong>Documentation:</strong> <a href="https://matrix.org/docs/guides/" target="_blank">Matrix Docs</a>
                </p>
            </div>
        </div>

        <div id="espocrm-integration" class="tab-content">
            <h2>üë• EspoCRM Integration</h2>
            <p class="subtitle">Free & Open Source CRM (Alternative to Salesforce/HubSpot)</p>
            
            <div class="config-section">
                <h3>Configuration</h3>
                <form id="espocrm-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="espocrm-enabled">
                            Enable EspoCRM Integration
                        </label>
                        <small>Enable CRM features: screen pop, call logging, contact sync</small>
                    </div>
                    
                    <div id="espocrm-settings" style="display: none;">
                        <div class="form-group">
                            <label>API URL:</label>
                            <input type="text" id="espocrm-api-url" placeholder="https://crm.yourcompany.com/api/v1">
                            <small>Your EspoCRM server API endpoint</small>
                        </div>
                        
                        <div class="form-group">
                            <label>API Key:</label>
                            <input type="password" id="espocrm-api-key" placeholder="your-api-key">
                            <small>API key from EspoCRM Administration > API Users</small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="espocrm-auto-create-contacts" checked>
                                Auto-Create Contacts
                            </label>
                            <small>Create new contacts for unknown callers</small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="espocrm-auto-log-calls" checked>
                                Auto-Log Calls
                            </label>
                            <small>Automatically log all calls to CRM</small>
                        </div>
                        
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="espocrm-screen-pop" checked>
                                Enable Screen Pop
                            </label>
                            <small>Show contact info on incoming calls</small>
                        </div>
                        
                        <button type="submit" class="btn btn-primary">Save Configuration</button>
                        <button type="button" class="btn" onclick="testEspoCRMConnection()">Test Connection</button>
                    </div>
                </form>
                
                <div id="espocrm-status" style="margin-top: 20px;"></div>
            </div>

            <div class="config-section" style="margin-top: 20px;">
                <h3>üîç Contact Search</h3>
                <div class="info-box" style="margin-bottom: 15px; background-color: #e3f2fd;">
                    <p><strong>üí° Quick Action:</strong> Search for contacts by phone number, email, or name.</p>
                </div>
                
                <div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px;">
                    <div class="form-group">
                        <label>Search By:</label>
                        <select id="espocrm-search-type">
                            <option value="phone">Phone Number</option>
                            <option value="email">Email Address</option>
                            <option value="name">Name</option>
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label>Search Term:</label>
                        <input type="text" id="espocrm-search-term" placeholder="Enter phone, email, or name">
                    </div>
                    
                    <button class="btn btn-primary" onclick="searchEspoCRMContact()" style="width: 100%;">
                        üîç Search Contact
                    </button>
                </div>
                
                <div id="espocrm-search-results" style="margin-top: 20px; display: none;">
                    <h4>Search Results</h4>
                    <div id="espocrm-contact-details"></div>
                </div>
            </div>

            <div class="config-section" style="margin-top: 20px;">
                <h3>‚ûï Create Contact</h3>
                <div style="border: 1px solid #ddd; padding: 20px; border-radius: 5px;">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>First Name:</label>
                            <input type="text" id="espocrm-new-firstname" placeholder="John">
                        </div>
                        <div class="form-group">
                            <label>Last Name:</label>
                            <input type="text" id="espocrm-new-lastname" placeholder="Doe">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label>Phone Number:</label>
                        <input type="tel" id="espocrm-new-phone" placeholder="+1-555-0100">
                    </div>
                    
                    <div class="form-group">
                        <label>Email:</label>
                        <input type="email" id="espocrm-new-email" placeholder="john.doe@example.com">
                    </div>
                    
                    <div class="form-group">
                        <label>Company (optional):</label>
                        <input type="text" id="espocrm-new-company" placeholder="Acme Corp">
                    </div>
                    
                    <div class="form-group">
                        <label>Title (optional):</label>
                        <input type="text" id="espocrm-new-title" placeholder="Sales Manager">
                    </div>
                    
                    <button class="btn btn-success" onclick="createEspoCRMContact()" style="width: 100%;">
                        ‚ûï Create Contact
                    </button>
                </div>
                
                <div id="espocrm-create-result" style="margin-top: 15px; display: none;">
                    <div class="info-box" style="background-color: #e8f5e9;">
                        <p id="espocrm-create-result-text"></p>
                    </div>
                </div>
            </div>

            <div class="section-card" style="margin-top: 20px;">
                <h3>Quick Start</h3>
                <div class="code-block" style="background: #2d2d2d; color: #f8f8f2; padding: 15px; border-radius: 5px; overflow-x: auto;">
                    <pre style="margin: 0;"># Install EspoCRM
wget https://www.espocrm.com/downloads/EspoCRM-7.x.x.zip
unzip EspoCRM-7.x.x.zip -d /var/www/espocrm

# Setup database and web server
# Follow installation wizard at https://your-server/espocrm

# Generate API Key:
# 1. Login to EspoCRM
# 2. Administration > API Users
# 3. Create new API user
# 4. Copy API Key</pre>
                </div>
                <p style="margin-top: 10px;">
                    <strong>Documentation:</strong> <a href="https://docs.espocrm.com/" target="_blank">EspoCRM Docs</a><br>
                    <strong>Demo:</strong> <a href="https://demo.espocrm.com/" target="_blank">Try Demo</a>
                </p>
            </div>
        </div>

        <div id="crm-integrations" class="tab-content">
            <h2>üîó CRM Integrations</h2>
            
            <div class="config-section">
                <h3>üìä HubSpot Integration</h3>
                <p>Connect to HubSpot for marketing automation and CRM features.</p>
                <form id="hubspot-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="hubspot-enabled">
                            Enable HubSpot Integration
                        </label>
                        <small>Sync contacts and log calls to HubSpot CRM</small>
                    </div>
                    <div id="hubspot-settings" style="display: none;">
                        <div class="form-group">
                            <label>API Key (Bearer Token):</label>
                            <input type="password" id="hubspot-api-key" placeholder="pat-na1-xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                            <small>Your HubSpot API private app token</small>
                        </div>
                        <div class="form-group">
                            <label>Portal ID:</label>
                            <input type="text" id="hubspot-portal-id" placeholder="12345678">
                            <small>Your HubSpot portal/account ID</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="hubspot-sync-contacts" checked>
                                Sync Contacts Automatically
                            </label>
                            <small>Create/update HubSpot contacts from call activity</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="hubspot-create-deals">
                                Create Deals from Calls
                            </label>
                            <small>Automatically create deals for qualified calls</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="hubspot-log-calls" checked>
                                Log Calls as Activities
                            </label>
                            <small>Record call details in contact timelines</small>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save HubSpot Configuration</button>
                </form>
                
                <div class="info-box" style="margin-top: 15px;">
                    <p><strong>‚úÖ Implementation Status:</strong></p>
                    <ul>
                        <li>‚úÖ Contact creation and updates via HubSpot API v3</li>
                        <li>‚úÖ Deal creation and management</li>
                        <li>‚úÖ Activity logging with call details</li>
                        <li>‚úÖ Webhook-based and API-based integration modes</li>
                        <li>‚úÖ Bearer token authentication</li>
                    </ul>
                </div>
            </div>

            <div class="config-section">
                <h3>üé´ Zendesk Integration</h3>
                <p>Connect to Zendesk for helpdesk ticket management.</p>
                <form id="zendesk-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="zendesk-enabled">
                            Enable Zendesk Integration
                        </label>
                        <small>Create and manage support tickets from calls</small>
                    </div>
                    <div id="zendesk-settings" style="display: none;">
                        <div class="form-group">
                            <label>Zendesk Subdomain:</label>
                            <input type="text" id="zendesk-subdomain" placeholder="yourcompany">
                            <small>Your Zendesk subdomain (yourcompany.zendesk.com)</small>
                        </div>
                        <div class="form-group">
                            <label>API Email:</label>
                            <input type="email" id="zendesk-email" placeholder="admin@company.com">
                            <small>Email associated with Zendesk API token</small>
                        </div>
                        <div class="form-group">
                            <label>API Token:</label>
                            <input type="password" id="zendesk-api-token" placeholder="API token">
                            <small>Your Zendesk API token (Settings > API > Add API token)</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="zendesk-create-tickets" checked>
                                Create Tickets Automatically
                            </label>
                            <small>Auto-create tickets for missed or escalated calls</small>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="zendesk-update-tickets">
                                Update Existing Tickets
                            </label>
                            <small>Add call notes to existing customer tickets</small>
                        </div>
                        <div class="form-group">
                            <label>Default Priority:</label>
                            <select id="zendesk-default-priority">
                                <option value="low">Low</option>
                                <option value="normal" selected>Normal</option>
                                <option value="high">High</option>
                                <option value="urgent">Urgent</option>
                            </select>
                            <small>Default priority for auto-created tickets</small>
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Zendesk Configuration</button>
                </form>
                
                <div class="info-box" style="margin-top: 15px;">
                    <p><strong>‚úÖ Implementation Status:</strong></p>
                    <ul>
                        <li>‚úÖ Ticket creation with full metadata via Zendesk API v2</li>
                        <li>‚úÖ Ticket updates and comments</li>
                        <li>‚úÖ Priority, tags, and custom fields support</li>
                        <li>‚úÖ Webhook-based and API-based integration modes</li>
                        <li>‚úÖ Basic authentication with email/token</li>
                    </ul>
                </div>
            </div>

            <div class="config-section">
                <h3>üìä Integration Activity Log</h3>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="loadCRMActivityLog()">üîÑ Refresh Log</button>
                    <button class="btn btn-secondary" onclick="clearCRMActivityLog()">üóëÔ∏è Clear Old Entries</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Integration</th>
                                <th>Action</th>
                                <th>Status</th>
                                <th>Details</th>
                            </tr>
                        </thead>
                        <tbody id="crm-activity-log-table">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh Log" to load activity</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div id="compliance" class="tab-content">
            <h2>‚úÖ Compliance Frameworks</h2>
            
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>SOC 2 Type II</h3>
                    <p>Security compliance controls</p>
                    <ul style="text-align: left; font-size: 14px;">
                        <li>‚úÖ Control tracking and documentation</li>
                        <li>‚úÖ Test evidence recording</li>
                        <li>‚úÖ Implementation status tracking</li>
                        <li>‚úÖ Comprehensive audit logging</li>
                        <li>‚úÖ Trust Services Criteria coverage</li>
                    </ul>
                </div>
                <div class="stat-card">
                    <h3>GDPR Compliance</h3>
                    <p>Data privacy and protection framework</p>
                </div>
                <div class="stat-card">
                    <h3>PCI DSS</h3>
                    <p>Payment card industry standards</p>
                </div>
            </div>
        </div>

        <div id="speech-analytics" class="tab-content">
            <h2>üéôÔ∏è Speech Analytics</h2>
            
            <div class="config-section">
                <h3>‚öôÔ∏è System Configuration</h3>
                <form id="speech-analytics-config-form">
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="speech-analytics-enabled">
                            Enable Speech Analytics
                        </label>
                        <small>Enable real-time transcription and analysis for calls</small>
                    </div>
                    <div class="form-group">
                        <label>Transcription Engine:</label>
                        <select id="speech-engine">
                            <option value="vosk" selected>Vosk (Offline - Default)</option>
                            <option value="google">Google Speech-to-Text (Requires API Key)</option>
                            <option value="azure">Azure Speech Services (Requires API Key)</option>
                            <option value="whisper">OpenAI Whisper (Requires API Key)</option>
                        </select>
                        <small>Vosk provides offline transcription without external dependencies</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="sentiment-analysis-enabled" checked>
                            Enable Sentiment Analysis
                        </label>
                        <small>Analyze caller emotion and sentiment during calls</small>
                    </div>
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="call-summarization-enabled" checked>
                            Enable Call Summarization
                        </label>
                        <small>Generate automatic summaries of transcribed calls</small>
                    </div>
                    <button type="submit" class="btn btn-success">üíæ Save Configuration</button>
                </form>
            </div>

            <div class="config-section">
                <h3>üìã Per-Extension Settings</h3>
                <div class="info-box" style="margin-bottom: 15px;">
                    <p>Configure speech analytics settings for individual extensions. By default, all extensions use system-wide settings.</p>
                </div>
                <div class="action-buttons">
                    <button class="btn btn-primary" onclick="loadSpeechAnalyticsConfigs()">üîÑ Refresh Configurations</button>
                    <button class="btn btn-success" onclick="showAddSpeechAnalyticsConfigModal()">‚ûï Add Extension Config</button>
                </div>
                <div class="table-container">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>Extension</th>
                                <th>Transcription</th>
                                <th>Sentiment</th>
                                <th>Summarization</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="speech-analytics-configs-table">
                            <tr>
                                <td colspan="5" class="loading">Click "Refresh Configurations" to load settings</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="config-section">
                <h3>‚ÑπÔ∏è About Speech Analytics</h3>
                <div class="info-box">
                    <h4>Vosk Offline Transcription (Default)</h4>
                    <p>The system uses Vosk for offline speech recognition, providing:</p>
                    <ul>
                        <li><strong>Privacy:</strong> All transcription happens locally, no data sent to external servers</li>
                        <li><strong>Cost-Effective:</strong> No API fees or usage limits</li>
                        <li><strong>Reliable:</strong> Works without internet connection</li>
                        <li><strong>Real-Time:</strong> Low-latency transcription during active calls</li>
                    </ul>
                    
                    <h4 style="margin-top: 20px;">Features Available</h4>
                    <ul>
                        <li><strong>Live Transcription:</strong> Convert speech to text in real-time using Vosk</li>
                        <li><strong>Sentiment Analysis:</strong> Rule-based emotion detection (positive, negative, neutral)</li>
                        <li><strong>Call Summarization:</strong> Automatic extractive summaries of call content</li>
                        <li><strong>Quality Insights:</strong> Track call quality metrics alongside transcripts</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- New Framework Feature Tabs -->
        <div id="conversational-ai" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="predictive-dialing" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="voice-biometrics" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="call-quality-prediction" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="video-codec" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="bi-integration" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="call-tagging" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="mobile-apps" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="mobile-number-portability" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="recording-analytics" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="call-blending" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="voicemail-drop" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="geographic-redundancy" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="dns-srv-failover" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="session-border-controller" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

        <div id="data-residency" class="tab-content">
            <!-- Content loaded dynamically by framework_features.js -->
        </div>

            </div><!-- end main-content -->
        </div><!-- end layout-wrapper -->
    </div><!-- end container -->

    <!-- Add Extension Modal -->
    <div id="add-extension-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Extension</h3>
                <span class="close" onclick="closeAddExtensionModal()">&times;</span>
            </div>
            <form id="add-extension-form">
                <div class="form-group">
                    <label>Extension Number:</label>
                    <input type="text" id="new-ext-number" required pattern="[0-9]{4}" placeholder="1001">
                    <small>4-digit number</small>
                </div>
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="new-ext-name" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="new-ext-email" required placeholder="john@company.com">
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="new-ext-password" required minlength="8" placeholder="Min 8 characters">
                </div>
                <div class="form-group">
                    <label>Voicemail PIN:</label>
                    <input type="text" id="new-ext-voicemail-pin" required pattern="[0-9]{4,6}" maxlength="6" placeholder="4-6 digits (e.g., 1234)">
                    <small>Required for voicemail security</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="new-ext-allow-external" checked>
                        Allow External Calls
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="new-ext-is-admin">
                        Admin Privileges
                    </label>
                    <small>Grant access to all admin panel features</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddExtensionModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Extension</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Extension Modal -->
    <div id="edit-extension-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Extension</h3>
                <span class="close" onclick="closeEditExtensionModal()">&times;</span>
            </div>
            <form id="edit-extension-form">
                <input type="hidden" id="edit-ext-number">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="edit-ext-name" required>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="edit-ext-email" required>
                </div>
                <div class="form-group">
                    <label>New Password (leave blank to keep current):</label>
                    <input type="password" id="edit-ext-password" minlength="8">
                </div>
                <div class="form-group">
                    <label>Voicemail PIN:</label>
                    <input type="text" id="edit-ext-voicemail-pin" pattern="[0-9]{4,6}" maxlength="6" placeholder="4-6 digits (e.g., 1234)">
                    <small>Leave blank to keep current PIN</small>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-ext-allow-external">
                        Allow External Calls
                    </label>
                </div>
                <div class="form-group">
                    <label>
                        <input type="checkbox" id="edit-ext-is-admin">
                        Admin Privileges
                    </label>
                    <small>Grant access to all admin panel features</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditExtensionModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Extension</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Device Modal -->
    <div id="add-device-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Phone Device</h3>
                <span class="close" onclick="closeAddDeviceModal()">&times;</span>
            </div>
            <form id="add-device-form">
                <div class="form-group">
                    <label>MAC Address:</label>
                    <input type="text" id="device-mac" required placeholder="00:15:65:12:34:56" pattern="^([0-9A-Fa-f]{2}[:-]){5}([0-9A-Fa-f]{2})$">
                    <small>Format: 00:15:65:12:34:56 (found on phone label or network settings)</small>
                </div>
                <div class="form-group">
                    <label>Extension Number:</label>
                    <select id="device-extension" required>
                        <option value="">Select Extension</option>
                    </select>
                    <small>Extension this phone will be assigned to</small>
                </div>
                <div class="form-group">
                    <label>Phone Vendor:</label>
                    <select id="device-vendor" required onchange="updateModelOptions()">
                        <option value="">Select Vendor</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Phone Model:</label>
                    <select id="device-model" required>
                        <option value="">Select Vendor First</option>
                    </select>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddDeviceModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Device</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Template View/Edit Modal -->
    <div id="template-view-modal" class="modal">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <h3 id="template-modal-title">View Template</h3>
                <span class="close" onclick="closeTemplateViewModal()">&times;</span>
            </div>
            <div style="padding: 20px;">
                <div id="template-placeholders" class="info-box" style="margin-bottom: 15px;">
                    <!-- Placeholder information will be inserted here -->
                </div>
                <div class="form-group">
                    <label>Template Content:</label>
                    <textarea id="template-content" rows="20" style="font-family: monospace; width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px;"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTemplateViewModal()">Close</button>
                    <button type="button" id="save-template-btn" class="btn btn-success" style="display: none;">üíæ Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Menu Option Modal -->
    <div id="add-menu-option-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Menu Option</h3>
                <span class="close" onclick="closeAddMenuOptionModal()">&times;</span>
            </div>
            <form id="add-menu-option-form">
                <div class="form-group">
                    <label>Digit (0-9, *, #):</label>
                    <input type="text" id="new-menu-digit" required pattern="[0-9*#]" maxlength="1" placeholder="1">
                    <small>Which digit callers will press</small>
                </div>
                <div class="form-group">
                    <label>Destination Extension:</label>
                    <input type="text" id="new-menu-destination" required placeholder="1001">
                    <small>Extension, queue, or feature code to transfer to</small>
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="new-menu-description" required placeholder="Sales Department">
                    <small>Human-readable description of this menu option</small>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddMenuOptionModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Menu Option</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Edit Menu Option Modal -->
    <div id="edit-menu-option-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Menu Option</h3>
                <span class="close" onclick="closeEditMenuOptionModal()">&times;</span>
            </div>
            <form id="edit-menu-option-form">
                <input type="hidden" id="edit-menu-digit">
                <div class="form-group">
                    <label>Digit: <span id="edit-menu-digit-display"></span></label>
                </div>
                <div class="form-group">
                    <label>Destination Extension:</label>
                    <input type="text" id="edit-menu-destination" required placeholder="1001">
                </div>
                <div class="form-group">
                    <label>Description:</label>
                    <input type="text" id="edit-menu-description" required placeholder="Sales Department">
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeEditMenuOptionModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Update Menu Option</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Emergency Contact Modal -->
    <div id="add-emergency-contact-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add Emergency Contact</h3>
                <span class="close" onclick="closeAddEmergencyContactModal()">&times;</span>
            </div>
            <form id="add-emergency-contact-form" onsubmit="addEmergencyContact(event)">
                <div class="form-group">
                    <label>Name:</label>
                    <input type="text" id="emergency-contact-name" required placeholder="John Doe">
                </div>
                <div class="form-group">
                    <label>Extension:</label>
                    <input type="text" id="emergency-contact-extension" pattern="[0-9]+" placeholder="1001">
                    <small>Internal extension number</small>
                </div>
                <div class="form-group">
                    <label>External Phone:</label>
                    <input type="tel" id="emergency-contact-phone" placeholder="+1-555-0100">
                    <small>External phone number for calls/SMS</small>
                </div>
                <div class="form-group">
                    <label>Email:</label>
                    <input type="email" id="emergency-contact-email" placeholder="john@company.com">
                </div>
                <div class="form-group">
                    <label>Priority Level:</label>
                    <select id="emergency-contact-priority" required>
                        <option value="1">1 - Highest (First Responders)</option>
                        <option value="2">2 - High (Management)</option>
                        <option value="3" selected>3 - Medium (Staff)</option>
                        <option value="4">4 - Low</option>
                        <option value="5">5 - Lowest</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Notification Methods:</label>
                    <div style="margin-top: 10px;">
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-call" value="call" checked>
                            üìû Call (Voice notification)
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-page" value="page">
                            üì¢ Page (Overhead announcement)
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-email" value="email">
                            üìß Email
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" id="method-sms" value="sms">
                            üí¨ SMS (Text message)
                        </label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddEmergencyContactModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Contact</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Trigger Emergency Modal -->
    <div id="trigger-emergency-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üö® Trigger Emergency Notification</h3>
                <span class="close" onclick="closeTriggerEmergencyModal()">&times;</span>
            </div>
            <form id="trigger-emergency-form" onsubmit="triggerEmergency(event)">
                <div class="info-box" style="background: #fee2e2; border-color: #ef4444; margin-bottom: 15px;">
                    <p><strong>‚ö†Ô∏è WARNING:</strong> This will send real emergency notifications to all configured contacts.</p>
                    <p>Only use this for actual emergencies or coordinated testing.</p>
                </div>
                <div class="form-group">
                    <label>Trigger Type:</label>
                    <select id="trigger-type" required>
                        <option value="manual">Manual Trigger</option>
                        <option value="test">Test (Clearly marked as test)</option>
                        <option value="panic_button">Panic Button</option>
                        <option value="other">Other Emergency</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Location/Details:</label>
                    <textarea id="trigger-details" rows="3" placeholder="Building A, Floor 3, Room 301"></textarea>
                </div>
                <div class="form-group">
                    <label>Additional Information:</label>
                    <textarea id="trigger-info" rows="3" placeholder="Describe the situation..."></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeTriggerEmergencyModal()">Cancel</button>
                    <button type="submit" class="btn btn-danger">üö® Send Emergency Notification</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add SIP Trunk Modal -->
    <div id="add-trunk-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚ûï Add SIP Trunk</h3>
                <span class="close" onclick="closeAddTrunkModal()">&times;</span>
            </div>
            <form id="add-trunk-form" onsubmit="addSIPTrunk(event)">
                <div class="form-group">
                    <label>Trunk ID:</label>
                    <input type="text" id="trunk-id" required pattern="[a-zA-Z0-9_-]+" placeholder="trunk_primary">
                    <small>Unique identifier (letters, numbers, underscore, dash)</small>
                </div>
                <div class="form-group">
                    <label>Trunk Name:</label>
                    <input type="text" id="trunk-name" required placeholder="Primary SIP Provider">
                    <small>Descriptive name for this trunk</small>
                </div>
                <div class="form-group">
                    <label>Host/Server:</label>
                    <input type="text" id="trunk-host" required placeholder="sip.provider.com">
                    <small>SIP provider's server address</small>
                </div>
                <div class="form-group">
                    <label>Port:</label>
                    <input type="number" id="trunk-port" value="5060" min="1" max="65535">
                    <small>SIP port (default: 5060)</small>
                </div>
                <div class="form-group">
                    <label>Username:</label>
                    <input type="text" id="trunk-username" required placeholder="account123">
                    <small>SIP authentication username</small>
                </div>
                <div class="form-group">
                    <label>Password:</label>
                    <input type="password" id="trunk-password" required placeholder="********">
                    <small>SIP authentication password</small>
                </div>
                <div class="form-group">
                    <label>Priority:</label>
                    <input type="number" id="trunk-priority" value="100" min="1" max="999">
                    <small>Lower number = higher priority (for failover)</small>
                </div>
                <div class="form-group">
                    <label>Max Channels:</label>
                    <input type="number" id="trunk-channels" value="10" min="1" max="999">
                    <small>Maximum concurrent calls</small>
                </div>
                <div class="form-group">
                    <label>Codec Preferences:</label>
                    <div style="margin-top: 8px;">
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" name="trunk-codecs" value="G.711" checked> G.711 (PCMU/PCMA)
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" name="trunk-codecs" value="G.722"> G.722 HD Audio
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" name="trunk-codecs" value="Opus"> Opus
                        </label>
                        <label style="display: block; margin-bottom: 5px;">
                            <input type="checkbox" name="trunk-codecs" value="G.729"> G.729
                        </label>
                    </div>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddTrunkModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Trunk</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add/Edit FMFM Configuration Modal -->
    <div id="add-fmfm-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîÑ Configure Find Me/Follow Me</h3>
                <span class="close" onclick="closeAddFMFMModal()">&times;</span>
            </div>
            <form id="add-fmfm-form" onsubmit="saveFMFMConfig(event)">
                <div class="form-group">
                    <label>Extension:</label>
                    <input type="text" id="fmfm-extension" required pattern="[0-9]+" placeholder="1001">
                    <small>Extension number to configure FMFM for</small>
                </div>
                <div class="form-group">
                    <label>Mode:</label>
                    <select id="fmfm-mode" required>
                        <option value="sequential">Sequential - Ring one at a time</option>
                        <option value="simultaneous">Simultaneous - Ring all at once</option>
                    </select>
                    <small>How destinations should ring</small>
                </div>
                <div class="form-group">
                    <label>Enabled:</label>
                    <input type="checkbox" id="fmfm-enabled" checked style="width: auto; margin-left: 10px;">
                    <small style="display: block; margin-top: 5px;">Enable FMFM for this extension</small>
                </div>

                <div class="config-section">
                    <h4>Destinations</h4>
                    <div id="fmfm-destinations-list"></div>
                    <button type="button" class="btn btn-secondary" onclick="addFMFMDestinationRow()">‚ûï Add Destination</button>
                </div>

                <div class="form-group">
                    <label>No Answer Destination (Optional):</label>
                    <input type="text" id="fmfm-no-answer" pattern="[0-9]+" placeholder="Extension or voicemail">
                    <small>Where to send the call if no one answers</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddFMFMModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Save Configuration</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Time Routing Rule Modal -->
    <div id="add-time-rule-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚è∞ Add Time-Based Routing Rule</h3>
                <span class="close" onclick="closeAddTimeRuleModal()">&times;</span>
            </div>
            <form id="add-time-rule-form" onsubmit="saveTimeRoutingRule(event)">
                <div class="form-group">
                    <label>Rule Name:</label>
                    <input type="text" id="time-rule-name" required placeholder="Business Hours to Sales">
                    <small>Descriptive name for this rule</small>
                </div>
                <div class="form-group">
                    <label>Original Destination:</label>
                    <input type="text" id="time-rule-destination" required pattern="[0-9]+" placeholder="1000">
                    <small>Extension or queue to apply time-based routing to</small>
                </div>
                <div class="form-group">
                    <label>Route To:</label>
                    <input type="text" id="time-rule-route-to" required pattern="[0-9]+" placeholder="1001">
                    <small>Where to route calls (extension, voicemail, queue)</small>
                </div>

                <div class="config-section">
                    <h4>Time Conditions</h4>
                    
                    <div class="form-group">
                        <label>Days of Week:</label>
                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 5px; margin-top: 8px;">
                            <label><input type="checkbox" name="time-rule-days" value="0" checked> Monday</label>
                            <label><input type="checkbox" name="time-rule-days" value="1" checked> Tuesday</label>
                            <label><input type="checkbox" name="time-rule-days" value="2" checked> Wednesday</label>
                            <label><input type="checkbox" name="time-rule-days" value="3" checked> Thursday</label>
                            <label><input type="checkbox" name="time-rule-days" value="4" checked> Friday</label>
                            <label><input type="checkbox" name="time-rule-days" value="5"> Saturday</label>
                            <label><input type="checkbox" name="time-rule-days" value="6"> Sunday</label>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>Start Time:</label>
                            <input type="time" id="time-rule-start" value="09:00" required>
                        </div>
                        <div class="form-group">
                            <label>End Time:</label>
                            <input type="time" id="time-rule-end" value="17:00" required>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label>Priority:</label>
                    <input type="number" id="time-rule-priority" value="100" min="1" max="999">
                    <small>Lower number = higher priority</small>
                </div>

                <div class="form-group">
                    <label>Enabled:</label>
                    <input type="checkbox" id="time-rule-enabled" checked style="width: auto; margin-left: 10px;">
                    <small style="display: block; margin-top: 5px;">Enable this rule immediately</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddTimeRuleModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Rule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Webhook Modal -->
    <div id="add-webhook-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üîî Add Webhook</h3>
                <span class="close" onclick="closeAddWebhookModal()">&times;</span>
            </div>
            <form id="add-webhook-form" onsubmit="addWebhook(event)">
                <div class="form-group">
                    <label>Webhook URL:</label>
                    <input type="url" id="webhook-url" required placeholder="https://example.com/webhook">
                    <small>The URL to send webhook notifications to</small>
                </div>

                <div class="form-group">
                    <label>Event Types:</label>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 8px; margin-top: 8px;">
                        <label><input type="checkbox" name="webhook-events" value="call_started"> Call Started</label>
                        <label><input type="checkbox" name="webhook-events" value="call_ended"> Call Ended</label>
                        <label><input type="checkbox" name="webhook-events" value="call_answered"> Call Answered</label>
                        <label><input type="checkbox" name="webhook-events" value="extension_registered"> Extension Registered</label>
                        <label><input type="checkbox" name="webhook-events" value="extension_unregistered"> Extension Unregistered</label>
                        <label><input type="checkbox" name="webhook-events" value="voicemail_new"> New Voicemail</label>
                        <label><input type="checkbox" name="webhook-events" value="voicemail_deleted"> Voicemail Deleted</label>
                        <label><input type="checkbox" name="webhook-events" value="*"> All Events</label>
                    </div>
                    <small>Select which events should trigger this webhook</small>
                </div>

                <div class="form-group">
                    <label>Secret (Optional):</label>
                    <input type="text" id="webhook-secret" placeholder="your-secret-key">
                    <small>Used for HMAC signature verification (recommended for security)</small>
                </div>

                <div class="form-group">
                    <label>Enabled:</label>
                    <input type="checkbox" id="webhook-enabled" checked style="width: auto; margin-left: 10px;">
                    <small style="display: block; margin-top: 5px;">Enable this webhook immediately</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddWebhookModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Webhook</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Retention Policy Modal -->
    <div id="add-retention-policy-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üìÅ Add Retention Policy</h3>
                <span class="close" onclick="closeAddRetentionPolicyModal()">&times;</span>
            </div>
            <form id="add-retention-policy-form" onsubmit="addRetentionPolicy(event)">
                <div class="form-group">
                    <label>Policy Name:</label>
                    <input type="text" id="retention-policy-name" required pattern="[a-zA-Z0-9_\s-]+" maxlength="50" placeholder="Standard Policy">
                    <small>Alphanumeric, underscore, hyphen, and spaces only</small>
                </div>

                <div class="form-group">
                    <label>Retention Period (Days):</label>
                    <input type="number" id="retention-days" required min="1" max="3650" value="90" placeholder="90">
                    <small>Number of days to retain recordings (1-3650 days, max 10 years)</small>
                </div>

                <div class="form-group">
                    <label>Tags (Optional):</label>
                    <input type="text" id="retention-tags" placeholder="critical, compliance, training">
                    <small>Comma-separated tags for special handling</small>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddRetentionPolicyModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Add Policy</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Add Blocked Pattern Modal -->
    <div id="add-blocked-pattern-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>üö´ Block Number Pattern</h3>
                <span class="close" onclick="closeAddBlockedPatternModal()">&times;</span>
            </div>
            <form id="add-blocked-pattern-form" onsubmit="addBlockedPattern(event)">
                <div class="form-group">
                    <label>Number Pattern (Regex):</label>
                    <input type="text" id="blocked-pattern" required maxlength="100" placeholder="^900.*">
                    <small>Regular expression to match numbers to block (e.g., ^900.* for 900 numbers)</small>
                </div>

                <div class="form-group">
                    <label>Reason:</label>
                    <input type="text" id="blocked-reason" required maxlength="200" placeholder="Premium rate numbers">
                    <small>Explanation for blocking this pattern</small>
                </div>

                <div class="info-box" style="margin-top: 15px;">
                    <h4>Common Patterns:</h4>
                    <ul>
                        <li><code>^900.*</code> - Block all 900 premium numbers</li>
                        <li><code>^011.*</code> - Block all international calls</li>
                        <li><code>^1900.*</code> - Block specific premium range</li>
                        <li><code>^.*5551234$</code> - Block specific number</li>
                    </ul>
                </div>

                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" onclick="closeAddBlockedPatternModal()">Cancel</button>
                    <button type="submit" class="btn btn-success">Block Pattern</button>
                </div>
            </form>
        </div>
    </div>

    <script src="js/admin.js"></script>
    <script src="js/auto_attendant.js"></script>
    <script src="js/voicemail_enhanced.js"></script>
    <script src="js/webrtc_phone.js"></script>
    <script src="js/framework_features.js"></script>
    <script src="js/opensource_integrations.js"></script>
</body>
</html>
