apiVersion: v1
kind: Service
metadata:
  name: pbx-server
  namespace: pbx-system
  labels:
    app: pbx-server
spec:
  type: LoadBalancer
  selector:
    app: pbx-server
  ports:
  - name: https-api
    port: 8080
    targetPort: 8080
    protocol: TCP
  - name: sip
    port: 5060
    targetPort: 5060
    protocol: UDP
  # RTP port range - adjust based on config.yml
  - name: rtp-start
    port: 10000
    targetPort: 10000
    protocol: UDP
  - name: rtp-end
    port: 20000
    targetPort: 20000
    protocol: UDP
  sessionAffinity: ClientIP
  sessionAffinityConfig:
    clientIP:
      timeoutSeconds: 10800  # 3 hours
---
apiVersion: v1
kind: Service
metadata:
  name: pbx-postgresql
  namespace: pbx-system
  labels:
    app: pbx-postgresql
spec:
  type: ClusterIP
  selector:
    app: pbx-postgresql
  ports:
  - name: postgresql
    port: 5432
    targetPort: 5432
    protocol: TCP
  clusterIP: None  # Headless service for StatefulSet
