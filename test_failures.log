======================================================================
PBX System Test Failures Log
======================================================================
Generated: 2025-12-08 18:59:22
Total Tests: 46
Passed: 33
Failed: 13
======================================================================

❌ 13 test(s) failed:

----------------------------------------------------------------------
Test: test_enterprise_integrations.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Enterprise Integration Tests
============================================================

Testing Zoom Phone routing...
✓ Zoom Phone routing works

Testing Teams Direct Routing...
✗ test_teams_direct_routing failed: Should successfully route with configured trunk

Testing Outlook meeting reminder...
✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core

Testing Active Directory sync...
✓ Active Directory integration structure validated

Testing error handling...
✓ Error handling works correctly

============================================================
Results: 3 passed, 2 failed
============================================================


=== STDERR ===
2025-12-08 18:57:34 - PBX - INFO - Zoom integration enabled
2025-12-08 18:57:34 - PBX - INFO - Routing call from +15551234567 to +15559876543 via Zoom Phone
2025-12-08 18:57:34 - PBX - INFO - Zoom Phone SIP URI: +15559876543@pbx.zoom.us
2025-12-08 18:57:34 - PBX - WARNING - Zoom Phone SIP trunking requires:
1. Zoom Phone license and account
2. Configure SIP trunk credentials in Zoom admin portal
3. Add trunk configuration to config.yml
4. Configure outbound routing rules
5. Test connectivity to pbx.zoom.us
2025-12-08 18:57:34 - PBX - INFO - Routing call from +15551234567 to +15559876543 via Zoom Phone
2025-12-08 18:57:34 - PBX - INFO - Zoom Phone SIP URI: +15559876543@pbx.zoom.us
2025-12-08 18:57:34 - PBX - WARNING - No Zoom Phone SIP trunk found. Configure a trunk in config.yml:
sip_trunks:
  - id: zoom_phone
    name: Zoom Phone Trunk
    host: pbx.zoom.us
    port: 5060
    username: your_zoom_sip_username
    password: your_zoom_sip_password
2025-12-08 18:57:34 - PBX - INFO - Routing call from +15551234567 to +15559876543 via Zoom Phone
2025-12-08 18:57:34 - PBX - INFO - Zoom Phone SIP URI: +15559876543@pbx.zoom.us
2025-12-08 18:57:34 - PBX - INFO - Using SIP trunk 'Zoom Phone Trunk' for Zoom Phone call
2025-12-08 18:57:34 - PBX - INFO - Initiating SIP call to +15559876543@pbx.zoom.us via trunk Zoom Phone Trunk
2025-12-08 18:57:34 - PBX - INFO - Call routed to Zoom Phone: +15551234567 -> +15559876543
2025-12-08 18:57:34 - PBX - ERROR - Teams integration requires 'msal' library. Install with: pip install msal
2025-12-08 18:57:34 - PBX - WARNING - Teams integration is not enabled
2025-12-08 18:57:34 - PBX - WARNING - Teams integration is not enabled
2025-12-08 18:57:34 - PBX - WARNING - Teams integration is not enabled
2025-12-08 18:57:34 - PBX - ERROR - Outlook integration requires 'msal' library. Install with: pip install msal
2025-12-08 18:57:34 - PBX - WARNING - Outlook integration is not enabled
2025-12-08 18:57:34 - PBX - WARNING - Outlook integration is not enabled
2025-12-08 18:57:34 - PBX - WARNING - Zoom integration is not enabled
2025-12-08 18:57:34 - PBX - WARNING - Teams integration is not enabled
2025-12-08 18:57:34 - PBX - WARNING - Outlook integration is not enabled


----------------------------------------------------------------------
Test: test_greeting_recording.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Voicemail Greeting Recording Tests
============================================================

Testing greeting storage...
✓ Greeting storage works
Testing greeting deletion...
✓ Greeting deletion works
Testing IVR options menu...
✓ IVR options menu works
Testing IVR greeting recording...
✓ IVR greeting recording works
Testing IVR save recorded greeting...
✗ test_ivr_save_recorded_greeting failed: Mailbox should have custom greeting
Testing main menu to options navigation...
✓ Main menu to options navigation works
Testing greeting persistence...
✓ Greeting persistence works

============================================================
Results: 6 passed, 1 failed
============================================================


=== STDERR ===
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:35 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:35 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:35 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:35 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:35 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:35 - PBX - INFO - Saved custom greeting for extension 1001
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:35 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:35 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:35 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:35 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:35 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:35 - PBX - INFO - Saved custom greeting for extension 1001
2025-12-08 18:57:35 - PBX - INFO - Deleted custom greeting for extension 1001
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:35 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:35 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:35 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:35 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:35 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:35 - PBX - INFO - Voicemail IVR initialized for extension 1001
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:35 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:35 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:35 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:35 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:35 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:35 - PBX - INFO - Voicemail IVR initialized for extension 1001
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:35 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:35 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:35 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:35 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:35 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:35 - PBX - INFO - Voicemail IVR initialized for extension 1001
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:35 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:35 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:35 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:35 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:35 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:35 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:35 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:35 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:35 - PBX - INFO - Voicemail IVR initialized for extension 1001
2025-12-08 18:57:36 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:57:36 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:57:36 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:57:36 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:57:36 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:57:36 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:57:36 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:57:36 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:57:36 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:57:36 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:57:36 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:36 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:36 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:36 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:36 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:36 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:57:36 - PBX - INFO - Saved custom greeting for extension 1001
2025-12-08 18:57:36 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:57:36 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:57:36 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:57:36 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:57:36 - PBX - INFO - Started daily reminder thread
2025-12-08 18:57:36 - PBX - WARNING - Database not available - loading voicemails from file system only


----------------------------------------------------------------------
Test: test_json_serialization.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running JSON Serialization Tests
============================================================
Testing DateTimeEncoder...
  Serialized JSON: {"id": 1, "name": "Test", "created_at": "2025-12-05T14:30:00", "updated_at": "2025-12-05T15:45:30"}
✓ DateTimeEncoder works correctly
Testing registered phones JSON serialization...
  Serialized 2 phones successfully
✓ Registered phones JSON serialization works correctly
Testing registered phones from database with JSON encoder...
✓ Database registered phones can be serialized to JSON
============================================================
Results: 3 passed, 0 failed
============================================================


=== STDERR ===
2025-12-08 18:58:16 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:16 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:16 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:16 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:16 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:16 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:16 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:16 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:16 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:16 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:16 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:16 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:16 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:16 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:16 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:16 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:16 - PBX - INFO - Creating database tables...
2025-12-08 18:58:16 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:16 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:16 - PBX - INFO - Database tables created successfully


----------------------------------------------------------------------
Test: test_pbx_boot_clear.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running PBX Boot Preserve Integration Test
============================================================
Testing PBX preserves phones on boot...
  Registered 2 phones
  Phones preserved on boot: 2 phones remaining
✓ PBX preserves registered phones on boot
============================================================
Results: 1 passed, 0 failed
============================================================


----------------------------------------------------------------------
Test: test_phone_book_paging.py
----------------------------------------------------------------------

=== STDOUT ===

Running Phone Book and Paging Tests
============================================================
Testing phone book basic operations...
✓ Phone book basic operations passed
Testing phone book export formats...
✓ Phone book export formats passed
Testing paging system basic operations...
✓ Paging system basic operations passed
Testing paging system DAC device configuration...
✓ Paging system DAC device configuration passed
Testing phone book when disabled...
✓ Phone book disabled test passed
Testing paging system when disabled...
✓ Paging system disabled test passed

============================================================
All tests passed! ✓
============================================================


=== STDERR ===
2025-12-08 18:58:21 - PBX - INFO - Phone book feature enabled
2025-12-08 18:58:21 - PBX - INFO - Phone book feature enabled
2025-12-08 18:58:21 - PBX - INFO - Paging system enabled (STUB IMPLEMENTATION)
2025-12-08 18:58:21 - PBX - INFO - Paging prefix: 7
2025-12-08 18:58:21 - PBX - INFO - All-call extension: 700
2025-12-08 18:58:21 - PBX - INFO - Configured zones: 0
2025-12-08 18:58:21 - PBX - WARNING - NOTE: This is a stub implementation. Full paging requires hardware integration.
2025-12-08 18:58:21 - PBX - INFO - Added paging zone: 701 - Zone 1 - Office
2025-12-08 18:58:21 - PBX - INFO - Removed paging zone: 701 - Zone 1 - Office
2025-12-08 18:58:21 - PBX - INFO - Paging system enabled (STUB IMPLEMENTATION)
2025-12-08 18:58:21 - PBX - INFO - Paging prefix: 7
2025-12-08 18:58:21 - PBX - INFO - All-call extension: 700
2025-12-08 18:58:21 - PBX - INFO - Configured zones: 0
2025-12-08 18:58:21 - PBX - WARNING - NOTE: This is a stub implementation. Full paging requires hardware integration.
2025-12-08 18:58:21 - PBX - INFO - Configured DAC device: paging-gateway-1 (cisco_vg224)
2025-12-08 18:58:21 - PBX - INFO - Phone book feature disabled
2025-12-08 18:58:21 - PBX - INFO - Paging system disabled


----------------------------------------------------------------------
Test: test_phone_registration_integration.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Phone Registration Integration Tests
============================================================
Testing MAC address extraction from SIP headers...
  ✓ Extracted MAC from Contact: 001565123456
  ✓ Extracted MAC from User-Agent: 001565aabbcc
  ✓ Correctly handled no MAC: None
  ✓ Extracted MAC with hyphens: 001565112233
✓ MAC address extraction works
Testing phone registration storage...
  ✓ Phone stored in database with all details
    Extension: 1001
    IP: 192.168.1.100
    MAC: 001565123456
    User-Agent: Yealink SIP-T46S 66.85.0.5 00:15:65:12:34:56
  ✓ Re-registration updates existing record
✓ Phone registration storage works
Testing IP-based tracking (no MAC)...
  ✓ Phone tracked by IP: 192.168.1.101
  ✓ MAC correctly stored as None
✓ IP-based tracking works
============================================================
Results: 3 passed, 0 failed
============================================================


=== STDERR ===
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - PostgreSQL requested but psycopg2 not installed. Install with: pip install psycopg2-binary
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: pbx.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/pbx.db
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Database backend initialized successfully (sqlite)
2025-12-08 18:58:22 - PBX - INFO - Extensions, voicemail metadata, and phone registrations will be stored in database
2025-12-08 18:58:22 - PBX - INFO - FIPS 140-2 compliant encryption ENABLED
2025-12-08 18:58:22 - PBX - INFO -   ✓ Using PBKDF2-HMAC-SHA256 for password hashing
2025-12-08 18:58:22 - PBX - INFO -   ✓ Using AES-256-GCM for data encryption
2025-12-08 18:58:22 - PBX - INFO -   ✓ 600,000 iterations for key derivation (OWASP 2024 recommendation)
2025-12-08 18:58:22 - PBX - INFO - No extensions found in database, loading from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loading 4 extensions from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1004 (Customer Service)
2025-12-08 18:58:22 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:22 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:22 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:22 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:22 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:22 - PBX - INFO - Statistics and analytics engine initialized
2025-12-08 18:58:22 - PBX - INFO - Auto Attendant initialized on extension 0
2025-12-08 18:58:22 - PBX - INFO - Menu options: 4
2025-12-08 18:58:22 - PBX - INFO - Auto Attendant initialized on extension 0
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - ERROR - Active Directory integration requires 'ldap3' library. Install with: pip install ldap3
2025-12-08 18:58:22 - PBX - WARNING - Active Directory integration enabled in config but failed to initialize
2025-12-08 18:58:22 - PBX - INFO - Webhook system enabled
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 webhook subscriptions
2025-12-08 18:58:22 - PBX - INFO - Started 2 webhook delivery workers
2025-12-08 18:58:22 - PBX - INFO - WebRTC signaling server enabled
2025-12-08 18:58:22 - PBX - INFO - Started WebRTC session cleanup thread
2025-12-08 18:58:22 - PBX - INFO - WebRTC to SIP gateway initialized
2025-12-08 18:58:22 - PBX - INFO - WebRTC browser calling initialized
2025-12-08 18:58:22 - PBX - INFO - Loaded CRM provider: PhoneBook
2025-12-08 18:58:22 - PBX - INFO - Loaded CRM provider: ActiveDirectory
2025-12-08 18:58:22 - PBX - INFO - CRM integration enabled
2025-12-08 18:58:22 - PBX - INFO - CRM integration and screen pop initialized
2025-12-08 18:58:22 - PBX - INFO - Hot-desking system enabled
2025-12-08 18:58:22 - PBX - INFO - Started hot-desking auto-logout thread
2025-12-08 18:58:22 - PBX - INFO - Hot-desking system initialized
2025-12-08 18:58:22 - PBX - INFO - Threat detection database schema initialized
2025-12-08 18:58:22 - PBX - INFO - Enhanced threat detection initialized
2025-12-08 18:58:22 - PBX - INFO - PBX Core initialized with all features
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - PostgreSQL requested but psycopg2 not installed. Install with: pip install psycopg2-binary
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: pbx.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/pbx.db
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Database backend initialized successfully (sqlite)
2025-12-08 18:58:22 - PBX - INFO - Extensions, voicemail metadata, and phone registrations will be stored in database
2025-12-08 18:58:22 - PBX - INFO - No extensions found in database, loading from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loading 4 extensions from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1004 (Customer Service)
2025-12-08 18:58:22 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:22 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:22 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:22 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:22 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:22 - PBX - INFO - Statistics and analytics engine initialized
2025-12-08 18:58:22 - PBX - INFO - Auto Attendant initialized on extension 0
2025-12-08 18:58:22 - PBX - INFO - Menu options: 4
2025-12-08 18:58:22 - PBX - INFO - Auto Attendant initialized on extension 0
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - ERROR - Active Directory integration requires 'ldap3' library. Install with: pip install ldap3
2025-12-08 18:58:22 - PBX - WARNING - Active Directory integration enabled in config but failed to initialize
2025-12-08 18:58:22 - PBX - INFO - Webhook system enabled
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 webhook subscriptions
2025-12-08 18:58:22 - PBX - INFO - Started 2 webhook delivery workers
2025-12-08 18:58:22 - PBX - INFO - WebRTC signaling server enabled
2025-12-08 18:58:22 - PBX - INFO - Started WebRTC session cleanup thread
2025-12-08 18:58:22 - PBX - INFO - WebRTC to SIP gateway initialized
2025-12-08 18:58:22 - PBX - INFO - WebRTC browser calling initialized
2025-12-08 18:58:22 - PBX - INFO - Loaded CRM provider: PhoneBook
2025-12-08 18:58:22 - PBX - INFO - Loaded CRM provider: ActiveDirectory
2025-12-08 18:58:22 - PBX - INFO - CRM integration enabled
2025-12-08 18:58:22 - PBX - INFO - CRM integration and screen pop initialized
2025-12-08 18:58:22 - PBX - INFO - Hot-desking system enabled
2025-12-08 18:58:22 - PBX - INFO - Started hot-desking auto-logout thread
2025-12-08 18:58:22 - PBX - INFO - Hot-desking system initialized
2025-12-08 18:58:22 - PBX - INFO - Threat detection database schema initialized
2025-12-08 18:58:22 - PBX - INFO - Enhanced threat detection initialized
2025-12-08 18:58:22 - PBX - INFO - PBX Core initialized with all features
2025-12-08 18:58:22 - PBX - INFO - Database disconnected
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Extension 1001 registered from ('192.168.1.100', 5060)
2025-12-08 18:58:22 - PBX - INFO - Extension 1001 registered from ('192.168.1.100', 5060)
2025-12-08 18:58:22 - PBX - INFO - Stored phone registration: ext=1001, ip=192.168.1.100, mac=001565123456
2025-12-08 18:58:22 - PBX - INFO - Extension 1001 registered from ('192.168.1.100', 5060)
2025-12-08 18:58:22 - PBX - INFO - Extension 1001 registered from ('192.168.1.100', 5060)
2025-12-08 18:58:22 - PBX - INFO - Stored phone registration: ext=1001, ip=192.168.1.100, mac=001565123456
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - PostgreSQL requested but psycopg2 not installed. Install with: pip install psycopg2-binary
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: pbx.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/pbx.db
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Database backend initialized successfully (sqlite)
2025-12-08 18:58:22 - PBX - INFO - Extensions, voicemail metadata, and phone registrations will be stored in database
2025-12-08 18:58:22 - PBX - INFO - No extensions found in database, loading from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loading 4 extensions from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1004 (Customer Service)
2025-12-08 18:58:22 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:22 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:22 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:22 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:22 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:22 - PBX - INFO - Statistics and analytics engine initialized
2025-12-08 18:58:22 - PBX - INFO - Auto Attendant initialized on extension 0
2025-12-08 18:58:22 - PBX - INFO - Menu options: 4
2025-12-08 18:58:22 - PBX - INFO - Auto Attendant initialized on extension 0
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - ERROR - Active Directory integration requires 'ldap3' library. Install with: pip install ldap3
2025-12-08 18:58:22 - PBX - WARNING - Active Directory integration enabled in config but failed to initialize
2025-12-08 18:58:22 - PBX - INFO - Webhook system enabled
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 webhook subscriptions
2025-12-08 18:58:22 - PBX - INFO - Started 2 webhook delivery workers
2025-12-08 18:58:22 - PBX - INFO - WebRTC signaling server enabled
2025-12-08 18:58:22 - PBX - INFO - Started WebRTC session cleanup thread
2025-12-08 18:58:22 - PBX - INFO - WebRTC to SIP gateway initialized
2025-12-08 18:58:22 - PBX - INFO - WebRTC browser calling initialized
2025-12-08 18:58:22 - PBX - INFO - Loaded CRM provider: PhoneBook
2025-12-08 18:58:22 - PBX - INFO - Loaded CRM provider: ActiveDirectory
2025-12-08 18:58:22 - PBX - INFO - CRM integration enabled
2025-12-08 18:58:22 - PBX - INFO - CRM integration and screen pop initialized
2025-12-08 18:58:22 - PBX - INFO - Hot-desking system enabled
2025-12-08 18:58:22 - PBX - INFO - Started hot-desking auto-logout thread
2025-12-08 18:58:22 - PBX - INFO - Hot-desking system initialized
2025-12-08 18:58:22 - PBX - INFO - Threat detection database schema initialized
2025-12-08 18:58:22 - PBX - INFO - Enhanced threat detection initialized
2025-12-08 18:58:22 - PBX - INFO - PBX Core initialized with all features
2025-12-08 18:58:22 - PBX - INFO - Extension 1002 registered from ('192.168.1.101', 5060)
2025-12-08 18:58:22 - PBX - INFO - Extension 1002 registered from ('192.168.1.101', 5060)
2025-12-08 18:58:22 - PBX - INFO - Stored phone registration: ext=1002, ip=192.168.1.101 (no MAC)


----------------------------------------------------------------------
Test: test_provisioning.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Phone Provisioning Tests
============================================================
Testing MAC address normalization...
✓ MAC address normalization works
Testing phone template...
✓ Phone template works
Testing device registration...
✓ Device registration works
Testing supported vendors and models...
✓ Supported vendors and models work
Testing built-in templates...
✓ Built-in templates exist
Testing configuration generation...
✓ Configuration generation works
Testing unregistered device error messages...
✓ Unregistered device error messages work
Testing similar MAC detection...
✓ Similar MAC detection works
Testing MAC placeholder detection...
✓ MAC placeholder detection works
============================================================
All tests passed!
============================================================


=== STDERR ===
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use in-memory storage only
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:15:65:12:34:56 for extension 1001 (in-memory only)
2025-12-08 18:58:22 - PBX - INFO - Unregistered device 00:15:65:12:34:56 (removed from memory)
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use in-memory storage only
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use in-memory storage only
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use in-memory storage only
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - FIPS 140-2 compliant encryption ENABLED
2025-12-08 18:58:22 - PBX - INFO -   ✓ Using PBKDF2-HMAC-SHA256 for password hashing
2025-12-08 18:58:22 - PBX - INFO -   ✓ Using AES-256-GCM for data encryption
2025-12-08 18:58:22 - PBX - INFO -   ✓ 600,000 iterations for key derivation (OWASP 2024 recommendation)
2025-12-08 18:58:22 - PBX - INFO - Loading 4 extensions from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1004 (Customer Service)
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:15:65:12:34:56 for extension 1001 (in-memory only)
2025-12-08 18:58:22 - PBX - INFO - Provisioning request received for MAC: 00:15:65:12:34:56
2025-12-08 18:58:22 - PBX - INFO -   Found device: vendor=zultys, model=zip33g, extension=1001
2025-12-08 18:58:22 - PBX - INFO -   Extension found: 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO -   Server config: SIP=192.168.1.14:5060
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully generated config for device 00:15:65:12:34:56
2025-12-08 18:58:22 - PBX - INFO -   Config size: 2332 bytes, Content-Type: text/plain
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use in-memory storage only
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Loading 4 extensions from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1004 (Customer Service)
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:0B:EA:85:ED:68 for extension 1001 (in-memory only)
2025-12-08 18:58:22 - PBX - INFO - Provisioning request received for MAC: 00:0B:EA:85:F5:54
2025-12-08 18:58:22 - PBX - WARNING - Device 00:0B:EA:85:F5:54 not registered in provisioning system
2025-12-08 18:58:22 - PBX - WARNING -   Normalized MAC: 000bea85f554
2025-12-08 18:58:22 - PBX - WARNING -   Registered devices: ['000bea85ed68']
2025-12-08 18:58:22 - PBX - WARNING -   → Device needs to be registered first
2025-12-08 18:58:22 - PBX - WARNING -   → Register via API: POST /api/provisioning/devices
2025-12-08 18:58:22 - PBX - WARNING -   → Example:
2025-12-08 18:58:22 - PBX - WARNING -      curl -X POST http://YOUR_PBX_IP:8080/api/provisioning/devices \
2025-12-08 18:58:22 - PBX - WARNING -        -H 'Content-Type: application/json' \
2025-12-08 18:58:22 - PBX - WARNING -        -d '{"mac_address":"00:0B:EA:85:F5:54","extension_number":"XXXX","vendor":"VENDOR","model":"MODEL"}'
2025-12-08 18:58:22 - PBX - WARNING -   → Available vendors: yealink, polycom, cisco, grandstream, zultys
2025-12-08 18:58:22 - PBX - WARNING -   → Similar MACs found (same vendor): ['000bea85ed68']
2025-12-08 18:58:22 - PBX - WARNING -      This might be a typo in the MAC address
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use in-memory storage only
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for grandstream gxp2170
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip33g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for cisco spa504g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for yealink t46s
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for zultys zip37g
2025-12-08 18:58:22 - PBX - INFO - Loaded custom template for polycom vvx450
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Loading 4 extensions from config.yml
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
2025-12-08 18:58:22 - PBX - INFO - Loaded extension 1004 (Customer Service)
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:0B:EA:85:ED:68 for extension 1001 (in-memory only)
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:0B:EA:85:F5:54 for extension 1002 (in-memory only)
2025-12-08 18:58:22 - PBX - INFO - Provisioning request received for MAC: 00:0B:EA:85:ED:69
2025-12-08 18:58:22 - PBX - WARNING - Device 00:0B:EA:85:ED:69 not registered in provisioning system
2025-12-08 18:58:22 - PBX - WARNING -   Normalized MAC: 000bea85ed69
2025-12-08 18:58:22 - PBX - WARNING -   Registered devices: ['000bea85ed68', '000bea85f554']
2025-12-08 18:58:22 - PBX - WARNING -   → Device needs to be registered first
2025-12-08 18:58:22 - PBX - WARNING -   → Register via API: POST /api/provisioning/devices
2025-12-08 18:58:22 - PBX - WARNING -   → Example:
2025-12-08 18:58:22 - PBX - WARNING -      curl -X POST http://YOUR_PBX_IP:8080/api/provisioning/devices \
2025-12-08 18:58:22 - PBX - WARNING -        -H 'Content-Type: application/json' \
2025-12-08 18:58:22 - PBX - WARNING -        -d '{"mac_address":"00:0B:EA:85:ED:69","extension_number":"XXXX","vendor":"VENDOR","model":"MODEL"}'
2025-12-08 18:58:22 - PBX - WARNING -   → Available vendors: yealink, polycom, cisco, grandstream, zultys
2025-12-08 18:58:22 - PBX - WARNING -   → Similar MACs found (same vendor): ['000bea85ed68', '000bea85f554']
2025-12-08 18:58:22 - PBX - WARNING -      This might be a typo in the MAC address


----------------------------------------------------------------------
Test: test_provisioning_persistence.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Provisioning Persistence Tests
============================================================
Testing provisioning persistence...
  Registered 2 devices in first instance
  Devices persisted correctly: 2 devices loaded
✓ Provisioning persistence works
Testing static IP assignment...
  Set static IP: Static IP 192.168.1.100 set for device 00:15:65:12:34:56
  Static IP verified: 192.168.1.100
✓ Static IP assignment works
Testing device unregister removes from database...
✓ Device unregister removes from database
============================================================
Results: 3 passed, 0 failed
============================================================


=== STDERR ===
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: /tmp/tmpduyhtkm3/test.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /tmp/tmpduyhtkm3/test.db
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: Not configured
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:15:65:12:34:56 for extension 1001 (saved to database)
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:15:65:12:34:57 for extension 1002 (saved to database)
2025-12-08 18:58:22 - PBX - INFO - Database disconnected
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: /tmp/tmpduyhtkm3/test.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /tmp/tmpduyhtkm3/test.db
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 2 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: Not configured
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Database disconnected
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: /tmp/tmpfxqu5e23/test.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /tmp/tmpfxqu5e23/test.db
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: Not configured
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:15:65:12:34:56 for extension 1001 (saved to database)
2025-12-08 18:58:22 - PBX - INFO - Set static IP 192.168.1.100 for device 00:15:65:12:34:56
2025-12-08 18:58:22 - PBX - INFO - Database disconnected
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: /tmp/tmpr980bmy6/test.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /tmp/tmpr980bmy6/test.db
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: Not configured
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Registered device 00:15:65:12:34:56 for extension 1001 (saved to database)
2025-12-08 18:58:22 - PBX - INFO - Unregistered device 00:15:65:12:34:56 (removed from database)
2025-12-08 18:58:22 - PBX - INFO - Database disconnected
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: /tmp/tmpr980bmy6/test.db
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /tmp/tmpr980bmy6/test.db
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning will use database for persistent storage
2025-12-08 18:58:22 - PBX - INFO - Loaded 0 provisioned devices from database
2025-12-08 18:58:22 - PBX - INFO - Loaded 6 built-in phone templates
2025-12-08 18:58:22 - PBX - INFO - Phone provisioning initialized
2025-12-08 18:58:22 - PBX - INFO - Provisioning URL format: Not configured
2025-12-08 18:58:22 - PBX - INFO - Server external IP: 192.168.1.14
2025-12-08 18:58:22 - PBX - INFO - API port: 8080
2025-12-08 18:58:22 - PBX - INFO - Database disconnected


----------------------------------------------------------------------
Test: test_registered_phones.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Registered Phones Tests
============================================================
Testing phone registration...
✓ Phone registration with MAC works
Testing phone registration without MAC (IP-based)...
✓ Phone registration without MAC (IP-based) works
Testing phone registration update...
✓ Phone registration update works
Testing listing phones by extension...
✓ Listing phones by extension works
Testing listing all phones...
✓ Listing all phones works
Testing MAC preservation on re-registration...
✓ MAC preservation on re-registration works
Testing IP preservation on re-registration...
✓ IP preservation on re-registration works
Testing phone extension update (reprovisioning)...
✓ Phone extension update (reprovisioning) works
Testing phone extension update validation...
✓ Phone extension update validation works
============================================================
Results: 9 passed, 0 failed
============================================================


=== STDERR ===
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - INFO - Updated phone 001565AABBCC to extension 1002
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:22 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:22 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:22 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:22 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:22 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:22 - PBX - INFO -   Database file: :memory:
2025-12-08 18:58:22 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:22 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/:memory:
2025-12-08 18:58:22 - PBX - INFO - Creating database tables...
2025-12-08 18:58:22 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:22 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:22 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:22 - PBX - ERROR - Cannot update phone extension: MAC address is required
2025-12-08 18:58:22 - PBX - ERROR - Cannot update phone extension: MAC address is required


----------------------------------------------------------------------
Test: test_statistics.py
----------------------------------------------------------------------

=== STDERR ===
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/tests/test_statistics.py", line 11, in <module>
    from pbx.features.cdr import CDRSystem, CDRRecord, CallDisposition
ModuleNotFoundError: No module named 'pbx'


----------------------------------------------------------------------
Test: test_voicemail_database.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Voicemail Database Tests
============================================================

Testing database configuration...
✗ test_database_configuration failed: 
Testing database backend initialization...
✓ Database backend initializes correctly
Testing voicemail database integration...
✓ Voicemail database integration works correctly
Testing voicemail system without database...
✓ Voicemail system works without database

============================================================
Results: 3 passed, 1 failed
============================================================


=== STDERR ===
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:38 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:38 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_database.py", line 204, in run_all_tests
    test()
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_database.py", line 28, in test_database_configuration
    assert config.get('database.port') == 5432
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
AssertionError
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:38 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:38 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:38 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:38 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:38 - PBX - INFO -   Database file: /tmp/tmpjnljr5g4.db
2025-12-08 18:58:38 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:38 - PBX - INFO -   Database path: /tmp/tmpjnljr5g4.db
2025-12-08 18:58:38 - PBX - INFO - Creating database tables...
2025-12-08 18:58:38 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:38 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:38 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:38 - PBX - INFO - Database disconnected
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:38 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:38 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:38 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:38 - PBX - INFO - Database backend: sqlite
2025-12-08 18:58:38 - PBX - INFO - Initiating database connection (type: sqlite)...
2025-12-08 18:58:38 - PBX - INFO - Connecting to SQLite database...
2025-12-08 18:58:38 - PBX - INFO -   Database file: /tmp/tmpqgvenvhk.db
2025-12-08 18:58:38 - PBX - INFO - ✓ Successfully connected to SQLite database
2025-12-08 18:58:38 - PBX - INFO -   Database path: /tmp/tmpqgvenvhk.db
2025-12-08 18:58:38 - PBX - INFO - Creating database tables...
2025-12-08 18:58:39 - PBX - INFO - Checking for schema migrations...
2025-12-08 18:58:39 - PBX - INFO - Schema migration check complete
2025-12-08 18:58:39 - PBX - INFO - Database tables created successfully
2025-12-08 18:58:39 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:39 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:39 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:39 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:39 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:39 - PBX - INFO - Loading voicemail messages from database for extension 1001...
2025-12-08 18:58:39 - PBX - INFO - ✓ Successfully loaded 0 voicemail message(s) from sqlite database
2025-12-08 18:58:39 - PBX - INFO - Voicemail saved to file system for extension 1001
2025-12-08 18:58:39 - PBX - INFO -   Message ID: 1002_20251208_185839
2025-12-08 18:58:39 - PBX - INFO -   Caller ID: 1002
2025-12-08 18:58:39 - PBX - INFO -   File path: /tmp/tmp1qzpztc2/1001/1002_20251208_185839.wav
2025-12-08 18:58:39 - PBX - INFO -   Duration: 30s
2025-12-08 18:58:39 - PBX - INFO - Saving voicemail metadata to database...
2025-12-08 18:58:39 - PBX - INFO - ✓ Voicemail metadata successfully saved to sqlite database
2025-12-08 18:58:39 - PBX - INFO -   Extension: 1001
2025-12-08 18:58:39 - PBX - INFO -   Message ID: 1002_20251208_185839
2025-12-08 18:58:39 - PBX - INFO -   Caller: 1002
2025-12-08 18:58:39 - PBX - WARNING - Cannot send email notification - SMTP not properly configured (host: , from: Voicemail@albl.com)
2025-12-08 18:58:39 - PBX - INFO - Marked voicemail 1002_20251208_185839 as listened
2025-12-08 18:58:39 - PBX - INFO - Updating voicemail listened status in database...
2025-12-08 18:58:39 - PBX - INFO - ✓ Successfully updated voicemail 1002_20251208_185839 as listened in sqlite database
2025-12-08 18:58:39 - PBX - INFO - Deleting voicemail 1002_20251208_185839...
2025-12-08 18:58:39 - PBX - INFO -   ✓ Deleted audio file: /tmp/tmp1qzpztc2/1001/1002_20251208_185839.wav
2025-12-08 18:58:39 - PBX - INFO - Deleting voicemail from database...
2025-12-08 18:58:39 - PBX - INFO -   ✓ Successfully deleted voicemail 1002_20251208_185839 from sqlite database
2025-12-08 18:58:39 - PBX - INFO - ✓ Voicemail 1002_20251208_185839 deleted successfully
2025-12-08 18:58:39 - PBX - INFO - Database disconnected
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:39 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:39 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:39 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:39 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:39 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:58:39 - PBX - INFO - Voicemail saved to file system for extension 1001
2025-12-08 18:58:39 - PBX - INFO -   Message ID: 1002_20251208_185839
2025-12-08 18:58:39 - PBX - INFO -   Caller ID: 1002
2025-12-08 18:58:39 - PBX - INFO -   File path: /tmp/tmp5upooeb9/1001/1002_20251208_185839.wav
2025-12-08 18:58:39 - PBX - INFO -   Duration: 30s
2025-12-08 18:58:39 - PBX - WARNING - Database not available - voicemail metadata NOT saved to database
2025-12-08 18:58:39 - PBX - WARNING -   Message ID: 1002_20251208_185839 stored as file only
2025-12-08 18:58:39 - PBX - WARNING - Cannot send email notification - SMTP not properly configured (host: , from: Voicemail@albl.com)


----------------------------------------------------------------------
Test: test_voicemail_email.py
----------------------------------------------------------------------

=== STDOUT ===
============================================================
Running Voicemail Email Tests
============================================================

Testing email notifier configuration...
✗ test_email_notifier_config failed: 
Testing email notifier initialization...
✗ test_email_notifier_initialization failed: 
Testing voicemail system with email integration...
✓ Voicemail system integrates with email correctly
Testing extension email configuration...
✓ Extensions have email addresses configured
Testing no-answer timeout configuration...
✓ No-answer timeout configured correctly

============================================================
Results: 3 passed, 2 failed
============================================================


=== STDERR ===
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:39 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:39 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:39 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:39 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
2025-12-08 18:58:39 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
2025-12-08 18:58:39 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
2025-12-08 18:58:39 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
2025-12-08 18:58:39 - PBX - INFO - Started daily reminder thread
2025-12-08 18:58:39 - PBX - WARNING - Database not available - loading voicemails from file system only
2025-12-08 18:58:39 - PBX - INFO - Voicemail saved to file system for extension 1001
2025-12-08 18:58:39 - PBX - INFO -   Message ID: 1002_20251208_185839
2025-12-08 18:58:39 - PBX - INFO -   Caller ID: 1002
2025-12-08 18:58:39 - PBX - INFO -   File path: /tmp/tmp9nya5tsl/1001/1002_20251208_185839.wav
2025-12-08 18:58:39 - PBX - INFO -   Duration: 30s
2025-12-08 18:58:39 - PBX - WARNING - Database not available - voicemail metadata NOT saved to database
2025-12-08 18:58:39 - PBX - WARNING -   Message ID: 1002_20251208_185839 stored as file only
2025-12-08 18:58:39 - PBX - WARNING - Cannot send email notification - SMTP not properly configured (host: , from: Voicemail@albl.com)
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_NAME not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable DB_USER not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable DB_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_HOST not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_PORT not set, using default value
2025-12-08 18:58:39 - PBX - INFO - Environment variable SMTP_USERNAME not set, using default value
2025-12-08 18:58:39 - PBX - ERROR - Environment variable SMTP_PASSWORD not found and no default available
2025-12-08 18:58:39 - PBX - ERROR - Environment variable AD_BIND_PASSWORD not found and no default available


----------------------------------------------------------------------
Test: test_voicemail_transcription.py
----------------------------------------------------------------------

=== STDERR ===
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_transcription.py", line 19, in <module>
    from pbx.features.voicemail_transcription import VoicemailTranscriptionService
ModuleNotFoundError: No module named 'pbx'


