
================================================================================
Test Run Started: 2025-12-08 17:20:44
================================================================================

[2025-12-08 17:20:44] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

================================================================================
Test Run Completed: 2025-12-08 17:20:53
Summary: 6 passed, 1 failed, 39 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:21:41
================================================================================

[2025-12-08 17:21:41] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

================================================================================
Test Run Completed: 2025-12-08 17:21:50
Summary: 6 passed, 1 failed, 39 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:24:05
================================================================================

[2025-12-08 17:24:05] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

================================================================================
Test Run Completed: 2025-12-08 17:24:14
Summary: 6 passed, 1 failed, 39 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:26:49
================================================================================

[2025-12-08 17:26:49] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

================================================================================
Test Run Completed: 2025-12-08 17:26:59
Summary: 6 passed, 1 failed, 39 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:34:13
================================================================================

[2025-12-08 17:34:14] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

================================================================================
Test Run Completed: 2025-12-08 17:34:23
Summary: 6 passed, 1 failed, 39 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:42:05
================================================================================

[2025-12-08 17:42:06] FAILED: test_dtmf_detection.py
  Return value: False (expected True)

  Test Errors:
    test_detect_sequence (test_dtmf_detection.TestDTMFDetection.test_detect_sequence)
    Test detection of a sequence of DTMF tones ... ok
    test_detect_valid_tone_1 (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_1)
    Test detection of valid DTMF tone '1' ... ok
    test_detect_valid_tone_5 (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_5)
    Test detection of valid DTMF tone '5' ... ok
    test_detect_valid_tone_pound (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_pound)
    Test detection of valid DTMF tone '#' ... ok
    test_detect_valid_tone_star (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_star)
    Test detection of valid DTMF tone '*' ... ok
    test_no_detection_on_silence (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_silence)
    Test that silence does not trigger false DTMF detection ... ok
    test_no_detection_on_single_frequency (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_single_frequency)
    Test that a single frequency tone is not detected as DTMF ... ok
    test_no_detection_on_weak_tone (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_weak_tone)
    Test that very weak tones are not detected ... ok
    test_no_detection_on_white_noise (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_white_noise)
    Test that white noise does not trigger false DTMF detection ... FAIL
    test_noise_rejection_ratio (test_dtmf_detection.TestDTMFDetection.test_noise_rejection_ratio)
    Test that detector properly handles noisy signals ... ok
    test_threshold_parameter (test_dtmf_detection.TestDTMFDetection.test_threshold_parameter)
    Test that threshold parameter works correctly ... ok
    test_generate_invalid_digit (test_dtmf_detection.TestDTMFGenerator.test_generate_invalid_digit)
    Test generating tone for invalid digit ... ok
    test_generate_sequence (test_dtmf_detection.TestDTMFGenerator.test_generate_sequence)
    Test generating a sequence of tones ... ok
    test_generate_tone (test_dtmf_detection.TestDTMFGenerator.test_generate_tone)
    Test generating a single DTMF tone ... ok
    
    ======================================================================
    FAIL: test_no_detection_on_white_noise (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_white_noise)
    Test that white noise does not trigger false DTMF detection
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/tests/test_dtmf_detection.py", line 69, in test_no_detection_on_white_noise
        self.assertIsNone(digit, "White noise should not be detected as DTMF tone")
    AssertionError: 'A' is not None : White noise should not be detected as DTMF tone
    
    ----------------------------------------------------------------------
    Ran 14 tests in 0.008s
    
    FAILED (failures=1)

[2025-12-08 17:42:06] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

[2025-12-08 17:42:06] FAILED: test_extension_db_registration.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Extension Database Registration Tests
    ============================================================
    Testing database-based extension registration...
    
    ✗ Test failed: Failed to add extension to database

  Test Errors:
    2025-12-08 17:42:06 - PBX - ERROR - PostgreSQL requested but psycopg2 not installed. Install with: pip install psycopg2-binary
    2025-12-08 17:42:06 - PBX - INFO - Database backend: sqlite
    2025-12-08 17:42:06 - PBX - INFO - Initiating database connection (type: sqlite)...
    2025-12-08 17:42:06 - PBX - INFO - Connecting to SQLite database...
    2025-12-08 17:42:06 - PBX - INFO -   Database file: pbx.db
    2025-12-08 17:42:06 - PBX - INFO - ✓ Successfully connected to SQLite database
    2025-12-08 17:42:06 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/pbx.db
    2025-12-08 17:42:06 - PBX - INFO - Creating database tables...
    2025-12-08 17:42:06 - PBX - INFO - Checking for schema migrations...
    2025-12-08 17:42:06 - PBX - INFO - Schema migration check complete
    2025-12-08 17:42:06 - PBX - INFO - Database tables created successfully
    2025-12-08 17:42:06 - PBX - INFO - Database backend initialized successfully (sqlite)
    2025-12-08 17:42:06 - PBX - INFO - Extensions, voicemail metadata, and phone registrations will be stored in database
    2025-12-08 17:42:06 - PBX - INFO - FIPS 140-2 compliant encryption ENABLED
    2025-12-08 17:42:06 - PBX - INFO -   ✓ Using PBKDF2-HMAC-SHA256 for password hashing
    2025-12-08 17:42:06 - PBX - INFO -   ✓ Using AES-256-GCM for data encryption
    2025-12-08 17:42:06 - PBX - INFO -   ✓ 600,000 iterations for key derivation (OWASP 2024 recommendation)
    2025-12-08 17:42:06 - PBX - INFO - No extensions found in database, loading from config.yml
    2025-12-08 17:42:06 - PBX - INFO - Loading 4 extensions from config.yml
    2025-12-08 17:42:06 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
    2025-12-08 17:42:06 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
    2025-12-08 17:42:06 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
    2025-12-08 17:42:06 - PBX - INFO - Loaded extension 1004 (Customer Service)
    2025-12-08 17:42:06 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
    2025-12-08 17:42:06 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
    2025-12-08 17:42:06 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
    2025-12-08 17:42:06 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
    2025-12-08 17:42:06 - PBX - INFO - Started daily reminder thread
    2025-12-08 17:42:06 - PBX - INFO - Statistics and analytics engine initialized
    2025-12-08 17:42:06 - PBX - INFO - Auto Attendant initialized on extension 0
    2025-12-08 17:42:06 - PBX - INFO - Menu options: 4
    2025-12-08 17:42:06 - PBX - INFO - Auto Attendant initialized on extension 0
    2025-12-08 17:42:06 - PBX - INFO - Phone provisioning will use database for persistent storage
    2025-12-08 17:42:06 - PBX - INFO - Loaded 0 provisioned devices from database
    2025-12-08 17:42:06 - PBX - INFO - Loaded 6 built-in phone templates
    2025-12-08 17:42:06 - PBX - INFO - Loaded custom template for grandstream gxp2170
    2025-12-08 17:42:06 - PBX - INFO - Loaded custom template for zultys zip33g
    2025-12-08 17:42:06 - PBX - INFO - Loaded custom template for cisco spa504g
    2025-12-08 17:42:06 - PBX - INFO - Loaded custom template for yealink t46s
    2025-12-08 17:42:06 - PBX - INFO - Loaded custom template for zultys zip37g
    2025-12-08 17:42:06 - PBX - INFO - Loaded custom template for polycom vvx450
    2025-12-08 17:42:06 - PBX - INFO - Phone provisioning initialized
    2025-12-08 17:42:06 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
    2025-12-08 17:42:06 - PBX - INFO - Server external IP: 192.168.1.14
    2025-12-08 17:42:06 - PBX - INFO - API port: 8080
    2025-12-08 17:42:06 - PBX - ERROR - Active Directory integration requires 'ldap3' library. Install with: pip install ldap3
    2025-12-08 17:42:06 - PBX - WARNING - Active Directory integration enabled in config but failed to initialize
    2025-12-08 17:42:06 - PBX - INFO - Webhook system enabled
    2025-12-08 17:42:06 - PBX - INFO - Loaded 0 webhook subscriptions
    2025-12-08 17:42:06 - PBX - INFO - Started 2 webhook delivery workers
    2025-12-08 17:42:06 - PBX - INFO - WebRTC signaling server enabled
    2025-12-08 17:42:06 - PBX - INFO - Started WebRTC session cleanup thread
    2025-12-08 17:42:06 - PBX - INFO - WebRTC to SIP gateway initialized
    2025-12-08 17:42:06 - PBX - INFO - WebRTC browser calling initialized
    2025-12-08 17:42:06 - PBX - INFO - Loaded CRM provider: PhoneBook
    2025-12-08 17:42:06 - PBX - INFO - Loaded CRM provider: ActiveDirectory
    2025-12-08 17:42:06 - PBX - INFO - CRM integration enabled
    2025-12-08 17:42:06 - PBX - INFO - CRM integration and screen pop initialized
    2025-12-08 17:42:06 - PBX - INFO - Hot-desking system enabled
    2025-12-08 17:42:06 - PBX - INFO - Started hot-desking auto-logout thread
    2025-12-08 17:42:06 - PBX - INFO - Hot-desking system initialized
    2025-12-08 17:42:06 - PBX - INFO - Threat detection database schema initialized
    2025-12-08 17:42:06 - PBX - INFO - Enhanced threat detection initialized
    2025-12-08 17:42:06 - PBX - INFO - PBX Core initialized with all features
    2025-12-08 17:42:06 - PBX - ERROR - Error during query execution: table extensions has no column named voicemail_pin
    2025-12-08 17:42:06 - PBX - ERROR -   Query: 
            INSERT INTO extensions (number, name, email, password_hash, allow_external, voicemail_pin, ad_synced, ad_username)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
            
    2025-12-08 17:42:06 - PBX - ERROR -   Parameters: ('9999', 'Test Database Extension', 'test@example.com', 'test_hash_123', True, None, False, None)
    2025-12-08 17:42:06 - PBX - ERROR -   Database type: sqlite
    2025-12-08 17:42:06 - PBX - ERROR -   Traceback: Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/pbx/utils/database.py", line 157, in _execute_with_context
        cursor.execute(query, params)
    sqlite3.OperationalError: table extensions has no column named voicemail_pin
    
    Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/tests/test_extension_db_registration.py", line 203, in run_all_tests
        test_database_extension_registration()
      File "/home/runner/work/PBX/PBX/tests/test_extension_db_registration.py", line 46, in test_database_extension_registration
        assert success, "Failed to add extension to database"
               ^^^^^^^
    AssertionError: Failed to add extension to database

[2025-12-08 17:42:06] ERROR: test_greeting_recording.py
  Exception: invalid syntax (test_greeting_recording.py, line 209)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_greeting_recording.py", line 209
    print("=" * 60)    print("Running Voicemail Greeting Recording Tests")    print("=" * 60)    print()        tests = [        test_greeting_storage,        test_greeting_deletion,        test_ivr_options_menu,        test_ivr_greeting_recording,        test_ivr_save_recorded_greeting,        test_main_menu_to_options,        test_greeting_persistence,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except AssertionError as e:            print(f"✗ {test.__name__} failed: {e}")            failed += 1        except Exception as e:            print(f"✗ {test.__name__} error: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:06] ERROR: test_hot_desking.py
  Exception: invalid syntax (test_hot_desking.py, line 443)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_hot_desking.py", line 443
    print("=" * 70)    print("Testing Hot-Desking Feature")    print("=" * 70)        results = []    results.append(test_hot_desk_session_creation())    results.append(test_hot_desking_initialization())    results.append(test_hot_desk_login_logout())    results.append(test_hot_desk_invalid_pin())    results.append(test_hot_desk_concurrent_logins())    results.append(test_hot_desk_allow_concurrent())    results.append(test_hot_desk_extension_logout())    results.append(test_hot_desk_session_activity())    results.append(test_hot_desk_profile_retrieval())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All hot-desking tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:06] ERROR: test_json_serialization.py
  Exception: invalid syntax (test_json_serialization.py, line 123)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_json_serialization.py", line 123
    print("=" * 60)    print("Running JSON Serialization Tests")    print("=" * 60)        try:        test_datetime_encoder()        test_registered_phones_json_serialization()        test_registered_phones_db_with_encoder()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_new_features.py
  Exception: invalid syntax (test_new_features.py, line 131)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_new_features.py", line 131
    print("=" * 70)    print("Testing New PBX Features")    print("=" * 70)        results = []    results.append(test_wav_file_playback())    results.append(test_call_transfer_message_building())        print("\n" + "=" * 70)    if all(results):        print("✅ All feature tests passed!")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_paging_integration.py
  Exception: invalid syntax (test_paging_integration.py, line 319)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_paging_integration.py", line 319
    print("=" * 70)    print("Testing Paging System Integration")    print("=" * 70)        results = []    results.append(test_paging_system_initialization())    results.append(test_paging_extension_detection())    results.append(test_zone_management())    results.append(test_page_initiation())    results.append(test_all_call_paging())    results.append(test_dac_device_configuration())    results.append(test_paging_disabled())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All paging tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_pbx_boot_clear.py
  Exception: invalid syntax (test_pbx_boot_clear.py, line 96)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_pbx_boot_clear.py", line 96
    print("=" * 60)    print("Running PBX Boot Preserve Integration Test")    print("=" * 60)        try:        test_pbx_preserves_phones_on_boot()                print("=" * 60)        print("Results: 1 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_pcm_conversion.py
  Exception: invalid syntax (test_pcm_conversion.py, line 154)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_pcm_conversion.py", line 154
    print("Testing PCM to G.711 μ-law conversion...")    print("-" * 60)    test_pcm16_to_ulaw_conversion()    print()    test_pcm_wav_to_ulaw_with_rtp()    print()    test_ulaw_wav_still_works()    print("-" * 60)    print("All tests passed! ✓")    return True
                                                         ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_periodic_reregistration.py
  Exception: invalid syntax (test_periodic_reregistration.py, line 176)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_periodic_reregistration.py", line 176
    print("=" * 60)    print("Periodic Re-registration Test")    print("=" * 60)    print()    print("This test simulates the real-world scenario where phones")    print("re-register every X seconds (e.g., 60s) and may not always")    print("send MAC address in every REGISTER message.")    print()        try:        test_periodic_reregistration_preserves_data()        print()        test_multiple_phones_reregistering()                print()        print("=" * 60)        print("✓ All tests PASSED")        print("=" * 60)        print()        print("The system now correctly preserves MAC/IP/extension")        print("information when devices re-register periodically!")            except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_phone_book_paging.py
  Exception: invalid syntax (test_phone_book_paging.py, line 213)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_phone_book_paging.py", line 213
    print("\nRunning Phone Book and Paging Tests")    print("=" * 60)        try:        test_phone_book_basic()        test_phone_book_export()        test_paging_system_basic()        test_paging_system_devices()        test_phone_book_disabled()        test_paging_system_disabled()                print("\n" + "=" * 60)        print("All tests passed! ✓")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Error: {e}")        import traceback        traceback.print_exc()        return False
                                                      ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_phone_registration_integration.py
  Exception: invalid syntax (test_phone_registration_integration.py, line 169)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_phone_registration_integration.py", line 169
    print("=" * 60)    print("Running Phone Registration Integration Tests")    print("=" * 60)        try:        test_mac_extraction()        test_registration_storage()        test_ip_based_tracking()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_provisioning.py
  Exception: invalid syntax (test_provisioning.py, line 340)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_provisioning.py", line 340
    print("=" * 60)    print("Running Phone Provisioning Tests")    print("=" * 60)        try:        test_device_mac_normalization()        test_phone_template()        test_provisioning_device_registration()        test_supported_vendors_and_models()        test_builtin_templates()        test_config_generation()        test_unregistered_device_error_message()        test_similar_mac_detection()        test_mac_placeholder_detection()                print("=" * 60)        print("All tests passed!")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_provisioning_persistence.py
  Exception: invalid syntax (test_provisioning_persistence.py, line 222)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_provisioning_persistence.py", line 222
    print("=" * 60)    print("Running Provisioning Persistence Tests")    print("=" * 60)        try:        test_provisioning_persistence()        test_static_ip_assignment()        test_device_unregister_removes_from_db()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        import traceback        traceback.print_exc()        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:11] ERROR: test_registered_phones.py
  Exception: invalid syntax (test_registered_phones.py, line 401)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_registered_phones.py", line 401
    print("=" * 60)    print("Running Registered Phones Tests")    print("=" * 60)        try:        test_phone_registration()        test_phone_registration_without_mac()        test_phone_update_registration()        test_list_phones_by_extension()        test_list_all_phones()        test_mac_preservation_on_reregistration()        test_ip_preservation_on_reregistration()        test_update_phone_extension()        test_update_phone_extension_without_mac()                print("=" * 60)        print("Results: 9 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:20] ERROR: test_shutdown.py
  Exception: invalid syntax (test_shutdown.py, line 195)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_shutdown.py", line 195
    test_pbx_shutdown()    test_signal_handling_simulation()    print("\n✅ All shutdown tests passed!")    return True
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:20] ERROR: test_statistics.py
  Exception: name 'sys' is not defined
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 107, in run_all_tests
    success = module.run_all_tests()
              ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/PBX/PBX/tests/test_statistics.py", line 262, in run_all_tests
    suite = loader.loadTestsFromModule(sys.modules[__name__])
                                       ^^^
NameError: name 'sys' is not defined. Did you forget to import 'sys'

[2025-12-08 17:42:22] ERROR: test_voicemail_database.py
  Exception: invalid syntax (test_voicemail_database.py, line 187)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_database.py", line 187
    print("=" * 60)    print("Running Voicemail Database Tests")    print("=" * 60)    print()        tests = [        test_database_configuration,        test_database_backend_initialization,        test_voicemail_database_integration,        test_voicemail_without_database,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_email.py
  Exception: invalid syntax (test_voicemail_email.py, line 130)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_email.py", line 130
    print("=" * 60)    print("Running Voicemail Email Tests")    print("=" * 60)    print()        tests = [        test_email_notifier_config,        test_email_notifier_initialization,        test_voicemail_with_email,        test_extension_email_configuration,        test_no_answer_timeout_config,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_fixes.py
  Exception: invalid syntax (test_voicemail_fixes.py, line 183)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_fixes.py", line 183
    print("=" * 60)    print("Running Voicemail Fixes Tests")    print("=" * 60)    print()        tests = [        test_api_serves_audio_by_default,        test_voicemail_access_checks_registry,        test_email_notification_checks_database,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1            print()        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1            print()        print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_greeting_menu.py
  Exception: invalid syntax (test_voicemail_greeting_menu.py, line 265)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_greeting_menu.py", line 265
    print("=" * 60)    print("Running Voicemail Greeting Menu Tests")    print("=" * 60)    print()        tests = [        test_access_options_menu,        test_start_greeting_recording,        test_finish_greeting_recording,        test_greeting_review_playback,        test_greeting_review_rerecord,        test_greeting_review_delete,        test_greeting_review_save,        test_complete_greeting_workflow,        test_return_to_main_menu_from_options,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_integration.py
  Exception: invalid syntax (test_voicemail_integration.py, line 171)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_integration.py", line 171
    print("=" * 60)    print("Running Voicemail Integration Tests")    print("=" * 60)    print()        tests = [        test_complete_voicemail_flow,        test_multiple_voicemails,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_ivr.py
  Exception: invalid syntax (test_voicemail_ivr.py, line 275)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_ivr.py", line 275
    print("=" * 60)    print("Running Voicemail IVR Tests")    print("=" * 60)    print()        tests = [        test_voice_prompt_generation,        test_voicemail_ivr_initialization,        test_voicemail_ivr_welcome_state,        test_voicemail_ivr_pin_entry,        test_voicemail_ivr_invalid_pin,        test_voicemail_ivr_main_menu,        test_voicemail_ivr_message_menu,        test_voicemail_ivr_delete_message,        test_voicemail_ivr_no_messages,        test_voicemail_ivr_exit,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_ivr_bye_race.py
  Exception: invalid syntax (test_voicemail_ivr_bye_race.py, line 189)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_ivr_bye_race.py", line 189
    print("=" * 60)    print("Running Voicemail IVR BYE Race Condition Tests")    print("=" * 60)    print()        tests = [        test_ivr_handles_early_call_termination,        test_ivr_handles_call_termination_during_message_playback,        test_ivr_handles_hangup_action_with_ended_call,        test_pin_entry_clears_after_processing,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_ivr_early_termination.py
  Exception: invalid syntax (test_voicemail_ivr_early_termination.py, line 197)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_ivr_early_termination.py", line 197
    print("=" * 60)    print("Running Voicemail IVR Early Termination Tests")    print("=" * 60)    print()        # Run tests    unittest.main(verbosity=2)    return True
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_playback.py
  Exception: invalid syntax (test_voicemail_playback.py, line 150)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_playback.py", line 150
    print("=" * 60)    print("Running Voicemail Playback Tests")    print("=" * 60)    print()        tests = [        test_rtp_player_play_file,        test_voicemail_access_plays_messages,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_voicemail_recording.py
  Exception: invalid syntax (test_voicemail_recording.py, line 247)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_recording.py", line 247
    print("=" * 60)    print("Running Voicemail Recording Tests")    print("=" * 60)    print()        tests = [        test_rtp_recorder,        test_wav_file_builder,        test_voicemail_recording_timer,        test_voicemail_save_on_hangup,        test_no_answer_answers_call,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] FAILED: test_voicemail_transcription.py
  Return value: False (expected True)

  Test Errors:
    test_transcription_file_not_found (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_file_not_found)
    Test transcription with non-existent file ... ok
    test_transcription_google_no_results (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_no_results)
    Test Google transcription with no results ... ERROR
    test_transcription_google_success (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_success)
    Test successful Google Cloud Speech-to-Text transcription ... ERROR
    test_transcription_result_structure (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_result_structure)
    Test that transcription result has correct structure ... ok
    test_transcription_service_disabled (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_service_disabled)
    Test transcription service when disabled ... ok
    test_transcription_unsupported_provider (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_unsupported_provider)
    Test transcription with unsupported provider ... ok
    
    ======================================================================
    ERROR: test_transcription_google_no_results (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_no_results)
    Test Google transcription with no results
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/usr/lib/python3.12/unittest/mock.py", line 1387, in patched
        with self.decoration_helper(patched,
      File "/usr/lib/python3.12/contextlib.py", line 137, in __enter__
        return next(self.gen)
               ^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1369, in decoration_helper
        arg = exit_stack.enter_context(patching)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/contextlib.py", line 526, in enter_context
        result = _enter(cm)
                 ^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1458, in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1431, in get_original
        raise AttributeError(
    AttributeError: <module 'pbx.features.voicemail_transcription' from '/home/runner/work/PBX/PBX/pbx/features/voicemail_transcription.py'> does not have the attribute 'speech'
    
    ======================================================================
    ERROR: test_transcription_google_success (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_success)
    Test successful Google Cloud Speech-to-Text transcription
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/usr/lib/python3.12/unittest/mock.py", line 1387, in patched
        with self.decoration_helper(patched,
      File "/usr/lib/python3.12/contextlib.py", line 137, in __enter__
        return next(self.gen)
               ^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1369, in decoration_helper
        arg = exit_stack.enter_context(patching)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/contextlib.py", line 526, in enter_context
        result = _enter(cm)
                 ^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1458, in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1431, in get_original
        raise AttributeError(
    AttributeError: <module 'pbx.features.voicemail_transcription' from '/home/runner/work/PBX/PBX/pbx/features/voicemail_transcription.py'> does not have the attribute 'speech'
    
    ----------------------------------------------------------------------
    Ran 6 tests in 0.031s
    
    FAILED (errors=2)

[2025-12-08 17:42:22] ERROR: test_webhooks.py
  Exception: invalid syntax (test_webhooks.py, line 287)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_webhooks.py", line 287
    print("=" * 70)    print("Testing Webhook System")    print("=" * 70)        results = []    results.append(test_webhook_event_creation())    results.append(test_webhook_subscription())    results.append(test_webhook_system_initialization())    results.append(test_webhook_delivery())    results.append(test_webhook_subscription_management())    results.append(test_webhook_disabled())    results.append(test_webhook_hmac_signature())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All webhook tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:42:22] ERROR: test_webrtc.py
  Exception: invalid syntax (test_webrtc.py, line 486)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_webrtc.py", line 486
    print("=" * 70)    print("Testing WebRTC Browser Calling Support")    print("=" * 70)        results = []    results.append(test_webrtc_session_creation())    results.append(test_webrtc_signaling_initialization())    results.append(test_webrtc_session_management())    results.append(test_webrtc_sdp_handling())    results.append(test_webrtc_ice_candidates())    results.append(test_webrtc_ice_servers_config())    results.append(test_webrtc_gateway())    results.append(test_sdp_transformations())    results.append(test_call_initiation())    results.append(test_incoming_call_routing())    results.append(test_webrtc_disabled())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All WebRTC tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

================================================================================
Test Run Completed: 2025-12-08 17:42:22
Summary: 15 passed, 31 failed, 0 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:43:59
================================================================================

[2025-12-08 17:43:59] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

[2025-12-08 17:43:59] FAILED: test_extension_db_registration.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Extension Database Registration Tests
    ============================================================
    Testing database-based extension registration...
    
    ✗ Test failed: Failed to add extension to database

  Test Errors:
    2025-12-08 17:43:59 - PBX - ERROR - PostgreSQL requested but psycopg2 not installed. Install with: pip install psycopg2-binary
    2025-12-08 17:43:59 - PBX - INFO - Database backend: sqlite
    2025-12-08 17:43:59 - PBX - INFO - Initiating database connection (type: sqlite)...
    2025-12-08 17:43:59 - PBX - INFO - Connecting to SQLite database...
    2025-12-08 17:43:59 - PBX - INFO -   Database file: pbx.db
    2025-12-08 17:43:59 - PBX - INFO - ✓ Successfully connected to SQLite database
    2025-12-08 17:43:59 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/pbx.db
    2025-12-08 17:43:59 - PBX - INFO - Creating database tables...
    2025-12-08 17:43:59 - PBX - INFO - Checking for schema migrations...
    2025-12-08 17:43:59 - PBX - INFO - Schema migration check complete
    2025-12-08 17:43:59 - PBX - INFO - Database tables created successfully
    2025-12-08 17:43:59 - PBX - INFO - Database backend initialized successfully (sqlite)
    2025-12-08 17:43:59 - PBX - INFO - Extensions, voicemail metadata, and phone registrations will be stored in database
    2025-12-08 17:43:59 - PBX - INFO - FIPS 140-2 compliant encryption ENABLED
    2025-12-08 17:43:59 - PBX - INFO -   ✓ Using PBKDF2-HMAC-SHA256 for password hashing
    2025-12-08 17:43:59 - PBX - INFO -   ✓ Using AES-256-GCM for data encryption
    2025-12-08 17:43:59 - PBX - INFO -   ✓ 600,000 iterations for key derivation (OWASP 2024 recommendation)
    2025-12-08 17:43:59 - PBX - INFO - No extensions found in database, loading from config.yml
    2025-12-08 17:43:59 - PBX - INFO - Loading 4 extensions from config.yml
    2025-12-08 17:43:59 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
    2025-12-08 17:43:59 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
    2025-12-08 17:43:59 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
    2025-12-08 17:43:59 - PBX - INFO - Loaded extension 1004 (Customer Service)
    2025-12-08 17:43:59 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
    2025-12-08 17:43:59 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
    2025-12-08 17:43:59 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
    2025-12-08 17:43:59 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
    2025-12-08 17:43:59 - PBX - INFO - Started daily reminder thread
    2025-12-08 17:43:59 - PBX - INFO - Statistics and analytics engine initialized
    2025-12-08 17:43:59 - PBX - INFO - Auto Attendant initialized on extension 0
    2025-12-08 17:43:59 - PBX - INFO - Menu options: 4
    2025-12-08 17:43:59 - PBX - INFO - Auto Attendant initialized on extension 0
    2025-12-08 17:43:59 - PBX - INFO - Phone provisioning will use database for persistent storage
    2025-12-08 17:43:59 - PBX - INFO - Loaded 0 provisioned devices from database
    2025-12-08 17:43:59 - PBX - INFO - Loaded 6 built-in phone templates
    2025-12-08 17:43:59 - PBX - INFO - Loaded custom template for grandstream gxp2170
    2025-12-08 17:43:59 - PBX - INFO - Loaded custom template for zultys zip33g
    2025-12-08 17:43:59 - PBX - INFO - Loaded custom template for cisco spa504g
    2025-12-08 17:43:59 - PBX - INFO - Loaded custom template for yealink t46s
    2025-12-08 17:43:59 - PBX - INFO - Loaded custom template for zultys zip37g
    2025-12-08 17:43:59 - PBX - INFO - Loaded custom template for polycom vvx450
    2025-12-08 17:43:59 - PBX - INFO - Phone provisioning initialized
    2025-12-08 17:43:59 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
    2025-12-08 17:43:59 - PBX - INFO - Server external IP: 192.168.1.14
    2025-12-08 17:43:59 - PBX - INFO - API port: 8080
    2025-12-08 17:43:59 - PBX - ERROR - Active Directory integration requires 'ldap3' library. Install with: pip install ldap3
    2025-12-08 17:43:59 - PBX - WARNING - Active Directory integration enabled in config but failed to initialize
    2025-12-08 17:43:59 - PBX - INFO - Webhook system enabled
    2025-12-08 17:43:59 - PBX - INFO - Loaded 0 webhook subscriptions
    2025-12-08 17:43:59 - PBX - INFO - Started 2 webhook delivery workers
    2025-12-08 17:43:59 - PBX - INFO - WebRTC signaling server enabled
    2025-12-08 17:43:59 - PBX - INFO - Started WebRTC session cleanup thread
    2025-12-08 17:43:59 - PBX - INFO - WebRTC to SIP gateway initialized
    2025-12-08 17:43:59 - PBX - INFO - WebRTC browser calling initialized
    2025-12-08 17:43:59 - PBX - INFO - Loaded CRM provider: PhoneBook
    2025-12-08 17:43:59 - PBX - INFO - Loaded CRM provider: ActiveDirectory
    2025-12-08 17:43:59 - PBX - INFO - CRM integration enabled
    2025-12-08 17:43:59 - PBX - INFO - CRM integration and screen pop initialized
    2025-12-08 17:43:59 - PBX - INFO - Hot-desking system enabled
    2025-12-08 17:43:59 - PBX - INFO - Started hot-desking auto-logout thread
    2025-12-08 17:43:59 - PBX - INFO - Hot-desking system initialized
    2025-12-08 17:43:59 - PBX - INFO - Threat detection database schema initialized
    2025-12-08 17:43:59 - PBX - INFO - Enhanced threat detection initialized
    2025-12-08 17:43:59 - PBX - INFO - PBX Core initialized with all features
    2025-12-08 17:43:59 - PBX - ERROR - Error during query execution: table extensions has no column named voicemail_pin
    2025-12-08 17:43:59 - PBX - ERROR -   Query: 
            INSERT INTO extensions (number, name, email, password_hash, allow_external, voicemail_pin, ad_synced, ad_username)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
            
    2025-12-08 17:43:59 - PBX - ERROR -   Parameters: ('9999', 'Test Database Extension', 'test@example.com', 'test_hash_123', True, None, False, None)
    2025-12-08 17:43:59 - PBX - ERROR -   Database type: sqlite
    2025-12-08 17:43:59 - PBX - ERROR -   Traceback: Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/pbx/utils/database.py", line 157, in _execute_with_context
        cursor.execute(query, params)
    sqlite3.OperationalError: table extensions has no column named voicemail_pin
    
    Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/tests/test_extension_db_registration.py", line 203, in run_all_tests
        test_database_extension_registration()
      File "/home/runner/work/PBX/PBX/tests/test_extension_db_registration.py", line 46, in test_database_extension_registration
        assert success, "Failed to add extension to database"
               ^^^^^^^
    AssertionError: Failed to add extension to database

[2025-12-08 17:44:00] ERROR: test_greeting_recording.py
  Exception: invalid syntax (test_greeting_recording.py, line 209)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_greeting_recording.py", line 209
    print("=" * 60)    print("Running Voicemail Greeting Recording Tests")    print("=" * 60)    print()        tests = [        test_greeting_storage,        test_greeting_deletion,        test_ivr_options_menu,        test_ivr_greeting_recording,        test_ivr_save_recorded_greeting,        test_main_menu_to_options,        test_greeting_persistence,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except AssertionError as e:            print(f"✗ {test.__name__} failed: {e}")            failed += 1        except Exception as e:            print(f"✗ {test.__name__} error: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:00] ERROR: test_hot_desking.py
  Exception: invalid syntax (test_hot_desking.py, line 443)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_hot_desking.py", line 443
    print("=" * 70)    print("Testing Hot-Desking Feature")    print("=" * 70)        results = []    results.append(test_hot_desk_session_creation())    results.append(test_hot_desking_initialization())    results.append(test_hot_desk_login_logout())    results.append(test_hot_desk_invalid_pin())    results.append(test_hot_desk_concurrent_logins())    results.append(test_hot_desk_allow_concurrent())    results.append(test_hot_desk_extension_logout())    results.append(test_hot_desk_session_activity())    results.append(test_hot_desk_profile_retrieval())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All hot-desking tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:00] ERROR: test_json_serialization.py
  Exception: invalid syntax (test_json_serialization.py, line 123)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_json_serialization.py", line 123
    print("=" * 60)    print("Running JSON Serialization Tests")    print("=" * 60)        try:        test_datetime_encoder()        test_registered_phones_json_serialization()        test_registered_phones_db_with_encoder()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_new_features.py
  Exception: invalid syntax (test_new_features.py, line 131)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_new_features.py", line 131
    print("=" * 70)    print("Testing New PBX Features")    print("=" * 70)        results = []    results.append(test_wav_file_playback())    results.append(test_call_transfer_message_building())        print("\n" + "=" * 70)    if all(results):        print("✅ All feature tests passed!")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_paging_integration.py
  Exception: invalid syntax (test_paging_integration.py, line 319)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_paging_integration.py", line 319
    print("=" * 70)    print("Testing Paging System Integration")    print("=" * 70)        results = []    results.append(test_paging_system_initialization())    results.append(test_paging_extension_detection())    results.append(test_zone_management())    results.append(test_page_initiation())    results.append(test_all_call_paging())    results.append(test_dac_device_configuration())    results.append(test_paging_disabled())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All paging tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_pbx_boot_clear.py
  Exception: invalid syntax (test_pbx_boot_clear.py, line 96)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_pbx_boot_clear.py", line 96
    print("=" * 60)    print("Running PBX Boot Preserve Integration Test")    print("=" * 60)        try:        test_pbx_preserves_phones_on_boot()                print("=" * 60)        print("Results: 1 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_pcm_conversion.py
  Exception: invalid syntax (test_pcm_conversion.py, line 154)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_pcm_conversion.py", line 154
    print("Testing PCM to G.711 μ-law conversion...")    print("-" * 60)    test_pcm16_to_ulaw_conversion()    print()    test_pcm_wav_to_ulaw_with_rtp()    print()    test_ulaw_wav_still_works()    print("-" * 60)    print("All tests passed! ✓")    return True
                                                         ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_periodic_reregistration.py
  Exception: invalid syntax (test_periodic_reregistration.py, line 176)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_periodic_reregistration.py", line 176
    print("=" * 60)    print("Periodic Re-registration Test")    print("=" * 60)    print()    print("This test simulates the real-world scenario where phones")    print("re-register every X seconds (e.g., 60s) and may not always")    print("send MAC address in every REGISTER message.")    print()        try:        test_periodic_reregistration_preserves_data()        print()        test_multiple_phones_reregistering()                print()        print("=" * 60)        print("✓ All tests PASSED")        print("=" * 60)        print()        print("The system now correctly preserves MAC/IP/extension")        print("information when devices re-register periodically!")            except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_phone_book_paging.py
  Exception: invalid syntax (test_phone_book_paging.py, line 213)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_phone_book_paging.py", line 213
    print("\nRunning Phone Book and Paging Tests")    print("=" * 60)        try:        test_phone_book_basic()        test_phone_book_export()        test_paging_system_basic()        test_paging_system_devices()        test_phone_book_disabled()        test_paging_system_disabled()                print("\n" + "=" * 60)        print("All tests passed! ✓")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Error: {e}")        import traceback        traceback.print_exc()        return False
                                                      ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_phone_registration_integration.py
  Exception: invalid syntax (test_phone_registration_integration.py, line 169)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_phone_registration_integration.py", line 169
    print("=" * 60)    print("Running Phone Registration Integration Tests")    print("=" * 60)        try:        test_mac_extraction()        test_registration_storage()        test_ip_based_tracking()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_provisioning.py
  Exception: invalid syntax (test_provisioning.py, line 340)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_provisioning.py", line 340
    print("=" * 60)    print("Running Phone Provisioning Tests")    print("=" * 60)        try:        test_device_mac_normalization()        test_phone_template()        test_provisioning_device_registration()        test_supported_vendors_and_models()        test_builtin_templates()        test_config_generation()        test_unregistered_device_error_message()        test_similar_mac_detection()        test_mac_placeholder_detection()                print("=" * 60)        print("All tests passed!")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_provisioning_persistence.py
  Exception: invalid syntax (test_provisioning_persistence.py, line 222)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_provisioning_persistence.py", line 222
    print("=" * 60)    print("Running Provisioning Persistence Tests")    print("=" * 60)        try:        test_provisioning_persistence()        test_static_ip_assignment()        test_device_unregister_removes_from_db()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        import traceback        traceback.print_exc()        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:05] ERROR: test_registered_phones.py
  Exception: invalid syntax (test_registered_phones.py, line 401)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_registered_phones.py", line 401
    print("=" * 60)    print("Running Registered Phones Tests")    print("=" * 60)        try:        test_phone_registration()        test_phone_registration_without_mac()        test_phone_update_registration()        test_list_phones_by_extension()        test_list_all_phones()        test_mac_preservation_on_reregistration()        test_ip_preservation_on_reregistration()        test_update_phone_extension()        test_update_phone_extension_without_mac()                print("=" * 60)        print("Results: 9 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:13] ERROR: test_shutdown.py
  Exception: invalid syntax (test_shutdown.py, line 195)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_shutdown.py", line 195
    test_pbx_shutdown()    test_signal_handling_simulation()    print("\n✅ All shutdown tests passed!")    return True
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:13] ERROR: test_statistics.py
  Exception: name 'sys' is not defined
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 107, in run_all_tests
    success = module.run_all_tests()
              ^^^^^^^^^^^^^^^^^^^^^^
  File "/home/runner/work/PBX/PBX/tests/test_statistics.py", line 262, in run_all_tests
    suite = loader.loadTestsFromModule(sys.modules[__name__])
                                       ^^^
NameError: name 'sys' is not defined. Did you forget to import 'sys'

[2025-12-08 17:44:16] ERROR: test_voicemail_database.py
  Exception: invalid syntax (test_voicemail_database.py, line 187)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_database.py", line 187
    print("=" * 60)    print("Running Voicemail Database Tests")    print("=" * 60)    print()        tests = [        test_database_configuration,        test_database_backend_initialization,        test_voicemail_database_integration,        test_voicemail_without_database,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_email.py
  Exception: invalid syntax (test_voicemail_email.py, line 130)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_email.py", line 130
    print("=" * 60)    print("Running Voicemail Email Tests")    print("=" * 60)    print()        tests = [        test_email_notifier_config,        test_email_notifier_initialization,        test_voicemail_with_email,        test_extension_email_configuration,        test_no_answer_timeout_config,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_fixes.py
  Exception: invalid syntax (test_voicemail_fixes.py, line 183)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_fixes.py", line 183
    print("=" * 60)    print("Running Voicemail Fixes Tests")    print("=" * 60)    print()        tests = [        test_api_serves_audio_by_default,        test_voicemail_access_checks_registry,        test_email_notification_checks_database,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1            print()        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1            print()        print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_greeting_menu.py
  Exception: invalid syntax (test_voicemail_greeting_menu.py, line 265)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_greeting_menu.py", line 265
    print("=" * 60)    print("Running Voicemail Greeting Menu Tests")    print("=" * 60)    print()        tests = [        test_access_options_menu,        test_start_greeting_recording,        test_finish_greeting_recording,        test_greeting_review_playback,        test_greeting_review_rerecord,        test_greeting_review_delete,        test_greeting_review_save,        test_complete_greeting_workflow,        test_return_to_main_menu_from_options,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_integration.py
  Exception: invalid syntax (test_voicemail_integration.py, line 171)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_integration.py", line 171
    print("=" * 60)    print("Running Voicemail Integration Tests")    print("=" * 60)    print()        tests = [        test_complete_voicemail_flow,        test_multiple_voicemails,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_ivr.py
  Exception: invalid syntax (test_voicemail_ivr.py, line 275)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_ivr.py", line 275
    print("=" * 60)    print("Running Voicemail IVR Tests")    print("=" * 60)    print()        tests = [        test_voice_prompt_generation,        test_voicemail_ivr_initialization,        test_voicemail_ivr_welcome_state,        test_voicemail_ivr_pin_entry,        test_voicemail_ivr_invalid_pin,        test_voicemail_ivr_main_menu,        test_voicemail_ivr_message_menu,        test_voicemail_ivr_delete_message,        test_voicemail_ivr_no_messages,        test_voicemail_ivr_exit,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_ivr_bye_race.py
  Exception: invalid syntax (test_voicemail_ivr_bye_race.py, line 189)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_ivr_bye_race.py", line 189
    print("=" * 60)    print("Running Voicemail IVR BYE Race Condition Tests")    print("=" * 60)    print()        tests = [        test_ivr_handles_early_call_termination,        test_ivr_handles_call_termination_during_message_playback,        test_ivr_handles_hangup_action_with_ended_call,        test_pin_entry_clears_after_processing,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:16] ERROR: test_voicemail_ivr_early_termination.py
  Exception: invalid syntax (test_voicemail_ivr_early_termination.py, line 197)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_ivr_early_termination.py", line 197
    print("=" * 60)    print("Running Voicemail IVR Early Termination Tests")    print("=" * 60)    print()        # Run tests    unittest.main(verbosity=2)    return True
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:44:18] FAILED: test_voicemail_transcription.py
  Return value: False (expected True)

  Test Errors:
    test_transcription_file_not_found (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_file_not_found)
    Test transcription with non-existent file ... ok
    test_transcription_google_no_results (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_no_results)
    Test Google transcription with no results ... ERROR
    test_transcription_google_success (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_success)
    Test successful Google Cloud Speech-to-Text transcription ... ERROR
    test_transcription_result_structure (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_result_structure)
    Test that transcription result has correct structure ... ok
    test_transcription_service_disabled (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_service_disabled)
    Test transcription service when disabled ... ok
    test_transcription_unsupported_provider (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_unsupported_provider)
    Test transcription with unsupported provider ... ok
    
    ======================================================================
    ERROR: test_transcription_google_no_results (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_no_results)
    Test Google transcription with no results
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/usr/lib/python3.12/unittest/mock.py", line 1387, in patched
        with self.decoration_helper(patched,
      File "/usr/lib/python3.12/contextlib.py", line 137, in __enter__
        return next(self.gen)
               ^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1369, in decoration_helper
        arg = exit_stack.enter_context(patching)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/contextlib.py", line 526, in enter_context
        result = _enter(cm)
                 ^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1458, in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1431, in get_original
        raise AttributeError(
    AttributeError: <module 'pbx.features.voicemail_transcription' from '/home/runner/work/PBX/PBX/pbx/features/voicemail_transcription.py'> does not have the attribute 'speech'
    
    ======================================================================
    ERROR: test_transcription_google_success (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_success)
    Test successful Google Cloud Speech-to-Text transcription
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/usr/lib/python3.12/unittest/mock.py", line 1387, in patched
        with self.decoration_helper(patched,
      File "/usr/lib/python3.12/contextlib.py", line 137, in __enter__
        return next(self.gen)
               ^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1369, in decoration_helper
        arg = exit_stack.enter_context(patching)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/contextlib.py", line 526, in enter_context
        result = _enter(cm)
                 ^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1458, in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1431, in get_original
        raise AttributeError(
    AttributeError: <module 'pbx.features.voicemail_transcription' from '/home/runner/work/PBX/PBX/pbx/features/voicemail_transcription.py'> does not have the attribute 'speech'
    
    ----------------------------------------------------------------------
    Ran 6 tests in 0.014s
    
    FAILED (errors=2)

================================================================================
Test Run Completed: 2025-12-08 17:44:55
Summary: 20 passed, 26 failed, 0 skipped
================================================================================

================================================================================
Test Run Started: 2025-12-08 17:47:53
================================================================================

[2025-12-08 17:47:54] FAILED: test_dtmf_detection.py
  Return value: False (expected True)

  Test Errors:
    test_detect_sequence (test_dtmf_detection.TestDTMFDetection.test_detect_sequence)
    Test detection of a sequence of DTMF tones ... ok
    test_detect_valid_tone_1 (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_1)
    Test detection of valid DTMF tone '1' ... ok
    test_detect_valid_tone_5 (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_5)
    Test detection of valid DTMF tone '5' ... ok
    test_detect_valid_tone_pound (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_pound)
    Test detection of valid DTMF tone '#' ... ok
    test_detect_valid_tone_star (test_dtmf_detection.TestDTMFDetection.test_detect_valid_tone_star)
    Test detection of valid DTMF tone '*' ... ok
    test_no_detection_on_silence (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_silence)
    Test that silence does not trigger false DTMF detection ... ok
    test_no_detection_on_single_frequency (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_single_frequency)
    Test that a single frequency tone is not detected as DTMF ... ok
    test_no_detection_on_weak_tone (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_weak_tone)
    Test that very weak tones are not detected ... ok
    test_no_detection_on_white_noise (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_white_noise)
    Test that white noise does not trigger false DTMF detection ... FAIL
    test_noise_rejection_ratio (test_dtmf_detection.TestDTMFDetection.test_noise_rejection_ratio)
    Test that detector properly handles noisy signals ... ok
    test_threshold_parameter (test_dtmf_detection.TestDTMFDetection.test_threshold_parameter)
    Test that threshold parameter works correctly ... ok
    test_generate_invalid_digit (test_dtmf_detection.TestDTMFGenerator.test_generate_invalid_digit)
    Test generating tone for invalid digit ... ok
    test_generate_sequence (test_dtmf_detection.TestDTMFGenerator.test_generate_sequence)
    Test generating a sequence of tones ... ok
    test_generate_tone (test_dtmf_detection.TestDTMFGenerator.test_generate_tone)
    Test generating a single DTMF tone ... ok
    
    ======================================================================
    FAIL: test_no_detection_on_white_noise (test_dtmf_detection.TestDTMFDetection.test_no_detection_on_white_noise)
    Test that white noise does not trigger false DTMF detection
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/tests/test_dtmf_detection.py", line 69, in test_no_detection_on_white_noise
        self.assertIsNone(digit, "White noise should not be detected as DTMF tone")
    AssertionError: '7' is not None : White noise should not be detected as DTMF tone
    
    ----------------------------------------------------------------------
    Ran 14 tests in 0.008s
    
    FAILED (failures=1)

[2025-12-08 17:47:54] FAILED: test_enterprise_integrations.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Enterprise Integration Tests
    ============================================================
    
    Testing Zoom Phone routing...
    ✓ Zoom Phone routing works
    
    Testing Teams Direct Routing...
    ✗ test_teams_direct_routing failed: Should successfully route with configured trunk
    
    Testing Outlook meeting reminder...
    ✗ test_outlook_meeting_reminder failed: Should successfully schedule reminder with PBX core
    
    Testing Active Directory sync...
    ✓ Active Directory integration structure validated
    
    Testing error handling...
    ✓ Error handling works correctly
    
    ============================================================
    Results: 3 passed, 2 failed
    ============================================================

[2025-12-08 17:47:54] FAILED: test_extension_db_registration.py
  Return value: False (expected True)

  Test Output:
    ============================================================
    Running Extension Database Registration Tests
    ============================================================
    Testing database-based extension registration...
    
    ✗ Test failed: Failed to add extension to database

  Test Errors:
    2025-12-08 17:47:54 - PBX - ERROR - PostgreSQL requested but psycopg2 not installed. Install with: pip install psycopg2-binary
    2025-12-08 17:47:54 - PBX - INFO - Database backend: sqlite
    2025-12-08 17:47:54 - PBX - INFO - Initiating database connection (type: sqlite)...
    2025-12-08 17:47:54 - PBX - INFO - Connecting to SQLite database...
    2025-12-08 17:47:54 - PBX - INFO -   Database file: pbx.db
    2025-12-08 17:47:54 - PBX - INFO - ✓ Successfully connected to SQLite database
    2025-12-08 17:47:54 - PBX - INFO -   Database path: /home/runner/work/PBX/PBX/pbx.db
    2025-12-08 17:47:54 - PBX - INFO - Creating database tables...
    2025-12-08 17:47:54 - PBX - INFO - Checking for schema migrations...
    2025-12-08 17:47:54 - PBX - INFO - Schema migration check complete
    2025-12-08 17:47:54 - PBX - INFO - Database tables created successfully
    2025-12-08 17:47:54 - PBX - INFO - Database backend initialized successfully (sqlite)
    2025-12-08 17:47:54 - PBX - INFO - Extensions, voicemail metadata, and phone registrations will be stored in database
    2025-12-08 17:47:54 - PBX - INFO - FIPS 140-2 compliant encryption ENABLED
    2025-12-08 17:47:54 - PBX - INFO -   ✓ Using PBKDF2-HMAC-SHA256 for password hashing
    2025-12-08 17:47:54 - PBX - INFO -   ✓ Using AES-256-GCM for data encryption
    2025-12-08 17:47:54 - PBX - INFO -   ✓ 600,000 iterations for key derivation (OWASP 2024 recommendation)
    2025-12-08 17:47:54 - PBX - INFO - No extensions found in database, loading from config.yml
    2025-12-08 17:47:54 - PBX - INFO - Loading 4 extensions from config.yml
    2025-12-08 17:47:54 - PBX - INFO - Loaded extension 1001 (Codi Mattinson)
    2025-12-08 17:47:54 - PBX - INFO - Loaded extension 1002 (Bill Sautter)
    2025-12-08 17:47:54 - PBX - INFO - Loaded extension 1003 (Lisa Dingman)
    2025-12-08 17:47:54 - PBX - INFO - Loaded extension 1004 (Customer Service)
    2025-12-08 17:47:54 - PBX - WARNING - Email notifications enabled but SMTP host or from_address not configured!
    2025-12-08 17:47:54 - PBX - WARNING - Please configure SMTP settings in .env file or config.yml
    2025-12-08 17:47:54 - PBX - WARNING -   Required: voicemail.smtp.host, voicemail.email.from_address
    2025-12-08 17:47:54 - PBX - WARNING -   Optional: voicemail.smtp.username, voicemail.smtp.password (for authenticated SMTP)
    2025-12-08 17:47:54 - PBX - INFO - Started daily reminder thread
    2025-12-08 17:47:54 - PBX - INFO - Statistics and analytics engine initialized
    2025-12-08 17:47:54 - PBX - INFO - Auto Attendant initialized on extension 0
    2025-12-08 17:47:54 - PBX - INFO - Menu options: 4
    2025-12-08 17:47:54 - PBX - INFO - Auto Attendant initialized on extension 0
    2025-12-08 17:47:54 - PBX - INFO - Phone provisioning will use database for persistent storage
    2025-12-08 17:47:54 - PBX - INFO - Loaded 0 provisioned devices from database
    2025-12-08 17:47:54 - PBX - INFO - Loaded 6 built-in phone templates
    2025-12-08 17:47:54 - PBX - INFO - Loaded custom template for grandstream gxp2170
    2025-12-08 17:47:54 - PBX - INFO - Loaded custom template for zultys zip33g
    2025-12-08 17:47:54 - PBX - INFO - Loaded custom template for cisco spa504g
    2025-12-08 17:47:54 - PBX - INFO - Loaded custom template for yealink t46s
    2025-12-08 17:47:54 - PBX - INFO - Loaded custom template for zultys zip37g
    2025-12-08 17:47:54 - PBX - INFO - Loaded custom template for polycom vvx450
    2025-12-08 17:47:54 - PBX - INFO - Phone provisioning initialized
    2025-12-08 17:47:54 - PBX - INFO - Provisioning URL format: http://{{SERVER_IP}}:{{PORT}}/provision/{mac}.cfg
    2025-12-08 17:47:54 - PBX - INFO - Server external IP: 192.168.1.14
    2025-12-08 17:47:54 - PBX - INFO - API port: 8080
    2025-12-08 17:47:54 - PBX - ERROR - Active Directory integration requires 'ldap3' library. Install with: pip install ldap3
    2025-12-08 17:47:54 - PBX - WARNING - Active Directory integration enabled in config but failed to initialize
    2025-12-08 17:47:54 - PBX - INFO - Webhook system enabled
    2025-12-08 17:47:54 - PBX - INFO - Loaded 0 webhook subscriptions
    2025-12-08 17:47:54 - PBX - INFO - Started 2 webhook delivery workers
    2025-12-08 17:47:54 - PBX - INFO - WebRTC signaling server enabled
    2025-12-08 17:47:54 - PBX - INFO - Started WebRTC session cleanup thread
    2025-12-08 17:47:54 - PBX - INFO - WebRTC to SIP gateway initialized
    2025-12-08 17:47:54 - PBX - INFO - WebRTC browser calling initialized
    2025-12-08 17:47:54 - PBX - INFO - Loaded CRM provider: PhoneBook
    2025-12-08 17:47:54 - PBX - INFO - Loaded CRM provider: ActiveDirectory
    2025-12-08 17:47:54 - PBX - INFO - CRM integration enabled
    2025-12-08 17:47:54 - PBX - INFO - CRM integration and screen pop initialized
    2025-12-08 17:47:54 - PBX - INFO - Hot-desking system enabled
    2025-12-08 17:47:54 - PBX - INFO - Started hot-desking auto-logout thread
    2025-12-08 17:47:54 - PBX - INFO - Hot-desking system initialized
    2025-12-08 17:47:54 - PBX - INFO - Threat detection database schema initialized
    2025-12-08 17:47:54 - PBX - INFO - Enhanced threat detection initialized
    2025-12-08 17:47:54 - PBX - INFO - PBX Core initialized with all features
    2025-12-08 17:47:54 - PBX - ERROR - Error during query execution: table extensions has no column named voicemail_pin
    2025-12-08 17:47:54 - PBX - ERROR -   Query: 
            INSERT INTO extensions (number, name, email, password_hash, allow_external, voicemail_pin, ad_synced, ad_username)
            VALUES (?, ?, ?, ?, ?, ?, ?, ?)
            
    2025-12-08 17:47:54 - PBX - ERROR -   Parameters: ('9999', 'Test Database Extension', 'test@example.com', 'test_hash_123', True, None, False, None)
    2025-12-08 17:47:54 - PBX - ERROR -   Database type: sqlite
    2025-12-08 17:47:54 - PBX - ERROR -   Traceback: Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/pbx/utils/database.py", line 157, in _execute_with_context
        cursor.execute(query, params)
    sqlite3.OperationalError: table extensions has no column named voicemail_pin
    
    Traceback (most recent call last):
      File "/home/runner/work/PBX/PBX/tests/test_extension_db_registration.py", line 203, in run_all_tests
        test_database_extension_registration()
      File "/home/runner/work/PBX/PBX/tests/test_extension_db_registration.py", line 46, in test_database_extension_registration
        assert success, "Failed to add extension to database"
               ^^^^^^^
    AssertionError: Failed to add extension to database

[2025-12-08 17:47:55] ERROR: test_greeting_recording.py
  Exception: invalid syntax (test_greeting_recording.py, line 209)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_greeting_recording.py", line 209
    print("=" * 60)    print("Running Voicemail Greeting Recording Tests")    print("=" * 60)    print()        tests = [        test_greeting_storage,        test_greeting_deletion,        test_ivr_options_menu,        test_ivr_greeting_recording,        test_ivr_save_recorded_greeting,        test_main_menu_to_options,        test_greeting_persistence,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except AssertionError as e:            print(f"✗ {test.__name__} failed: {e}")            failed += 1        except Exception as e:            print(f"✗ {test.__name__} error: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:47:55] ERROR: test_hot_desking.py
  Exception: invalid syntax (test_hot_desking.py, line 443)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_hot_desking.py", line 443
    print("=" * 70)    print("Testing Hot-Desking Feature")    print("=" * 70)        results = []    results.append(test_hot_desk_session_creation())    results.append(test_hot_desking_initialization())    results.append(test_hot_desk_login_logout())    results.append(test_hot_desk_invalid_pin())    results.append(test_hot_desk_concurrent_logins())    results.append(test_hot_desk_allow_concurrent())    results.append(test_hot_desk_extension_logout())    results.append(test_hot_desk_session_activity())    results.append(test_hot_desk_profile_retrieval())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All hot-desking tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:47:55] ERROR: test_json_serialization.py
  Exception: invalid syntax (test_json_serialization.py, line 123)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_json_serialization.py", line 123
    print("=" * 60)    print("Running JSON Serialization Tests")    print("=" * 60)        try:        test_datetime_encoder()        test_registered_phones_json_serialization()        test_registered_phones_db_with_encoder()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_new_features.py
  Exception: invalid syntax (test_new_features.py, line 131)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_new_features.py", line 131
    print("=" * 70)    print("Testing New PBX Features")    print("=" * 70)        results = []    results.append(test_wav_file_playback())    results.append(test_call_transfer_message_building())        print("\n" + "=" * 70)    if all(results):        print("✅ All feature tests passed!")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_paging_integration.py
  Exception: invalid syntax (test_paging_integration.py, line 319)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_paging_integration.py", line 319
    print("=" * 70)    print("Testing Paging System Integration")    print("=" * 70)        results = []    results.append(test_paging_system_initialization())    results.append(test_paging_extension_detection())    results.append(test_zone_management())    results.append(test_page_initiation())    results.append(test_all_call_paging())    results.append(test_dac_device_configuration())    results.append(test_paging_disabled())        print("\n" + "=" * 70)    if all(results):        print(f"✅ All paging tests passed! ({len(results)}/{len(results)})")        return True    else:        print(f"❌ Some tests failed ({sum(results)}/{len(results)} passed)")        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_pbx_boot_clear.py
  Exception: invalid syntax (test_pbx_boot_clear.py, line 96)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_pbx_boot_clear.py", line 96
    print("=" * 60)    print("Running PBX Boot Preserve Integration Test")    print("=" * 60)        try:        test_pbx_preserves_phones_on_boot()                print("=" * 60)        print("Results: 1 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_phone_book_paging.py
  Exception: invalid syntax (test_phone_book_paging.py, line 213)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_phone_book_paging.py", line 213
    print("\nRunning Phone Book and Paging Tests")    print("=" * 60)        try:        test_phone_book_basic()        test_phone_book_export()        test_paging_system_basic()        test_paging_system_devices()        test_phone_book_disabled()        test_paging_system_disabled()                print("\n" + "=" * 60)        print("All tests passed! ✓")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Error: {e}")        import traceback        traceback.print_exc()        return False
                                                      ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_phone_registration_integration.py
  Exception: invalid syntax (test_phone_registration_integration.py, line 169)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_phone_registration_integration.py", line 169
    print("=" * 60)    print("Running Phone Registration Integration Tests")    print("=" * 60)        try:        test_mac_extraction()        test_registration_storage()        test_ip_based_tracking()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_provisioning.py
  Exception: invalid syntax (test_provisioning.py, line 340)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_provisioning.py", line 340
    print("=" * 60)    print("Running Phone Provisioning Tests")    print("=" * 60)        try:        test_device_mac_normalization()        test_phone_template()        test_provisioning_device_registration()        test_supported_vendors_and_models()        test_builtin_templates()        test_config_generation()        test_unregistered_device_error_message()        test_similar_mac_detection()        test_mac_placeholder_detection()                print("=" * 60)        print("All tests passed!")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_provisioning_persistence.py
  Exception: invalid syntax (test_provisioning_persistence.py, line 222)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_provisioning_persistence.py", line 222
    print("=" * 60)    print("Running Provisioning Persistence Tests")    print("=" * 60)        try:        test_provisioning_persistence()        test_static_ip_assignment()        test_device_unregister_removes_from_db()                print("=" * 60)        print("Results: 3 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        import traceback        traceback.print_exc()        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:00] ERROR: test_registered_phones.py
  Exception: invalid syntax (test_registered_phones.py, line 401)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_registered_phones.py", line 401
    print("=" * 60)    print("Running Registered Phones Tests")    print("=" * 60)        try:        test_phone_registration()        test_phone_registration_without_mac()        test_phone_update_registration()        test_list_phones_by_extension()        test_list_all_phones()        test_mac_preservation_on_reregistration()        test_ip_preservation_on_reregistration()        test_update_phone_extension()        test_update_phone_extension_without_mac()                print("=" * 60)        print("Results: 9 passed, 0 failed")        print("=" * 60)    except AssertionError as e:        print(f"\n✗ Test failed: {e}")        return False    except Exception as e:        print(f"\n✗ Unexpected error: {e}")        import traceback        traceback.print_exc()        return False
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:15] ERROR: test_voicemail_database.py
  Exception: invalid syntax (test_voicemail_database.py, line 187)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_database.py", line 187
    print("=" * 60)    print("Running Voicemail Database Tests")    print("=" * 60)    print()        tests = [        test_database_configuration,        test_database_backend_initialization,        test_voicemail_database_integration,        test_voicemail_without_database,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:15] ERROR: test_voicemail_email.py
  Exception: invalid syntax (test_voicemail_email.py, line 130)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_email.py", line 130
    print("=" * 60)    print("Running Voicemail Email Tests")    print("=" * 60)    print()        tests = [        test_email_notifier_config,        test_email_notifier_initialization,        test_voicemail_with_email,        test_extension_email_configuration,        test_no_answer_timeout_config,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:15] ERROR: test_voicemail_fixes.py
  Exception: invalid syntax (test_voicemail_fixes.py, line 183)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_fixes.py", line 183
    print("=" * 60)    print("Running Voicemail Fixes Tests")    print("=" * 60)    print()        tests = [        test_api_serves_audio_by_default,        test_voicemail_access_checks_registry,        test_email_notification_checks_database,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1            print()        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1            print()        print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:15] ERROR: test_voicemail_greeting_menu.py
  Exception: invalid syntax (test_voicemail_greeting_menu.py, line 265)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_greeting_menu.py", line 265
    print("=" * 60)    print("Running Voicemail Greeting Menu Tests")    print("=" * 60)    print()        tests = [        test_access_options_menu,        test_start_greeting_recording,        test_finish_greeting_recording,        test_greeting_review_playback,        test_greeting_review_rerecord,        test_greeting_review_delete,        test_greeting_review_save,        test_complete_greeting_workflow,        test_return_to_main_menu_from_options,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:15] ERROR: test_voicemail_integration.py
  Exception: invalid syntax (test_voicemail_integration.py, line 171)
  Traceback:
Traceback (most recent call last):
  File "/home/runner/work/PBX/PBX/pbx/utils/test_runner.py", line 95, in run_all_tests
    spec.loader.exec_module(module)
  File "<frozen importlib._bootstrap_external>", line 991, in exec_module
  File "<frozen importlib._bootstrap_external>", line 1129, in get_code
  File "<frozen importlib._bootstrap_external>", line 1059, in source_to_code
  File "<frozen importlib._bootstrap>", line 488, in _call_with_frames_removed
  File "/home/runner/work/PBX/PBX/tests/test_voicemail_integration.py", line 171
    print("=" * 60)    print("Running Voicemail Integration Tests")    print("=" * 60)    print()        tests = [        test_complete_voicemail_flow,        test_multiple_voicemails,    ]        passed = 0    failed = 0        for test in tests:        try:            test()            passed += 1        except Exception as e:            print(f"✗ {test.__name__} failed: {e}")            import traceback            traceback.print_exc()            failed += 1        print()    print("=" * 60)    print(f"Results: {passed} passed, {failed} failed")    print("=" * 60)        return failed == 0
                       ^^^^^
SyntaxError: invalid syntax

[2025-12-08 17:48:20] FAILED: test_voicemail_transcription.py
  Return value: False (expected True)

  Test Errors:
    test_transcription_file_not_found (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_file_not_found)
    Test transcription with non-existent file ... ok
    test_transcription_google_no_results (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_no_results)
    Test Google transcription with no results ... ERROR
    test_transcription_google_success (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_success)
    Test successful Google Cloud Speech-to-Text transcription ... ERROR
    test_transcription_result_structure (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_result_structure)
    Test that transcription result has correct structure ... ok
    test_transcription_service_disabled (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_service_disabled)
    Test transcription service when disabled ... ok
    test_transcription_unsupported_provider (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_unsupported_provider)
    Test transcription with unsupported provider ... ok
    
    ======================================================================
    ERROR: test_transcription_google_no_results (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_no_results)
    Test Google transcription with no results
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/usr/lib/python3.12/unittest/mock.py", line 1387, in patched
        with self.decoration_helper(patched,
      File "/usr/lib/python3.12/contextlib.py", line 137, in __enter__
        return next(self.gen)
               ^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1369, in decoration_helper
        arg = exit_stack.enter_context(patching)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/contextlib.py", line 526, in enter_context
        result = _enter(cm)
                 ^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1458, in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1431, in get_original
        raise AttributeError(
    AttributeError: <module 'pbx.features.voicemail_transcription' from '/home/runner/work/PBX/PBX/pbx/features/voicemail_transcription.py'> does not have the attribute 'speech'
    
    ======================================================================
    ERROR: test_transcription_google_success (test_voicemail_transcription.TestVoicemailTranscription.test_transcription_google_success)
    Test successful Google Cloud Speech-to-Text transcription
    ----------------------------------------------------------------------
    Traceback (most recent call last):
      File "/usr/lib/python3.12/unittest/mock.py", line 1387, in patched
        with self.decoration_helper(patched,
      File "/usr/lib/python3.12/contextlib.py", line 137, in __enter__
        return next(self.gen)
               ^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1369, in decoration_helper
        arg = exit_stack.enter_context(patching)
              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/contextlib.py", line 526, in enter_context
        result = _enter(cm)
                 ^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1458, in __enter__
        original, local = self.get_original()
                          ^^^^^^^^^^^^^^^^^^^
      File "/usr/lib/python3.12/unittest/mock.py", line 1431, in get_original
        raise AttributeError(
    AttributeError: <module 'pbx.features.voicemail_transcription' from '/home/runner/work/PBX/PBX/pbx/features/voicemail_transcription.py'> does not have the attribute 'speech'
    
    ----------------------------------------------------------------------
    Ran 6 tests in 0.015s
    
    FAILED (errors=2)

================================================================================
Test Run Completed: 2025-12-08 17:48:57
Summary: 26 passed, 20 failed, 0 skipped
================================================================================
